<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <link rel="icon" href="/xipher.ico" type="image/x-icon">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Чат - Xipher</title>
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/notifications.css">
    <link rel="stylesheet" href="/css/calls.css">
    <link rel="stylesheet" href="/css/topics.css">
    <link rel="stylesheet" href="/css/wallet.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            overflow: hidden;
            margin: 0;
            padding: 0;
        }

        .chat-container {
            display: flex;
            height: 100vh;
            width: 100vw;
            max-width: 100vw;
            min-width: 0;
            background: var(--bg-primary);
            overflow: hidden; /* не даём внутренностям выползать за вьюпорт */
            box-sizing: border-box;
        }

        /* Боковая панель со списком чатов */
        .chats-sidebar {
            width: 380px;
            background: var(--gradient-card);
            border-right: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .chats-header {
            padding: 0.85rem 1.25rem;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 0.75rem;
            background: var(--bg-tertiary);
        }

        .chats-header-actions {
            display: flex;
            gap: 0.5rem;
        }

        .header-action-btn {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            background: var(--bg-secondary);
            border: none;
            color: var(--text-primary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            transition: all 0.2s;
        }

        .header-action-btn:hover {
            background: var(--purple-primary);
            transform: scale(1.05);
        }

        .chat-type-tabs {
            display: flex;
            padding: 0.5rem 1.5rem;
            border-bottom: 1px solid var(--border-color);
            gap: 0.5rem;
            background: var(--bg-tertiary);
        }

        .chat-type-tab {
            padding: 0.5rem 1rem;
            background: transparent;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.2s;
            font-size: 0.9rem;
        }

        .chat-type-tab.active {
            background: var(--purple-primary);
            color: white;
        }

        .chat-type-tab:hover {
            background: var(--bg-secondary);
            color: var(--text-primary);
        }

        .chats-header-user {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            flex: 1;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--gradient-purple);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            box-shadow: 0 0 15px rgba(147, 51, 234, 0.4);
            cursor: pointer;
            transition: transform 0.2s;
        }

        .user-avatar:hover {
            transform: scale(1.05);
        }

        .user-info h3 {
            font-size: 1rem;
            color: var(--text-primary);
            margin: 0;
            font-weight: 600;
        }

        .user-info p {
            font-size: 0.8rem;
            color: var(--text-secondary);
            margin: 0;
        }

        .chats-search {
            padding: 0.75rem 1.5rem;
            border-bottom: 1px solid var(--border-color);
        }

        .search-input {
            width: 100%;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            padding: 0.75rem 1rem;
            color: var(--text-primary);
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--purple-primary);
            box-shadow: 0 0 0 3px rgba(147, 51, 234, 0.1);
        }

        .search-input::placeholder {
            color: var(--text-muted);
        }

        .chats-list {
            flex: 1;
            overflow-y: auto;
            padding: 0.5rem 0;
        }

        .chat-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.875rem 1.5rem;
            cursor: pointer;
            transition: all 0.2s ease;
            border-left: 3px solid transparent;
            position: relative;
        }

        .chat-item:hover {
            background: var(--bg-tertiary);
            border-left-color: var(--purple-primary);
        }

        .chat-item.active {
            background: var(--bg-secondary);
            border-left-color: var(--purple-primary);
        }

        .chat-item.active::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 3px;
            background: var(--gradient-purple);
            box-shadow: 0 0 10px rgba(147, 51, 234, 0.5);
        }

        .chat-avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: var(--gradient-purple);
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 1.1rem;
            box-shadow: 0 0 10px rgba(147, 51, 234, 0.3);
        }

        .chat-info {
            flex: 1;
            min-width: 0;
        }

        .chat-header-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 0.25rem;
        }

        .chat-name {
            font-size: 0.95rem;
            font-weight: 600;
            color: var(--text-primary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .chat-time {
            font-size: 0.75rem;
            color: var(--text-muted);
            flex-shrink: 0;
        }

        .chat-meta {
            display: flex;
            align-items: center;
            gap: 0.35rem;
            flex-shrink: 0;
        }

        .chat-pin-indicator,
        .chat-mute-indicator {
            font-size: 0.75rem;
            color: var(--text-muted);
            line-height: 1;
        }

        .chat-pin-indicator {
            color: var(--purple-primary);
        }

        .chat-preview {
            font-size: 0.85rem;
            color: var(--text-secondary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .chat-unread {
            background: var(--gradient-purple);
            color: white;
            font-size: 0.75rem;
            font-weight: 600;
            padding: 0.125rem 0.5rem;
            border-radius: 12px;
            min-width: 20px;
            text-align: center;
            box-shadow: 0 0 10px rgba(147, 51, 234, 0.3);
        }

        /* Unread messages divider - like Telegram */
        .chat-unread-divider {
            display: flex;
            align-items: center;
            padding: 12px 16px;
            background: rgba(99, 102, 241, 0.08);
            user-select: none;
        }
        .chat-unread-divider .divider-line {
            flex: 1;
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(99, 102, 241, 0.4), transparent);
        }
        .chat-unread-divider .divider-text {
            padding: 0 12px;
            font-size: 0.8rem;
            font-weight: 500;
            color: var(--primary-color, #6366f1);
            white-space: nowrap;
        }

        .chat-status {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: var(--success-color);
            box-shadow: 0 0 8px rgba(16, 185, 129, 0.5);
            flex-shrink: 0;
        }

        /* Основная область чата */
        .chat-main {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: transparent;
            min-height: 0;     /* чтобы вложенные скроллы работали корректно */
            min-width: 0;      /* не даём колонке распирать контейнер по ширине */
            overflow: hidden;  /* прячем лишнее внутри основной области */
            box-sizing: border-box;
        }

        .chat-header {
            padding: 1rem 1.5rem;
            border-bottom: 1px solid var(--border-color);
            background: var(--gradient-card);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .chat-header-info {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .chat-header-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--gradient-purple);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            box-shadow: 0 0 15px rgba(147, 51, 234, 0.4);
        }

        .chat-header-details h3 {
            font-size: 1rem;
            color: var(--text-primary);
            margin: 0;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 0.35rem;
        }

        /* Бейдж верификации канала в заголовке */
        .channel-verified-badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 18px;
            height: 18px;
            color: #3b82f6;
            flex-shrink: 0;
        }

        .channel-verified-badge svg {
            width: 18px;
            height: 18px;
        }

        .chat-header-details p {
            font-size: 0.8rem;
            color: var(--text-secondary);
            margin: 0;
        }

        .chat-header-details p.is-typing {
            display: inline-flex;
            align-items: center;
            gap: 0.35rem;
        }

        .typing-dots {
            display: inline-flex;
            align-items: center;
            gap: 0.2rem;
        }

        .typing-dots span {
            width: 4px;
            height: 4px;
            border-radius: 50%;
            background: currentColor;
            opacity: 0.4;
            animation: typingDot 1.2s infinite ease-in-out;
        }

        .typing-dots span:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-dots span:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typingDot {
            0%, 80%, 100% { transform: translateY(0); opacity: 0.4; }
            40% { transform: translateY(-2px); opacity: 1; }
        }

        .chat-header-details {
            cursor: pointer;
            transition: opacity 0.2s;
        }

        .chat-header-details:hover {
            opacity: 0.8;
        }

        .chat-actions {
            display: flex;
            gap: 0.5rem;
        }

        .chat-action-btn {
            width: 36px;
            height: 36px;
            border-radius: 8px;
            background: transparent;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .chat-action-btn:hover {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }


        .chat-messages {
            flex: 1;
            min-height: 0; /* позволяет блоку ужаться внутри flex-родителя */
            min-width: 0;
            overflow-y: auto;
            overflow-x: hidden;
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            gap: 1.25rem;
            /* Убеждаемся, что сообщения добавляются снизу вверх (старые сверху, новые снизу) */
            justify-content: flex-start;
            align-items: stretch;
            background: transparent;
            box-sizing: border-box;
        }

        .message {
            display: flex;
            gap: 0.75rem;
            /* don't constrain avatar+bubble row; constrain bubble instead */
            max-width: 100%;
            min-width: 0;
            animation: messageSlide 0.3s ease-out;
        }

        @keyframes messageSlide {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message.sent {
            align-self: flex-end;
            flex-direction: row-reverse;
        }

        .message.received {
            align-self: flex-start;
        }

        .message-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: var(--gradient-purple);
            flex: 0 0 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 0.9rem;
            box-shadow: 0 0 10px rgba(147, 51, 234, 0.3);
        }

        .message-bubble {
            padding: 0.875rem 1.25rem;
            border-radius: 16px;
            /* constrain bubble width inside the row; allow flex shrinking */
            max-width: min(72%, calc(100% - 52px));
            min-width: 0;
            word-wrap: break-word;
            position: relative;
        }

        .message.sent .message-bubble {
            background: var(--gradient-purple);
            border-bottom-right-radius: 4px;
            box-shadow: 0 0 15px rgba(147, 51, 234, 0.3);
        }

        .message.received .message-bubble {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-bottom-left-radius: 4px;
        }

        .message-text {
            color: var(--text-primary);
            font-size: 0.95rem;
            line-height: 1.5;
            margin: 0;
            /* Preserve user-entered newlines and formatting in messages */
            white-space: pre-wrap;
            word-break: break-word;
            overflow-wrap: anywhere;
        }

        .message-time {
            font-size: 0.75rem;
            color: var(--text-muted);
            margin-top: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.35rem;
        }

        .message-time-text {
            display: inline-flex;
            opacity: 0.7;
        }

        .message-status {
            display: inline-flex;
            align-items: center;
            font-weight: 600;
            letter-spacing: -0.08em;
            opacity: 1;
        }

        .message-status[data-status="sent"] {
            color: rgba(255, 255, 255, 0.65);
        }

        .message-status[data-status="delivered"] {
            color: rgba(255, 255, 255, 0.55);
        }

        .message-status[data-status="read"] {
            color: var(--accent-color);
        }

        .toggle-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 1rem;
        }

        .toggle-switch {
            position: relative;
            width: 46px;
            height: 26px;
            display: inline-flex;
            align-items: center;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            inset: 0;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 999px;
            transition: all 0.2s ease;
        }

        .toggle-slider::before {
            content: '';
            position: absolute;
            height: 20px;
            width: 20px;
            left: 3px;
            top: 2px;
            background: var(--text-secondary);
            border-radius: 50%;
            transition: transform 0.2s ease, background 0.2s ease;
        }

        .toggle-switch input:checked + .toggle-slider {
            background: rgba(102, 194, 240, 0.25);
            border-color: rgba(102, 194, 240, 0.6);
        }

        .toggle-switch input:checked + .toggle-slider::before {
            transform: translateX(20px);
            background: var(--accent-color);
        }

        /* Reactions (used by channels.js and chat.js context menu flows) */
        .message-reactions {
            display: flex;
            flex-wrap: wrap;
            gap: 0.35rem;
            margin-top: 0.5rem;
        }

        .reaction-btn {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 0.25rem 0.5rem;
            cursor: pointer;
            font-size: 0.85rem;
            color: var(--text-primary);
            transition: all 0.2s;
        }

        .reaction-btn:hover {
            background: rgba(147, 51, 234, 0.18);
            border-color: rgba(147, 51, 234, 0.5);
        }

        .reaction-btn.add-reaction {
            opacity: 0.75;
            font-weight: 700;
        }

        .reaction-picker button:hover {
            transform: scale(1.1);
        }

        /* Channel admin panel (Telegram-like) */
        #channelAdminPanel .modal-content.channel-admin {
            max-width: 980px;
            width: min(96vw, 980px);
            background: var(--bg-primary);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
            border-radius: 22px;
            box-shadow: 0 30px 70px rgba(0, 0, 0, 0.45);
            overflow: hidden;
            max-height: 90vh;
            display: flex;
            flex-direction: column;
        }

        #channelAdminPanel .channel-admin-header {
            padding: 1.1rem 1.4rem;
            background: var(--bg-primary);
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
        }

        #channelAdminPanel .channel-admin-title-line {
            font-size: 1.05rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        #channelAdminPanel .channel-admin-subtitle {
            color: var(--text-muted);
            font-size: 0.8rem;
            margin-top: 4px;
        }

        #channelAdminPanel .channel-admin-body {
            display: grid;
            grid-template-columns: 220px minmax(0, 1fr);
            flex: 1;
            min-height: 0;
        }

        #channelAdminPanel .channel-admin-nav {
            background: var(--bg-primary);
            border-right: 1px solid var(--border-color);
            padding: 12px;
            display: flex;
            flex-direction: column;
            gap: 6px;
            overflow-y: auto;
            min-height: 0;
        }

        #channelAdminPanel .channel-admin-content {
            padding: 18px 20px 24px;
            overflow-y: auto;
            background: var(--bg-primary);
            min-height: 0;
            min-width: 0;
        }

        #channelAdminPanel .channel-admin-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 16px;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        #channelAdminPanel .channel-admin-card + .channel-admin-card {
            margin-top: 14px;
        }

        #channelAdminPanel .channel-admin-card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
        }

        #channelAdminPanel .channel-admin-card-title {
            font-weight: 700;
            font-size: 0.98rem;
        }

        #channelAdminPanel .channel-admin-card-note {
            color: var(--text-muted);
            font-size: 0.85rem;
            margin-top: 2px;
        }

        #channelAdminPanel .channel-admin-hero {
            display: grid;
            grid-template-columns: minmax(180px, 240px) minmax(0, 1fr);
            gap: 16px;
            align-items: start;
        }

        #channelAdminPanel .channel-admin-avatar-block {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        #channelAdminPanel .channel-admin-avatar-label {
            color: var(--text-secondary);
            font-size: 0.85rem;
            font-weight: 600;
        }

        #channelAdminPanel .channel-admin-avatar-preview {
            width: 72px;
            height: 72px;
            border-radius: 20px;
            background: var(--avatar-bg);
            color: var(--avatar-text);
            display: grid;
            place-items: center;
            font-weight: 700;
            overflow: hidden;
        }

        #channelAdminPanel .channel-admin-avatar-actions {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        #channelAdminPanel .channel-admin-fields {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        #channelAdminPanel .channel-admin-toggle-row {
            display: flex;
            gap: 16px;
            flex-wrap: wrap;
        }

        #channelAdminPanel .channel-admin-toggle {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            color: var(--text-primary);
            font-weight: 600;
        }

        #channelAdminPanel .channel-admin-toggle input {
            accent-color: var(--accent-color);
            width: 16px;
            height: 16px;
        }

        #channelAdminPanel .channel-admin-inline {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            align-items: center;
        }

        #channelAdminPanel .channel-admin-inline input {
            flex: 1;
            min-width: 220px;
        }

        #channelAdminPanel .channel-admin-link {
            padding: 0.55rem 0.75rem;
            border-radius: 10px;
            background: var(--bg-tertiary);
            border: 1px dashed var(--border-color);
            color: var(--text-secondary);
            font-size: 0.85rem;
            word-break: break-all;
            min-width: 220px;
        }

        #channelAdminPanel .channel-admin-actions {
            display: flex;
            justify-content: flex-end;
        }

        #channelAdminPanel .channel-admin-reaction-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(56px, 1fr));
            gap: 8px;
        }

        #channelAdminPanel .channel-admin-reaction-grid .btn-secondary.active {
            background: rgba(76, 156, 228, 0.2);
            border-color: rgba(76, 156, 228, 0.5);
            color: var(--text-primary);
        }

        #channelAdminPanel .channel-admin-danger {
            border-color: rgba(239, 68, 68, 0.35);
            background: linear-gradient(180deg, rgba(239, 68, 68, 0.08), transparent);
        }

        #channelAdminPanel .channel-admin-danger .channel-admin-card-title {
            color: #f87171;
        }

        #channelAdminPanel .channel-admin-hint {
            color: var(--text-muted);
            font-size: 0.8rem;
            margin-top: 6px;
        }

        #channelAdminPanel .btn-primary,
        #channelAdminPanel .btn-secondary {
            padding: 0.6rem 1rem;
            border-radius: 10px;
            font-weight: 600;
            font-size: 0.95rem;
            box-shadow: none;
            transition: background 0.2s ease, border-color 0.2s ease, color 0.2s ease;
        }

        #channelAdminPanel .btn-primary {
            background: var(--accent-color);
            color: #fff;
            border: none;
        }

        #channelAdminPanel .btn-primary:hover {
            background: var(--accent-strong);
            transform: none;
        }

        #channelAdminPanel .btn-secondary {
            background: transparent;
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }

        #channelAdminPanel .btn-secondary:hover {
            background: var(--bg-tertiary);
            border-color: var(--border-hover);
            transform: none;
        }

        #channelAdminPanel .btn-primary::before,
        #channelAdminPanel .btn-secondary::before {
            display: none;
        }

        #channelAdminPanel .btn-small {
            padding: 0.4rem 0.7rem;
            font-size: 0.85rem;
            border-radius: 8px;
        }

        #channelAdminPanel .channel-admin-nav .btn-secondary,
        #channelAdminPanel .channel-admin-nav .btn-primary {
            width: 100%;
            text-align: left;
            padding: 0.65rem 0.75rem;
            border-radius: 12px;
        }

        #channelAdminPanel .channel-admin-nav .btn-secondary {
            color: var(--text-secondary);
            border: 1px solid transparent;
        }

        #channelAdminPanel .channel-admin-nav .btn-secondary:hover {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border-color: var(--border-color);
        }

        #channelAdminPanel .channel-admin-nav .btn-primary {
            background: rgba(76, 156, 228, 0.18);
            border: 1px solid rgba(76, 156, 228, 0.4);
            color: var(--text-primary);
        }

        #channelAdminPanel .btn-danger {
            padding: 0.6rem 1rem;
            border-radius: 10px;
            box-shadow: none;
        }

        #channelAdminPanel .btn-danger:hover {
            transform: none;
            box-shadow: none;
        }

        #channelAdminPanel .input-group {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        #channelAdminPanel .input-group label {
            color: var(--text-secondary);
            font-size: 0.85rem;
            font-weight: 600;
        }

        #channelAdminPanel .input-group input,
        #channelAdminPanel .input-group textarea {
            width: 100%;
            box-sizing: border-box;
            padding: 0.7rem 0.85rem;
            border-radius: 10px;
            border: 1px solid var(--border-color);
            background: var(--bg-tertiary);
            color: var(--text-primary);
            outline: none;
        }

        #channelAdminPanel .input-group textarea {
            resize: vertical;
            min-height: 96px;
        }

        #channelAdminPanel .input-group input:focus,
        #channelAdminPanel .input-group textarea:focus {
            border-color: var(--accent-color);
            box-shadow: 0 0 0 3px rgba(51, 144, 236, 0.18);
        }

        #channelAdminPanel input[type="file"] {
            color: var(--text-secondary);
            background: var(--bg-tertiary);
            border: 1px dashed var(--border-color);
            border-radius: 10px;
            padding: 0.35rem 0.5rem;
        }

        #channelAdminPanel input[type="file"]::file-selector-button {
            margin-right: 8px;
            border: 1px solid var(--border-color);
            background: var(--bg-primary);
            color: var(--text-secondary);
            border-radius: 8px;
            padding: 0.35rem 0.6rem;
            cursor: pointer;
        }

        #channelAdminPanel .channel-admin-empty {
            color: var(--text-muted);
            font-size: 0.9rem;
            padding: 1rem;
        }

        @media (max-width: 900px) {
            #channelAdminPanel .channel-admin-body {
                grid-template-columns: 1fr;
            }

            #channelAdminPanel .channel-admin-nav {
                flex-direction: row;
                border-right: none;
                border-bottom: 1px solid var(--border-color);
                overflow-x: auto;
            }

            #channelAdminPanel .channel-admin-nav .btn-secondary,
            #channelAdminPanel .channel-admin-nav .btn-primary {
                width: auto;
                white-space: nowrap;
            }
        }

        @media (max-width: 720px) {
            #channelAdminPanel .channel-admin-hero {
                grid-template-columns: 1fr;
            }

            #channelAdminPanel .channel-admin-actions {
                justify-content: stretch;
            }

            #channelAdminPanel .channel-admin-actions .btn-primary {
                width: 100%;
            }
        }

        /* Channel admin permissions modal */
        #channelAdminPermModal .perm-input {
            display: flex;
            flex-direction: column;
            gap: 6px;
            margin-bottom: 12px;
        }

        #channelAdminPermModal .perm-input label {
            color: var(--text-secondary);
            font-size: 0.9rem;
            font-weight: 600;
        }

        #channelAdminPermModal .perm-input input {
            width: 100%;
            box-sizing: border-box;
            padding: 0.65rem 0.85rem;
            border-radius: 10px;
            border: 1px solid var(--border-color);
            background: var(--bg-tertiary);
            color: var(--text-primary);
            outline: none;
        }

        #channelAdminPermModal .channel-perm-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 10px;
        }

        #channelAdminPermModal .channel-perm-item {
            display: flex;
            gap: 10px;
            align-items: flex-start;
            padding: 10px 12px;
            border-radius: 10px;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            cursor: pointer;
        }

        #channelAdminPermModal .channel-perm-item input {
            margin-top: 4px;
            accent-color: var(--purple-primary);
        }

        .chat-input-area {
            padding: 1.25rem 1.5rem;
            border-top: 1px solid var(--border-color);
            background: var(--gradient-card);
            flex-shrink: 0; /* фиксируем размер панели ввода */
            width: 100%;
            box-sizing: border-box;
            overflow: visible;
        }

        .chat-input-wrapper {
            display: flex;
            gap: 0.5rem;
            align-items: flex-end;
            width: 100%;
            min-width: 0; /* чтобы textarea не выползала вбок */
            box-sizing: border-box;
        }

        .chat-input {
            flex: 1 1 auto;
            min-width: 0;
            max-width: 100%;
            box-sizing: border-box;
        }

        .chat-input-actions {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }

        .chat-action-icon {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            color: var(--text-secondary);
            font-size: 1.2rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .chat-action-icon:hover {
            background: var(--bg-secondary);
            color: var(--text-primary);
            border-color: var(--purple-primary);
        }

        .reply-preview {
            padding: 0.75rem 1rem;
            background: var(--bg-tertiary);
            border-bottom: 1px solid var(--border-color);
        }

        .reply-preview-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 1rem;
        }

        .reply-preview-info {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }

        .reply-preview-label {
            font-size: 0.75rem;
            color: var(--text-muted);
        }

        .reply-preview-text {
            font-size: 0.85rem;
            color: var(--text-secondary);
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .reply-preview-close {
            background: transparent;
            border: none;
            color: var(--text-secondary);
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .reply-preview-close:hover {
            color: var(--text-primary);
        }

        .pending-attachments {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            padding: 0.6rem 0;
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 0.6rem;
        }

        .pending-attachment {
            display: flex;
            align-items: center;
            gap: 0.6rem;
            padding: 0.4rem 0.6rem;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            max-width: 260px;
            min-width: 0;
        }

        .pending-attachment-thumb {
            width: 42px;
            height: 42px;
            border-radius: 8px;
            background: var(--bg-secondary);
            display: flex;
            align-items: center;
            justify-content: center;
            flex: 0 0 auto;
            overflow: hidden;
            font-size: 1.1rem;
        }

        .pending-attachment-thumb img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .pending-attachment-meta {
            flex: 1;
            min-width: 0;
        }

        .pending-attachment-name {
            font-size: 0.8rem;
            color: var(--text-primary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .pending-attachment-size {
            font-size: 0.7rem;
            color: var(--text-muted);
        }

        .pending-attachment-remove {
            background: transparent;
            border: none;
            color: var(--text-secondary);
            font-size: 1.2rem;
            cursor: pointer;
            width: 24px;
            height: 24px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 0;
        }

        .pending-attachment-remove:hover {
            color: var(--text-primary);
        }

        .chat-messages.is-drop-target,
        .chat-input-area.is-drop-target {
            box-shadow: inset 0 0 0 2px var(--purple-primary);
        }

        .chat-input.is-drop-target {
            box-shadow: 0 0 0 2px var(--purple-primary);
        }

        .emoji-picker-container {
            position: fixed;
            bottom: 100px;
            right: 20px;
            z-index: 1000;
            background: var(--gradient-card);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            max-width: 400px;
            max-height: 500px;
        }

        .emoji-picker {
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        .emoji-picker-header {
            padding: 1rem;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .emoji-picker-header h3 {
            margin: 0;
            font-size: 1rem;
            color: var(--text-primary);
        }

        .emoji-picker-close {
            background: transparent;
            border: none;
            color: var(--text-secondary);
            font-size: 1.5rem;
            cursor: pointer;
        }

        .emoji-picker-search {
            padding: 0.75rem;
            border-bottom: 1px solid var(--border-color);
        }

        .emoji-picker-search input {
            width: 100%;
            padding: 0.5rem;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-primary);
        }

        .emoji-picker-grid {
            padding: 1rem;
            overflow-y: auto;
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 0.5rem;
            max-height: 350px;
        }

        .emoji-item {
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 8px;
            text-align: center;
            transition: background 0.2s;
        }

        .emoji-item:hover {
            background: var(--bg-tertiary);
        }

        .message-reply {
            padding: 0.5rem;
            background: var(--bg-secondary);
            border-left: 3px solid var(--purple-primary);
            border-radius: 8px;
            margin-bottom: 0.5rem;
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .message-reply-label {
            font-size: 0.75rem;
            color: var(--text-muted);
            margin-bottom: 0.25rem;
        }

        .message-file {
            padding: 12px 14px;
            background: rgba(255, 255, 255, 0.06);
            border-radius: 12px;
            margin-top: 0.5rem;
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            transition: background 0.2s ease;
            min-width: 220px;
        }

        .message-file:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .message.sent .message-file {
            background: rgba(255, 255, 255, 0.15);
        }

        .message.sent .message-file:hover {
            background: rgba(255, 255, 255, 0.22);
        }

        .message-file-icon-wrap {
            position: relative;
            width: 48px;
            height: 48px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            flex: 0 0 auto;
            background: linear-gradient(135deg, #5865F2, #7289DA);
            border-radius: 12px;
            color: #fff;
        }

        .message.sent .message-file-icon-wrap {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.25), rgba(255, 255, 255, 0.15));
        }

        .message-file-icon {
            font-size: 1.4rem;
            position: relative;
            z-index: 1;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .message-file-icon svg {
            width: 24px;
            height: 24px;
            fill: currentColor;
        }

        .message-file-info {
            flex: 1;
            min-width: 0;
            overflow: hidden;
        }

        .message-file-name {
            font-size: 0.95rem;
            font-weight: 500;
            color: var(--text-primary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 200px;
        }

        .message.sent .message-file-name {
            color: #fff;
        }

        .message-file-size {
            font-size: 0.8rem;
            color: var(--text-muted);
            margin-top: 2px;
        }

        .message.sent .message-file-size {
            color: rgba(255, 255, 255, 0.7);
        }

        /* Иконки по типу файла */
        .message-file[data-ext="pdf"] .message-file-icon-wrap {
            background: linear-gradient(135deg, #E53935, #D32F2F);
        }
        .message-file[data-ext="doc"] .message-file-icon-wrap,
        .message-file[data-ext="docx"] .message-file-icon-wrap {
            background: linear-gradient(135deg, #2196F3, #1976D2);
        }
        .message-file[data-ext="xls"] .message-file-icon-wrap,
        .message-file[data-ext="xlsx"] .message-file-icon-wrap {
            background: linear-gradient(135deg, #4CAF50, #388E3C);
        }
        .message-file[data-ext="zip"] .message-file-icon-wrap,
        .message-file[data-ext="rar"] .message-file-icon-wrap,
        .message-file[data-ext="7z"] .message-file-icon-wrap {
            background: linear-gradient(135deg, #FF9800, #F57C00);
        }
        .message-file[data-ext="mp3"] .message-file-icon-wrap,
        .message-file[data-ext="wav"] .message-file-icon-wrap,
        .message-file[data-ext="ogg"] .message-file-icon-wrap {
            background: linear-gradient(135deg, #9C27B0, #7B1FA2);
        }
        .message-file[data-ext="mp4"] .message-file-icon-wrap,
        .message-file[data-ext="avi"] .message-file-icon-wrap,
        .message-file[data-ext="mkv"] .message-file-icon-wrap,
        .message-file[data-ext="mov"] .message-file-icon-wrap {
            background: linear-gradient(135deg, #E91E63, #C2185B);
        }
        .message-file[data-ext="txt"] .message-file-icon-wrap {
            background: linear-gradient(135deg, #607D8B, #455A64);
        }
        .message-file[data-ext="apk"] .message-file-icon-wrap {
            background: linear-gradient(135deg, #3DDC84, #00C853);
        }

        .message-image {
            margin-top: 0.5rem;
            position: relative;
            display: inline-block;
        }

        .message-image img {
            display: block;
            max-width: 100%;
            max-height: 400px;
            border-radius: 8px;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .message-image img:hover {
            transform: scale(1.02);
        }

        .file-transfer-ring {
            --transfer-ring-size: 36px;
            --transfer-ring-stroke: 2.4;
            position: absolute;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            border: none;
            background: none;
            padding: 0;
            cursor: pointer;
            z-index: 4;
            transition: opacity 0.2s ease;
        }

        .message-image .file-transfer-ring {
            inset: auto;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .file-transfer-ring.is-hidden {
            opacity: 0;
            pointer-events: none;
        }

        .file-transfer-ring .transfer-ring-svg {
            width: var(--transfer-ring-size);
            height: var(--transfer-ring-size);
            transform: rotate(-90deg);
        }

        .file-transfer-ring .transfer-ring-track,
        .file-transfer-ring .transfer-ring-progress {
            fill: none;
            stroke-width: var(--transfer-ring-stroke);
        }

        .file-transfer-ring .transfer-ring-track {
            stroke: var(--transfer-ring-track);
        }

        .file-transfer-ring .transfer-ring-progress {
            stroke: var(--transfer-ring-progress);
            stroke-linecap: round;
            transition: stroke-dashoffset 0.2s linear;
        }

        .file-transfer-ring .transfer-ring-button {
            position: absolute;
            width: calc(var(--transfer-ring-size) - 12px);
            height: calc(var(--transfer-ring-size) - 12px);
            border-radius: 50%;
            background: var(--transfer-ring-bg);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--transfer-ring-icon);
            box-shadow: 0 6px 14px rgba(0,0,0,0.28);
        }

        .file-transfer-ring .transfer-ring-icon {
            width: 18px;
            height: 18px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        .file-transfer-ring .transfer-ring-icon svg {
            width: 18px;
            height: 18px;
            display: block;
        }

        .file-transfer-ring[data-state="idle"] .transfer-ring-progress,
        .file-transfer-ring[data-state="done"] .transfer-ring-progress {
            opacity: 0;
        }

        .file-transfer-ring[data-state="done"][data-kind="file"] .transfer-ring-track {
            opacity: 0;
        }

        .message-video {
            margin-top: 0.5rem;
        }

        .message-video video {
            display: block;
            max-width: 100%;
            max-height: 400px;
            border-radius: 8px;
            background: #000;
        }

        .message-location {
            margin-top: 0.5rem;
            border-radius: 12px;
            overflow: hidden;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .message.sent .message-location {
            background: rgba(255, 255, 255, 0.12);
            border-color: rgba(255, 255, 255, 0.2);
        }

        .message-location:hover {
            transform: translateY(-1px);
            box-shadow: 0 8px 18px rgba(0, 0, 0, 0.35);
        }

        .message-location-map {
            display: block;
            width: 100%;
            height: 140px;
            object-fit: cover;
        }

        .message-location-info {
            padding: 0.6rem 0.75rem;
            display: flex;
            flex-direction: column;
            gap: 0.2rem;
        }

        .message-location-title {
            font-size: 0.95rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .message-location-subtitle {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        /* Голосовые сообщения - точно как в Telegram */
        .message-voice {
            display: flex;
            align-items: center;
            gap: 0;
            min-width: 200px;
            max-width: 280px;
            padding: 0;
            background: transparent;
            border: none;
        }

        .voice-player {
            flex: 1;
            display: flex;
            align-items: center;
            gap: 8px;
            min-width: 0;
        }

        .voice-play-btn {
            width: 48px;
            height: 48px;
            min-width: 48px;
            border-radius: 50%;
            background: linear-gradient(135deg, #34B7F1, #25D366);
            border: none;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.15s ease, opacity 0.15s ease;
            flex-shrink: 0;
            padding: 0;
            box-shadow: none;
            position: relative;
        }

        .voice-play-btn::before {
            content: '';
            position: absolute;
            inset: 0;
            border-radius: 50%;
            background: radial-gradient(circle at 30% 30%, rgba(255,255,255,0.3), transparent 60%);
            pointer-events: none;
        }

        .voice-play-btn:hover {
            transform: scale(1.05);
        }

        .voice-play-btn:active {
            transform: scale(0.95);
            opacity: 0.9;
        }

        .voice-play-btn svg {
            width: 20px;
            height: 20px;
            margin-left: 3px;
            position: relative;
            z-index: 1;
        }

        .voice-play-btn.is-playing svg {
            margin-left: 0;
        }

        .voice-waveform-container {
            flex: 1;
            min-width: 0;
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .voice-waveform {
            width: 100%;
            height: 23px;
            cursor: pointer;
            border-radius: 2px;
        }

        .voice-info {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 8px;
            font-size: 0.72rem;
            color: var(--text-muted);
            padding-top: 2px;
        }

        .voice-meta-row {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .voice-duration {
            color: var(--text-secondary);
            font-weight: 400;
            font-size: 0.75rem;
            font-variant-numeric: tabular-nums;
        }

        .voice-size {
            display: none;
        }

        .voice-speed-btn {
            border: none;
            border-radius: 10px;
            padding: 2px 6px;
            font-size: 0.65rem;
            font-weight: 600;
            line-height: 1.2;
            color: var(--text-secondary);
            background: rgba(0, 0, 0, 0.08);
            cursor: pointer;
            transition: all 0.15s ease;
        }

        .voice-speed-btn:hover {
            background: rgba(0, 0, 0, 0.15);
        }

        .voice-forward-btn {
            display: none;
        }

        /* Входящие голосовые - серые волны */
        .message.received .message-voice {
            --voice-wave-played: #53bdeb;
            --voice-wave-unplayed: rgba(0, 0, 0, 0.15);
        }

        .message.received .voice-play-btn {
            background: linear-gradient(135deg, #53bdeb, #34B7F1);
        }

        /* Исходящие голосовые - фиолетовые/зелёные волны */
        .message.sent .message-voice {
            --voice-wave-played: rgba(255, 255, 255, 0.9);
            --voice-wave-unplayed: rgba(255, 255, 255, 0.35);
        }

        .message.sent .voice-play-btn {
            background: rgba(255, 255, 255, 0.25);
            backdrop-filter: blur(4px);
        }

        .message.sent .voice-play-btn::before {
            background: none;
        }

        .message.sent .voice-play-btn:hover {
            background: rgba(255, 255, 255, 0.35);
        }

        .message.sent .voice-duration {
            color: rgba(255, 255, 255, 0.85);
        }

        .message.sent .voice-speed-btn {
            background: rgba(255, 255, 255, 0.2);
            color: rgba(255, 255, 255, 0.9);
        }

        .message.sent .voice-speed-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .chat-input {
            flex: 1;
            background: var(--bg-tertiary);
            border: 2px solid var(--border-color);
            border-radius: 12px;
            padding: 0.875rem 1.25rem;
            color: var(--text-primary);
            font-size: 1rem;
            font-family: inherit;
            resize: none;
            min-height: 50px;
            max-height: 150px;
            transition: all 0.3s ease;
        }

        .chat-input:focus {
            outline: none;
            border-color: var(--purple-primary);
            box-shadow: 0 0 0 3px rgba(147, 51, 234, 0.1), var(--shadow-glow);
        }

        .chat-send-btn {
            padding: 0.875rem 2rem;
            background: var(--gradient-purple);
            border: none;
            border-radius: 12px;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: var(--shadow-glow);
        }

        .chat-send-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-glow-strong);
        }

        .chat-send-btn:active {
            transform: translateY(0);
        }

        .empty-chat {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: var(--text-secondary);
            text-align: center;
            padding: 2rem;
        }

        .empty-chat-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        .empty-chat h3 {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
        }

        .empty-chat p {
            font-size: 1rem;
            max-width: 400px;
        }

        /* Xipher 2025 inspired overrides */
        body {
            background: var(--bg-primary);
            color: var(--text-primary);
            transition: background var(--transition-fast), color var(--transition-fast);
        }

        .chat-container {
            display: grid;
            grid-template-columns: 320px minmax(0, 1fr) 320px;
            height: 100vh;
            background:
                radial-gradient(circle at 20% 30%, rgba(157, 0, 255, 0.08), transparent 42%),
                radial-gradient(circle at 80% 70%, rgba(138, 43, 226, 0.06), transparent 45%),
                url('/images/chat-bg-stars.svg') center/cover fixed no-repeat;
            background-color: #0c1024;
        }

        .chats-sidebar {
            backdrop-filter: blur(var(--glass-blur));
            background: var(--glass);
            border-right: 1px solid var(--glass-border);
            box-shadow: inset 0 1px 0 var(--glass-border);
            transition: background var(--transition-fast), border-color var(--transition-fast);
        }

        .chats-header,
        .chat-type-tabs,
        .chats-search {
            background: transparent;
            border-color: var(--glass-border);
        }

        .chat-item {
            border-left: 3px solid transparent;
            transition: transform var(--transition-fast), background var(--transition-fast), border-color var(--transition-fast);
        }

        .chat-item:hover {
            background: var(--bg-tertiary);
            border-left-color: var(--accent-color);
            transform: translateX(4px);
        }

        .chat-item.active {
            background: linear-gradient(135deg, rgba(157, 0, 255, 0.16), rgba(157, 0, 255, 0.06));
            border-left-color: var(--accent-color);
            box-shadow: var(--shadow-soft);
        }

        .chat-privacy-mode .chat-avatar,
        .chat-privacy-mode .chat-preview-text {
            filter: blur(6px);
        }

        .chat-privacy-mode .chat-preview-text {
            user-select: none;
        }

        .chat-main {
            background: transparent;
            min-width: 0;
            overflow: hidden;
        }

        .chat-header {
            backdrop-filter: blur(var(--glass-blur));
            background: linear-gradient(120deg, rgba(157, 0, 255, 0.14), rgba(0, 0, 0, 0.0));
            border-bottom: 1px solid var(--glass-border);
            box-shadow: inset 0 -1px 0 var(--glass-border);
            width: 100%;
            max-width: 100%;
            min-width: 0;
            box-sizing: border-box;
            overflow: hidden;
        }

        .chat-header-info {
            flex: 1 1 auto;
            min-width: 0;
        }

        .chat-header-details {
            min-width: 0;
        }

        .chat-header-details h3,
        .chat-header-details p {
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .chat-actions { flex-shrink: 0; }

        .chat-messages {
            padding: 1.25rem 1.5rem 1.5rem;
            gap: 0.6rem;
            background: transparent;
        }

        .message {
            display: flex;
            gap: 0.5rem;
            /* don't constrain avatar+bubble row; constrain bubble instead */
            max-width: 100%;
            min-width: 0;
            width: 100%;
            position: relative;
            transition: transform var(--transition-fast), filter var(--transition-fast);
        }

        .spoiler-blur {
            filter: blur(5px);
            user-select: none;
            transition: filter var(--transition-fast);
        }

        .spoiler-blur.is-revealed {
            filter: none;
        }

        .spoiler-media {
            position: relative;
        }

        .spoiler-media .spoiler-overlay {
            position: absolute;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(8, 9, 18, 0.55);
            color: var(--text-primary);
            font-size: 0.72rem;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            border-radius: 12px;
            pointer-events: none;
            transition: opacity var(--transition-fast);
        }

        .spoiler-media.is-revealed .spoiler-overlay {
            opacity: 0;
        }

        .spoiler-media.is-revealed .spoiler-blur {
            filter: none;
        }

        .message.sent { align-self: flex-end; flex-direction: row-reverse; }
        .message:hover { transform: translateY(-2px); filter: drop-shadow(0 8px 18px rgba(0,0,0,0.35)); }
        .message.sent,
        .message.received { align-self: stretch; }

        .message-bubble {
            position: relative;
            padding: 0.85rem 1.05rem 0.9rem;
            border-radius: 18px;
            background: var(--msg-bubble-in);
            border: 1px solid var(--glass-border);
            backdrop-filter: blur(8px);
            color: var(--text-primary);
            transition: background var(--transition-fast), border-color var(--transition-fast);
            max-width: min(72%, calc(100% - 52px));
            min-width: 0;
        }

        .message.sent .message-bubble {
            background: var(--msg-bubble-out);
            color: #fff;
            border: none;
        }

        .message.received .message-bubble {
            background: var(--msg-bubble-in);
        }

        /* Сообщения только с изображением - без фона как в Telegram */
        .message.is-media-only .message-bubble {
            background: transparent !important;
            border: none !important;
            padding: 0 !important;
            backdrop-filter: none !important;
            box-shadow: none !important;
        }

        .message.is-media-only .message-bubble::after {
            display: none !important;
        }

        .message.is-media-only .message-image {
            margin-top: 0;
        }

        .message.is-media-only .message-image img {
            border-radius: 12px;
        }

        .message.is-media-only .message-time {
            position: absolute;
            bottom: 8px;
            right: 8px;
            background: rgba(0, 0, 0, 0.55);
            padding: 3px 8px;
            border-radius: 10px;
            backdrop-filter: blur(4px);
        }

        .message.is-media-only .message-time .message-time-text,
        .message.is-media-only .message-time .message-status {
            color: #fff !important;
        }

        /* Сообщения только с файлом - без фона как в Telegram/Discord */
        .message.is-file-only .message-bubble {
            background: transparent !important;
            border: none !important;
            padding: 0 !important;
            backdrop-filter: none !important;
            box-shadow: none !important;
        }

        .message.is-file-only .message-bubble::after {
            display: none !important;
        }

        .message.is-file-only .message-file {
            margin: 0;
            min-width: 280px;
            max-width: 320px;
        }

        .message.is-file-only .message-time {
            position: absolute;
            bottom: -18px;
            right: 0;
            font-size: 0.75rem;
        }

        .message.is-file-only .message-time .message-time-text {
            color: var(--text-muted);
        }

        /* Голосовые сообщения - стиль Telegram */
        .message.is-voice-message .message-bubble {
            padding: 10px 14px;
            background: rgba(30, 30, 40, 0.75);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 18px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
            min-width: 220px;
            max-width: 320px;
        }

        .message.sent.is-voice-message .message-bubble {
            background: linear-gradient(135deg, rgba(157, 0, 255, 0.35), rgba(123, 37, 255, 0.35));
            border-color: rgba(157, 0, 255, 0.25);
        }

        .message.is-voice-message:hover {
            transform: none;
            filter: none;
        }

        .message.is-voice-message .message-bubble::after {
            display: none;
        }

        .message-bubble::after {
            content: '';
            position: absolute;
            bottom: 8px;
            width: 12px;
            height: 12px;
            background: inherit;
            border: inherit;
            transform: rotate(45deg);
            filter: blur(0.2px);
        }

        .message.sent .message-bubble::after {
            right: -6px;
            border-bottom-right-radius: 3px;
        }

        .message.received .message-bubble::after {
            left: -6px;
            border-top-left-radius: 3px;
        }

        /* grouping states to be toggled via JS when rendering */
        .message.is-mid .message-bubble { border-radius: 14px; }
        .message.is-first .message-bubble { border-top-left-radius: 6px; border-top-right-radius: 18px; }
        .message.is-last .message-bubble { border-bottom-left-radius: 18px; border-bottom-right-radius: 6px; }

        /* Media groups (Telegram-like albums) */
        .message-group {
            display: grid;
            gap: 0.35rem;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            align-self: flex-start;
            width: 100%;
            max-width: min(72%, calc(100% - 52px));
            margin-left: 42px;
        }

        .message-group.sent {
            align-self: flex-end;
            margin-left: 0;
            margin-right: 42px;
        }

        .message-group .message {
            display: block;
            width: 100%;
            margin: 0;
        }

        .message-group .message:hover {
            transform: none;
            filter: none;
        }

        .message-group .message-avatar {
            display: none;
        }

        .message-group .message-bubble {
            padding: 0;
            border: none;
            background: transparent;
            box-shadow: none;
            max-width: 100%;
        }

        .message-group .message-bubble::after {
            display: none;
        }

        .message-group .message-time {
            display: none;
        }

        .message-group .message:last-child .message-time {
            display: flex;
        }

        .message-group .message-image {
            margin: 0;
            width: 100%;
            aspect-ratio: 1 / 1;
        }

        .message-group .message-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 12px;
        }

        .message-time {
            font-size: 0.78rem;
            color: var(--text-muted);
            margin-top: 0.35rem;
            display: flex;
            gap: 0.25rem;
            align-items: center;
        }

        .message.sent .message-time { justify-content: flex-end; color: rgba(255,255,255,0.75); }

        .chat-input-area {
            position: relative;
            padding: 1rem 1.5rem;
            background: var(--bg-secondary);
            border-top: 1px solid var(--glass-border);
            backdrop-filter: blur(var(--glass-blur));
            width: 100%;
            max-width: 100%;
            box-sizing: border-box;
            overflow: visible;
        }

        .chat-input-wrapper {
            border-radius: 18px;
            background: var(--bg-tertiary);
            border: 1px solid var(--glass-border);
            box-shadow: var(--shadow-soft);
            padding: 0.6rem 0.7rem;
            gap: 0.6rem;
            width: 100%;
            max-width: 100%;
            min-width: 0;
        }

        .chat-input {
            background: transparent;
            border: none;
            color: var(--text-primary);
            min-height: 46px;
            max-height: 160px;
        }

        .chat-input:focus { outline: none; }

        .chat-action-icon {
            background: transparent;
            border: 1px solid var(--glass-border);
            color: var(--text-secondary);
            transition: background var(--transition-fast), color var(--transition-fast), transform var(--transition-fast);
        }

        .chat-action-icon:hover {
            background: rgba(157, 0, 255, 0.14);
            color: var(--text-primary);
            transform: translateY(-2px);
        }

        .chat-action-icon.is-active {
            background: rgba(157, 0, 255, 0.22);
            border-color: rgba(157, 0, 255, 0.6);
            color: var(--text-primary);
        }

        .chat-input-actions { flex-shrink: 0; }

        .voice-record-btn {
            touch-action: none;
        }

        .attach-menu {
            position: absolute;
            left: 18px;
            bottom: 72px;
            min-width: 200px;
            padding: 0.4rem;
            border-radius: 14px;
            border: 1px solid var(--glass-border);
            background: var(--bg-secondary);
            box-shadow: var(--shadow-soft);
            display: none;
            flex-direction: column;
            gap: 0.3rem;
            z-index: 220;
            backdrop-filter: blur(var(--glass-blur));
        }

        .attach-menu.show {
            display: flex;
        }

        .ttl-menu {
            position: absolute;
            min-width: 170px;
            padding: 0.4rem;
            border-radius: 14px;
            border: 1px solid var(--glass-border);
            background: var(--bg-secondary);
            box-shadow: var(--shadow-soft);
            display: none;
            flex-direction: column;
            gap: 0.3rem;
            z-index: 230;
            backdrop-filter: blur(var(--glass-blur));
        }

        .ttl-menu.show {
            display: flex;
        }

        .attach-menu-item {
            display: flex;
            align-items: center;
            gap: 0.6rem;
            width: 100%;
            padding: 0.55rem 0.75rem;
            border-radius: 10px;
            border: 1px solid transparent;
            background: transparent;
            color: var(--text-primary);
            cursor: pointer;
            font-size: 0.92rem;
            text-align: left;
        }

        .attach-menu-item:hover {
            background: rgba(157, 0, 255, 0.12);
            border-color: rgba(157, 0, 255, 0.4);
        }

        .ttl-menu-item {
            display: flex;
            align-items: center;
            gap: 0.6rem;
            width: 100%;
            padding: 0.55rem 0.75rem;
            border-radius: 10px;
            border: 1px solid transparent;
            background: transparent;
            color: var(--text-primary);
            cursor: pointer;
            font-size: 0.92rem;
            text-align: left;
        }

        .ttl-menu-item:hover {
            background: rgba(157, 0, 255, 0.12);
            border-color: rgba(157, 0, 255, 0.4);
        }

        .ttl-menu-item.is-selected {
            background: rgba(157, 0, 255, 0.18);
            border-color: rgba(157, 0, 255, 0.5);
        }

        .attach-menu-icon {
            width: 28px;
            height: 28px;
            border-radius: 8px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            background: rgba(255, 255, 255, 0.08);
            font-size: 1rem;
            color: var(--text-primary);
        }

        .attach-menu-icon svg {
            width: 16px;
            height: 16px;
            stroke: currentColor;
            stroke-width: 1.8;
            stroke-linecap: round;
            stroke-linejoin: round;
            fill: none;
        }

        .attach-menu-icon.is-file {
            background: linear-gradient(135deg, #38bdf8, #6366f1);
            color: #ffffff;
        }

        .attach-menu-icon.is-location {
            background: linear-gradient(135deg, #34d399, #22c55e);
            color: #ffffff;
        }

        .attach-menu-icon.is-live {
            background: linear-gradient(135deg, #f97316, #f43f5e);
            color: #ffffff;
        }

        .attach-menu-icon.is-checklist {
            background: linear-gradient(135deg, #facc15, #f59e0b);
            color: #ffffff;
        }

        .attach-menu-icon.is-gift {
            background: linear-gradient(135deg, #fbbf24, #f97316);
            color: #ffffff;
        }

        .attach-menu-pill {
            margin-left: auto;
            font-size: 0.7rem;
            font-weight: 600;
            padding: 0.15rem 0.45rem;
            border-radius: 999px;
            border: 1px solid rgba(248, 113, 113, 0.4);
            background: rgba(248, 113, 113, 0.18);
            color: #fecaca;
            text-transform: uppercase;
            letter-spacing: 0.08em;
        }

        .live-location-bar {
            display: none;
            align-items: center;
            justify-content: space-between;
            gap: 1rem;
            padding: 0.65rem 0.8rem;
            border-radius: 14px;
            background: rgba(255, 255, 255, 0.04);
            border: 1px solid rgba(255, 255, 255, 0.08);
            margin-bottom: 0.7rem;
        }

        .live-location-info {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
            min-width: 0;
        }

        .live-location-title {
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.4rem;
            flex-wrap: wrap;
        }

        .live-location-target {
            color: var(--text-muted);
            font-size: 0.85rem;
        }

        .live-location-timer {
            color: var(--text-secondary);
            font-size: 0.85rem;
        }

        .live-location-stop {
            border: 1px solid rgba(248, 113, 113, 0.4);
            background: rgba(248, 113, 113, 0.18);
            color: #fecaca;
            padding: 0.4rem 0.7rem;
            border-radius: 10px;
            cursor: pointer;
            font-size: 0.85rem;
            flex-shrink: 0;
        }

        .live-location-stop:hover {
            background: rgba(248, 113, 113, 0.28);
        }

        .live-location-options {
            display: grid;
            gap: 0.6rem;
            margin-top: 0.9rem;
        }

        .live-location-option {
            width: 100%;
            padding: 0.75rem 0.85rem;
            border-radius: 12px;
            border: 1px solid var(--border-color);
            background: var(--bg-tertiary);
            color: var(--text-primary);
            font-size: 0.95rem;
            cursor: pointer;
            text-align: left;
            transition: transform 0.2s ease, border-color 0.2s ease, background 0.2s ease;
        }

        .live-location-option:hover {
            border-color: var(--accent-color);
            background: rgba(157, 0, 255, 0.12);
            transform: translateY(-1px);
        }

        .chat-action-icon.is-recording {
            background: rgba(255, 59, 48, 0.14);
            border-color: rgba(255, 59, 48, 0.4);
            color: #ff6b6b;
            transform: none;
            box-shadow: 0 0 0 6px rgba(255, 59, 48, 0.08);
        }

        .chat-action-icon.is-locked {
            background: rgba(157, 0, 255, 0.18);
            border-color: rgba(157, 0, 255, 0.4);
            color: #f7f7ff;
        }

        .chat-send-btn {
            border-radius: 14px;
            padding: 0.85rem 1.4rem;
            background: linear-gradient(135deg, var(--accent-color), var(--accent-soft));
            box-shadow: var(--shadow-glow);
            border: none;
            color: #fff;
            transition: transform var(--transition-fast), box-shadow var(--transition-fast);
        }

        .chat-send-btn:hover { transform: translateY(-2px); box-shadow: 0 10px 26px rgba(157, 0, 255, 0.4); }

        .chat-input-area.is-voice-recording .chat-input-wrapper {
            opacity: 0.55;
        }

        .voice-recording-overlay {
            position: absolute;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            pointer-events: none;
            opacity: 0;
            transform: translateY(8px);
            transition: opacity 0.2s ease, transform 0.2s ease;
        }

        .voice-recording-overlay.is-active {
            opacity: 1;
            transform: translateY(0);
        }

        .voice-recording-pill {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.45rem 0.7rem;
            background: rgba(12, 12, 16, 0.9);
            border: 1px solid rgba(255, 255, 255, 0.12);
            border-radius: 999px;
            box-shadow: 0 12px 26px rgba(0, 0, 0, 0.35);
            pointer-events: auto;
            max-width: min(92%, 520px);
        }

        .voice-recording-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #ff3b30;
            box-shadow: 0 0 10px rgba(255, 59, 48, 0.6);
            animation: voicePulse 1.2s ease-in-out infinite;
        }

        @keyframes voicePulse {
            0%, 100% { transform: scale(0.9); opacity: 0.7; }
            50% { transform: scale(1.2); opacity: 1; }
        }

        .voice-recording-label {
            font-size: 0.8rem;
            color: var(--text-primary);
            font-weight: 600;
        }

        .voice-recording-timer {
            font-size: 0.78rem;
            color: var(--text-secondary);
            font-family: ui-monospace, 'Courier New', monospace;
            min-width: 42px;
            text-align: right;
        }

        .voice-recording-divider {
            width: 1px;
            height: 16px;
            background: rgba(255, 255, 255, 0.12);
        }

        .voice-recording-hint {
            font-size: 0.72rem;
            color: var(--text-muted);
            white-space: nowrap;
        }

        .voice-recording-stop {
            border: none;
            background: rgba(255, 255, 255, 0.12);
            color: #fff;
            font-size: 0.7rem;
            padding: 0.2rem 0.55rem;
            border-radius: 999px;
            cursor: pointer;
            display: none;
        }

        .voice-recording-overlay.is-locked .voice-recording-hint {
            color: var(--text-secondary);
        }

        .voice-recording-overlay.is-locked .voice-recording-stop {
            display: inline-flex;
        }

        .info-panel {
            backdrop-filter: blur(var(--glass-blur));
            background: var(--glass);
            border-left: 1px solid var(--glass-border);
            box-shadow: inset 0 1px 0 var(--glass-border);
            padding: 1.25rem;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .info-panel-content {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .channel-info-header {
            display: flex;
            gap: 0.8rem;
            align-items: center;
        }

        .channel-info-avatar {
            width: 64px;
            height: 64px;
            border-radius: 18px;
            background: var(--avatar-bg);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--avatar-text);
            font-weight: 700;
            font-size: 1.4rem;
            overflow: hidden;
        }

        .channel-info-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .channel-info-meta {
            display: flex;
            flex-direction: column;
            gap: 0.2rem;
            min-width: 0;
        }

        .channel-info-title {
            font-size: 1.05rem;
            font-weight: 700;
            color: var(--text-primary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .channel-info-subtitle {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .channel-info-section {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 0.75rem;
            display: flex;
            flex-direction: column;
            gap: 0.6rem;
        }

        .channel-info-label {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            color: var(--text-muted);
        }

        .channel-info-link {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 0.6rem;
            flex-wrap: wrap;
        }

        .channel-info-link a {
            color: var(--accent-color);
            text-decoration: none;
            word-break: break-all;
        }

        .channel-info-link a:hover {
            text-decoration: underline;
        }

        .channel-info-toggle {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 0.6rem;
        }

        .channel-info-divider {
            height: 1px;
            background: var(--border-color);
        }

        .channel-media-section {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 0.6rem 0.75rem;
        }

        .channel-media-section summary {
            list-style: none;
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: pointer;
            color: var(--text-primary);
            font-weight: 600;
        }

        .channel-media-section summary::-webkit-details-marker {
            display: none;
        }

        .channel-media-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(90px, 1fr));
            gap: 0.5rem;
            margin-top: 0.6rem;
        }

        .channel-media-item {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            padding: 0.35rem;
            display: flex;
            flex-direction: column;
            gap: 0.35rem;
            cursor: pointer;
            transition: border-color 0.2s ease, transform 0.2s ease;
        }

        .channel-media-item:hover {
            border-color: var(--border-hover);
            transform: translateY(-1px);
        }

        .channel-media-item.selected {
            outline: 2px solid var(--accent-color);
        }

        .channel-media-thumb {
            width: 100%;
            aspect-ratio: 1 / 1;
            border-radius: 8px;
            background: var(--bg-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-secondary);
            overflow: hidden;
        }

        .channel-media-thumb img,
        .channel-media-thumb video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .channel-media-name {
            font-size: 0.72rem;
            color: var(--text-secondary);
            word-break: break-word;
        }

        .channel-link-list {
            display: flex;
            flex-direction: column;
            gap: 0.6rem;
            margin-top: 0.6rem;
        }

        .channel-link-item {
            padding: 0.6rem;
            border: 1px solid var(--border-color);
            border-radius: 10px;
            background: var(--bg-secondary);
            display: flex;
            flex-direction: column;
            gap: 0.35rem;
        }

        .channel-link-item a {
            color: var(--accent-color);
            text-decoration: none;
            word-break: break-all;
        }

        .channel-link-item a:hover {
            text-decoration: underline;
        }

        .channel-voice-item {
            padding: 0.6rem;
            border: 1px solid var(--border-color);
            border-radius: 10px;
            background: var(--bg-secondary);
            display: flex;
            flex-direction: column;
            gap: 0.4rem;
        }

        .channel-info-actions {
            display: flex;
            flex-direction: column;
            gap: 0.6rem;
        }

        .channel-info-actions .btn-secondary {
            text-align: center;
        }

        .channel-admin-actions {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .channel-info-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.55);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 12000;
            padding: 1.5rem;
        }

        .channel-info-overlay.active {
            display: flex;
        }

        .channel-info-drawer {
            width: min(420px, 92vw);
            max-height: 90vh;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 1rem;
            display: flex;
            flex-direction: column;
            gap: 1rem;
            overflow-y: auto;
        }

        .channel-info-drawer-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 1rem;
        }

        .channel-info-drawer-title {
            font-size: 1rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        .channel-info-close {
            background: transparent;
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            width: 32px;
            height: 32px;
            border-radius: 8px;
            cursor: pointer;
        }

        /* Theme toggle */
        .theme-toggle {
            width: 54px; height: 28px;
            border-radius: 999px;
            background: var(--bg-tertiary);
            border: 1px solid var(--glass-border);
            position: relative;
            cursor: pointer;
            transition: background var(--transition-fast), border-color var(--transition-fast);
        }

        .theme-toggle::after {
            content: '';
            position: absolute;
            top: 3px; left: 3px;
            width: 22px; height: 22px;
            border-radius: 50%;
            background: linear-gradient(135deg, #ffd166, #ffb347);
            box-shadow: 0 4px 12px rgba(0,0,0,0.25);
            transition: transform var(--transition-fast), background var(--transition-fast);
        }

        body[data-theme="light"] .theme-toggle { background: #e9e7ff; }
        body[data-theme="light"] .theme-toggle::after {
            transform: translateX(24px);
            background: linear-gradient(135deg, #1e293b, #0f172a);
        }

        /* Xipher-like overrides */
        body {
            --bg-primary: #0e1621;
            --bg-secondary: #17212b;
            --bg-tertiary: #1f2a36;
            --glass: #17212b;
            --glass-border: #243140;
            --accent-color: #4c9ce4;
            --accent-strong: #3a84c6;
            --accent-soft: #6ab4ff;
            --folder-rail-active-bg: linear-gradient(165deg, rgba(76, 156, 228, 0.24), rgba(58, 132, 198, 0.22));
            --folder-rail-active-shadow: 0 8px 16px rgba(15, 38, 63, 0.28);
            --folder-rail-active-icon-bg: rgba(255, 255, 255, 0.14);
            --folder-rail-active-icon-border: rgba(255, 255, 255, 0.22);
            --text-primary: #e6edf3;
            --text-secondary: #a3afbf;
            --text-muted: #6d7a89;
            --transfer-ring-track: rgba(255, 255, 255, 0.25);
            --transfer-ring-progress: var(--accent-color);
            --transfer-ring-bg: rgba(0, 0, 0, 0.45);
            --transfer-ring-icon: #ffffff;
            --border-color: #243140;
            --border-hover: #2f3e52;
            --gradient-card: none;
            --gradient-purple: linear-gradient(135deg, #4c9ce4, #3a84c6);
            --shadow-glow: none;
            --shadow-glow-strong: none;
            --shadow-soft: none;
            --msg-bubble-in: #182533;
            --msg-bubble-out: #2b5278;
            --surface-elevated: #1b2633;
            --stroke-strong: rgba(255, 255, 255, 0.08);
            --avatar-bg: #2b3b4f;
            --avatar-text: #e6edf3;
            --purple-primary: var(--accent-color);
            background: var(--bg-primary);
            background-image: none;
        }

        body[data-theme="light"] {
            --bg-primary: #f5f7fb;
            --bg-secondary: #ffffff;
            --bg-tertiary: #f1f3f6;
            --glass: #ffffff;
            --glass-border: #e3e8ef;
            --accent-color: #3390ec;
            --accent-strong: #2b7fd0;
            --accent-soft: #6ab4ff;
            --folder-rail-active-shadow: 0 8px 14px rgba(51, 144, 236, 0.18);
            --folder-rail-active-icon-bg: rgba(255, 255, 255, 0.24);
            --folder-rail-active-icon-border: rgba(255, 255, 255, 0.32);
            --text-primary: #1f2a33;
            --text-secondary: #4a5563;
            --text-muted: #7a869a;
            --transfer-ring-track: rgba(0, 0, 0, 0.18);
            --transfer-ring-progress: var(--accent-color);
            --transfer-ring-bg: rgba(15, 23, 42, 0.55);
            --transfer-ring-icon: #ffffff;
            --border-color: #e1e7ef;
            --border-hover: #cad3df;
            --msg-bubble-in: #ffffff;
            --msg-bubble-out: #e6f2ff;
            --surface-elevated: #ffffff;
            --stroke-strong: rgba(0, 0, 0, 0.06);
            --avatar-bg: #dbe6f2;
            --avatar-text: #2b3b4f;
            background: var(--bg-primary);
            background-image: none;
        }

        .chat-container {
            --sidebar-width: 320px;
            --info-width: 320px;
            grid-template-columns: var(--sidebar-width) minmax(0, 1fr) var(--info-width);
            background: var(--bg-primary);
            min-width: 0;
        }

        .chats-sidebar {
            background: var(--bg-secondary);
            border-right: 1px solid var(--border-color);
            box-shadow: none;
            backdrop-filter: none;
            width: 100%;
            min-width: 0;
            max-width: 100%;
            box-sizing: border-box;
        }

        .chats-header,
        .chat-type-tabs,
        .chats-search {
            background: var(--bg-secondary);
            border-color: var(--border-color);
        }

        .chats-header,
        .chat-header {
            min-height: 64px;
            padding: 0 16px;
        }

        .header-action-btn {
            background: transparent;
            border: 1px solid var(--border-color);
            box-shadow: none;
        }

        .header-action-btn:hover {
            background: rgba(255, 255, 255, 0.06);
            transform: none;
        }

        body[data-theme="light"] .header-action-btn:hover {
            background: rgba(0, 0, 0, 0.04);
        }

        .user-avatar {
            background: var(--avatar-bg);
            color: var(--avatar-text);
            box-shadow: none;
        }

        .user-avatar:hover {
            transform: none;
        }

        .search-input {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            box-shadow: none;
        }

        .search-input:focus {
            border-color: var(--accent-color);
            box-shadow: 0 0 0 2px rgba(76, 156, 228, 0.15);
        }

        .chats-list {
            padding: 0.25rem 0;
            overflow-x: hidden;
        }

        .chat-item {
            border-left: none;
            border-bottom: 1px solid var(--border-color);
            border-radius: 0;
            margin: 0;
            background: transparent;
            transform: none;
            padding: 0.65rem 1rem;
            min-height: 68px;
            width: 100%;
            min-width: 0;
            overflow: hidden;
            box-sizing: border-box;
        }

        .chat-item:hover {
            background: rgba(255, 255, 255, 0.04);
            border-left-color: transparent;
            transform: none;
        }

        body[data-theme="light"] .chat-item:hover {
            background: rgba(0, 0, 0, 0.04);
        }

        .chat-item.active {
            background: rgba(76, 156, 228, 0.28);
            border-left-color: transparent;
            box-shadow: none;
        }

        body[data-theme="light"] .chat-item.active {
            background: rgba(51, 144, 236, 0.22);
        }

        .chat-item.active::before {
            content: none;
        }

        .chat-header-row {
            gap: 0.75rem;
            min-width: 0;
            align-items: center;
        }

        .chat-name {
            flex: 1;
            min-width: 0;
        }

        .chat-preview {
            background: transparent;
            border: none;
            border-radius: 0;
            box-shadow: none;
            padding: 0;
            width: 100%;
            max-width: 100%;
            flex-direction: row;
            align-items: center;
            gap: 0.5rem;
            min-width: 0;
            overflow: hidden;
            backdrop-filter: none;
        }

        .chat-preview:hover {
            box-shadow: none;
            transform: none;
        }

        .chat-preview-text {
            flex: 1;
            min-width: 0;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .chat-unread {
            flex-shrink: 0;
        }

        .chat-time {
            margin-left: auto;
            flex-shrink: 0;
        }

        .chat-avatar,
        .chat-header-avatar {
            background: var(--avatar-bg);
            color: var(--avatar-text);
            box-shadow: none;
        }

        .chat-unread {
            background: var(--accent-color);
            box-shadow: none;
        }

        .chat-status {
            box-shadow: none;
        }

        .chat-main {
            background: var(--bg-primary);
        }

        .chat-header {
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border-color);
            box-shadow: none;
            backdrop-filter: none;
        }

        .chat-action-btn:hover {
            background: var(--bg-tertiary);
        }

        .chat-messages {
            background: var(--bg-primary);
        }

        .message {
            transition: none;
            filter: none;
        }

        .message:hover {
            transform: none;
            filter: none;
        }

        .message-highlight {
            box-shadow: 0 0 0 2px var(--accent-color);
            border-radius: 16px;
        }

        .message-bubble {
            background: var(--msg-bubble-in);
            border: none;
            border-radius: 16px;
            backdrop-filter: none;
        }

        .message.sent .message-bubble {
            background: var(--msg-bubble-out);
            color: #f5faff;
        }

        .message-bubble::after {
            display: none;
        }

        .message-time {
            color: var(--text-muted);
        }

        .message.sent .message-time {
            color: rgba(245, 250, 255, 0.7);
        }

        .chat-input-area {
            background: var(--bg-secondary);
            border-top: 1px solid var(--border-color);
            backdrop-filter: none;
            overflow: visible;
        }

        .chat-input-wrapper {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            box-shadow: none;
            align-items: center;
        }

        .chat-input {
            padding: 0.35rem 0.4rem;
            line-height: 1.4;
        }

        .chat-action-icon {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border-color);
            color: var(--text-secondary);
        }

        .chat-action-icon:hover {
            background: rgba(255, 255, 255, 0.06);
            border-color: var(--border-color);
            transform: none;
        }

        body[data-theme="light"] .chat-action-icon {
            background: rgba(0, 0, 0, 0.04);
        }

        body[data-theme="light"] .chat-action-icon:hover {
            background: rgba(0, 0, 0, 0.04);
        }

        body[data-theme="light"] .attach-menu {
            background: #ffffff;
            border-color: var(--border-color);
            box-shadow: 0 12px 28px rgba(17, 24, 39, 0.12);
            backdrop-filter: none;
        }

        body[data-theme="light"] .attach-menu-item:hover {
            background: rgba(0, 0, 0, 0.04);
            border-color: var(--border-color);
        }

        body[data-theme="light"] .ttl-menu {
            background: #ffffff;
            border-color: var(--border-color);
            box-shadow: 0 12px 28px rgba(17, 24, 39, 0.12);
            backdrop-filter: none;
        }

        body[data-theme="light"] .ttl-menu-item:hover {
            background: rgba(0, 0, 0, 0.04);
            border-color: var(--border-color);
        }

        body[data-theme="light"] .ttl-menu-item.is-selected {
            background: rgba(79, 70, 229, 0.12);
            border-color: rgba(79, 70, 229, 0.3);
        }

        body[data-theme="light"] .attach-menu-icon:not(.is-file):not(.is-location):not(.is-live):not(.is-checklist):not(.is-gift) {
            background: rgba(0, 0, 0, 0.06);
        }

        body[data-theme="light"] .attach-menu-pill {
            background: rgba(248, 113, 113, 0.12);
            color: #dc2626;
            border-color: rgba(248, 113, 113, 0.3);
        }

        body[data-theme="light"] .live-location-bar {
            background: rgba(0, 0, 0, 0.03);
            border-color: var(--border-color);
        }

        body[data-theme="light"] .live-location-stop {
            background: rgba(239, 68, 68, 0.08);
            color: #dc2626;
            border-color: rgba(239, 68, 68, 0.2);
        }

        body[data-theme="light"] .live-location-stop:hover {
            background: rgba(239, 68, 68, 0.14);
        }

        body[data-theme="light"] .live-location-option:hover {
            background: rgba(51, 144, 236, 0.12);
        }

        .chat-send-btn {
            background: var(--accent-color);
            box-shadow: none;
        }

        .chat-send-btn:hover {
            transform: none;
            box-shadow: none;
        }

        .message-context-menu {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            box-shadow: 0 12px 28px rgba(0, 0, 0, 0.35);
            backdrop-filter: none;
        }

        .context-menu-item:hover {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }

        .context-menu-item.is-danger {
            color: var(--error-color);
        }

        .context-menu-item.is-danger:hover {
            background: rgba(239, 68, 68, 0.12);
            color: var(--error-color);
        }

        .btn-danger {
            padding: 0.875rem 2rem;
            border-radius: 8px;
            font-weight: 600;
            border: none;
            cursor: pointer;
            background: var(--error-color);
            color: white;
            box-shadow: 0 10px 22px rgba(239, 68, 68, 0.35);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 14px 28px rgba(239, 68, 68, 0.45);
        }

        .info-panel {
            background: var(--bg-secondary);
            border-left: 1px solid var(--border-color);
            box-shadow: none;
            backdrop-filter: none;
        }

        .theme-toggle {
            border: 1px solid var(--border-color);
            background: var(--bg-tertiary);
        }

        .chats-header--compact {
            display: flex;
            align-items: center;
            justify-content: flex-start;
            gap: 0.75rem;
            padding: 0 16px;
            min-height: 64px;
        }

        .sidebar-menu-btn {
            width: 38px;
            height: 38px;
            border-radius: 10px;
            background: transparent;
            border: 1px solid var(--border-color);
            display: inline-flex;
            flex-direction: column;
            gap: 4px;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background var(--transition-fast), border-color var(--transition-fast);
        }

        .sidebar-menu-btn span {
            display: block;
            width: 18px;
            height: 2px;
            background: var(--text-primary);
            border-radius: 2px;
            opacity: 0.9;
        }

        .sidebar-menu-btn:hover {
            background: var(--bg-tertiary);
            border-color: var(--border-hover);
        }

        .sidebar-title {
            font-size: 0.95rem;
            font-weight: 600;
            color: var(--text-primary);
            letter-spacing: 0.3px;
        }

        .chats-search {
            padding: 1.15rem 1rem 0.95rem;
        }

        .search-field {
            display: flex;
            align-items: center;
            gap: 0.7rem;
            padding: 0.75rem 0.95rem;
            min-height: 50px;
            border-radius: 12px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            transition: border-color var(--transition-fast), box-shadow var(--transition-fast);
        }

        .search-field:focus-within {
            border-color: var(--accent-color);
            box-shadow: 0 0 0 2px rgba(76, 156, 228, 0.15);
        }

        .search-icon {
            font-size: 1rem;
            color: var(--text-muted);
        }

        .chats-search .search-input {
            border: none;
            background: transparent;
            padding: 0.2rem 0;
            font-size: 0.98rem;
            box-shadow: none;
        }

        .chats-search .search-input:focus {
            outline: none;
            border-color: transparent;
            box-shadow: none;
        }

        .app-menu-overlay {
            position: fixed;
            inset: 0;
            background: rgba(6, 12, 18, 0.45);
            backdrop-filter: blur(8px);
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.2s ease;
            z-index: 200;
        }

        .app-menu-overlay.show {
            opacity: 1;
            pointer-events: auto;
        }

        .app-menu {
            position: fixed;
            top: 0;
            left: 0;
            height: 100vh;
            width: 320px;
            max-width: 86vw;
            background: var(--bg-secondary);
            border-right: 1px solid var(--border-color);
            transform: translateX(-105%);
            transition: transform 0.25s ease;
            z-index: 210;
            display: flex;
            flex-direction: column;
            box-shadow: 12px 0 30px rgba(0, 0, 0, 0.35);
        }

        .app-menu.show {
            transform: translateX(0);
        }

        .app-menu-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1rem;
            border-bottom: 1px solid var(--border-color);
        }

        .app-menu-user {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .app-menu-avatar {
            width: 48px;
            height: 48px;
        }

        .app-menu-user-info {
            display: flex;
            flex-direction: column;
            gap: 0.2rem;
        }

        .app-menu-name {
            font-weight: 600;
            font-size: 0.95rem;
            color: var(--text-primary);
        }

        .app-menu-status {
            font-size: 0.8rem;
            color: var(--text-muted);
        }

        .app-menu-close {
            width: 34px;
            height: 34px;
            border-radius: 10px;
            border: 1px solid var(--border-color);
            background: transparent;
            color: var(--text-secondary);
            cursor: pointer;
        }

        .app-menu-close:hover {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }

        .app-menu-body {
            flex: 1;
            overflow-y: auto;
        }

        .app-menu-section {
            padding: 0.35rem 0;
            border-bottom: 1px solid var(--border-color);
        }

        .app-menu-section:last-child {
            border-bottom: none;
        }

        .app-menu-item {
            width: 100%;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.65rem 1.1rem;
            background: transparent;
            border: none;
            color: var(--text-primary);
            font-size: 0.95rem;
            cursor: pointer;
            text-align: left;
        }

        .app-menu-item:hover {
            background: var(--bg-tertiary);
        }

        .menu-item-icon {
            width: 22px;
            text-align: center;
            font-size: 1rem;
            color: var(--accent-color);
        }

        .menu-item-note {
            margin-left: auto;
            font-size: 0.75rem;
            color: var(--text-muted);
        }

        /* Wallet Menu Item */
        .app-menu-item--wallet {
            background: linear-gradient(135deg, rgba(42, 171, 238, 0.1) 0%, rgba(30, 136, 229, 0.05) 100%);
            border-left: 3px solid #2AABEE;
            margin: 0.25rem 0.5rem;
            border-radius: 0 12px 12px 0;
            padding-left: calc(1.1rem - 3px);
        }
        
        .app-menu-item--wallet:hover {
            background: linear-gradient(135deg, rgba(42, 171, 238, 0.2) 0%, rgba(30, 136, 229, 0.1) 100%);
        }
        
        .app-menu-item--wallet .menu-item-icon {
            color: #2AABEE;
            font-size: 1.1rem;
        }
        
        .wallet-balance-badge {
            margin-left: auto;
            background: linear-gradient(135deg, #2AABEE, #1E88E5);
            color: #fff;
            padding: 0.25rem 0.6rem;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
            box-shadow: 0 2px 8px rgba(42, 171, 238, 0.3);
        }

        .app-menu-item--toggle {
            justify-content: space-between;
        }

        .menu-toggle-label {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .menu-toggle-text {
            display: flex;
            flex-direction: column;
            line-height: 1.1;
        }

        .menu-toggle-state {
            font-size: 0.75rem;
            color: var(--text-muted);
        }

        .switch {
            position: relative;
            width: 46px;
            height: 26px;
            display: inline-block;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .switch-slider {
            position: absolute;
            inset: 0;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 999px;
            transition: background var(--transition-fast), border-color var(--transition-fast);
        }

        .switch-slider::after {
            content: '';
            position: absolute;
            top: 2px;
            left: 2px;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--text-primary);
            transition: transform var(--transition-fast), background var(--transition-fast);
        }

        .switch input:checked + .switch-slider {
            background: rgba(76, 156, 228, 0.3);
            border-color: var(--accent-color);
        }

        .switch input:checked + .switch-slider::after {
            transform: translateX(20px);
            background: #ffffff;
        }

        .settings-overlay {
            position: fixed;
            inset: 0;
            display: none;
            align-items: center;
            justify-content: center;
            background: rgba(5, 10, 16, 0.55);
            backdrop-filter: blur(10px);
            z-index: 10500;
        }

        .settings-overlay.show {
            display: flex;
        }

        .settings-panel {
            width: min(1100px, 95vw);
            height: min(92vh, 900px);
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.35);
        }

        .settings-topbar {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.85rem 1.2rem;
            border-bottom: 1px solid var(--border-color);
            background: var(--bg-secondary);
        }

        .settings-title {
            font-weight: 600;
            font-size: 1.05rem;
            color: var(--text-primary);
        }

        .settings-top-actions {
            display: flex;
            align-items: center;
            gap: 0.4rem;
        }

        .settings-icon-btn {
            width: 34px;
            height: 34px;
            border-radius: 10px;
            border: 1px solid var(--border-color);
            background: transparent;
            color: var(--text-secondary);
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        .settings-icon-btn:hover {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }

        .settings-more {
            position: relative;
        }

        .settings-more-menu {
            position: absolute;
            top: 42px;
            right: 0;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.35);
            padding: 0.35rem 0;
            display: none;
            min-width: 190px;
            z-index: 10;
        }

        .settings-more-menu.show {
            display: block;
        }

        .settings-more-menu button {
            width: 100%;
            padding: 0.65rem 0.9rem;
            border: none;
            background: transparent;
            color: var(--text-primary);
            text-align: left;
            cursor: pointer;
        }

        .settings-more-menu button:hover {
            background: var(--bg-tertiary);
        }

        .settings-body {
            display: grid;
            grid-template-columns: 260px minmax(0, 1fr);
            flex: 1;
            min-height: 0;
        }

        .settings-nav {
            border-right: 1px solid var(--border-color);
            padding: 0.8rem 0.6rem;
            overflow-y: auto;
            background: var(--bg-secondary);
        }

        .settings-nav-item {
            width: 100%;
            text-align: left;
            border: none;
            background: transparent;
            color: var(--text-secondary);
            padding: 0.6rem 0.8rem;
            border-radius: 10px;
            cursor: pointer;
            font-size: 0.95rem;
        }

        .settings-nav-item.active {
            background: rgba(76, 156, 228, 0.18);
            color: var(--text-primary);
        }

        .settings-content {
            padding: 1rem 1.3rem;
            overflow-y: auto;
        }

        .settings-section {
            display: none;
        }

        .settings-section.active {
            display: block;
        }

        .settings-card {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 1rem;
            margin-bottom: 1rem;
        }

        .settings-card h3 {
            margin: 0 0 0.75rem 0;
            font-size: 1rem;
            color: var(--text-primary);
        }

        .settings-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 1rem;
            padding: 0.4rem 0;
        }

        .settings-row label {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .settings-inline {
            display: flex;
            flex: 1;
            gap: 0.6rem;
            justify-content: flex-end;
            flex-wrap: wrap;
        }

        .settings-inline .settings-select {
            flex: 1;
            min-width: 120px;
        }

        .settings-input,
        .settings-select {
            width: 100%;
            padding: 0.55rem 0.75rem;
            border-radius: 10px;
            border: 1px solid var(--border-color);
            background: var(--bg-secondary);
            color: var(--text-primary);
        }

        .settings-textarea {
            min-height: 90px;
            resize: vertical;
        }

        .settings-input[disabled] {
            opacity: 0.7;
            cursor: not-allowed;
        }

        .settings-divider {
            height: 1px;
            background: var(--border-color);
            margin: 0.8rem 0;
        }

        .settings-avatar-row {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .settings-avatar {
            width: 72px;
            height: 72px;
            border-radius: 50%;
            background: var(--avatar-bg);
            color: var(--avatar-text);
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            font-weight: 700;
            font-size: 1.4rem;
        }

        .settings-actions {
            display: flex;
            gap: 0.6rem;
            flex-wrap: wrap;
        }

        .settings-channel-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
            gap: 0.7rem;
        }

        .channel-card {
            padding: 0.75rem;
            border-radius: 12px;
            border: 1px solid var(--border-color);
            background: var(--bg-secondary);
            cursor: pointer;
            position: relative;
            transition: border-color var(--transition-fast), background var(--transition-fast), transform var(--transition-fast);
        }

        .channel-card.active {
            border-color: var(--accent-color);
            background: rgba(76, 156, 228, 0.16);
            transform: translateY(-1px);
        }

        .channel-card.active::after {
            content: "✓";
            position: absolute;
            top: 10px;
            right: 10px;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--accent-color);
            color: #fff;
            font-size: 0.75rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .settings-note {
            color: var(--text-muted);
            font-size: 0.85rem;
        }

        .settings-list {
            display: flex;
            flex-direction: column;
            gap: 0.6rem;
        }

        .settings-list-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 0.75rem;
            padding: 0.65rem 0.75rem;
            border-radius: 12px;
            border: 1px solid var(--border-color);
            background: var(--bg-secondary);
            cursor: pointer;
        }

        .settings-list-item:hover {
            background: var(--bg-tertiary);
        }

        .settings-list-meta {
            color: var(--text-muted);
            font-size: 0.8rem;
        }

        .settings-list-actions {
            display: flex;
            gap: 0.4rem;
        }

        /* Premium */
        .premium-shell {
            display: grid;
            grid-template-columns: minmax(0, 1fr) minmax(0, 1fr);
            gap: 1rem;
        }

        .premium-card {
            position: relative;
            overflow: hidden;
        }

        .premium-main {
            grid-column: 1 / -1;
            padding: 1.2rem;
        }

        .premium-hero {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            border-radius: 16px;
            border: 1px solid rgba(96, 165, 250, 0.28);
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.18), rgba(13, 22, 36, 0.9));
            position: relative;
            overflow: hidden;
        }

        .premium-hero::after {
            content: '';
            position: absolute;
            width: 220px;
            height: 220px;
            right: -80px;
            top: -80px;
            background: radial-gradient(circle, rgba(167, 139, 250, 0.45), transparent 65%);
            opacity: 0.8;
        }

        .premium-hero-icon {
            width: 64px;
            height: 64px;
            border-radius: 18px;
            background: linear-gradient(135deg, #60a5fa, #a78bfa, #f472b6);
            display: flex;
            align-items: center;
            justify-content: center;
            color: #fff;
            font-size: 1.6rem;
            box-shadow: 0 12px 30px rgba(72, 99, 244, 0.35);
            z-index: 1;
        }

        .premium-hero-copy {
            display: grid;
            gap: 0.35rem;
            z-index: 1;
        }

        .premium-title {
            font-size: 1.4rem;
            font-weight: 700;
            color: var(--text-primary);
            margin: 0;
        }

        .premium-subtitle {
            margin: 0;
            color: var(--text-secondary);
        }

        .premium-status-row {
            display: flex;
            flex-wrap: wrap;
            gap: 0.6rem;
            align-items: center;
            margin-top: 0.75rem;
        }

        .premium-status-pill {
            padding: 0.25rem 0.7rem;
            border-radius: 999px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background: rgba(255, 255, 255, 0.08);
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .premium-status-pill.active {
            border-color: rgba(96, 165, 250, 0.7);
            background: rgba(96, 165, 250, 0.2);
        }

        .premium-limit-note {
            color: var(--text-secondary);
            font-size: 0.85rem;
        }

        .premium-expiry-note {
            display: inline-flex;
            align-items: center;
            padding: 0.2rem 0.6rem;
            border-radius: 999px;
            font-size: 0.78rem;
            color: var(--text-secondary);
            background: rgba(15, 23, 42, 0.5);
            border: 1px solid rgba(96, 165, 250, 0.2);
        }

        .premium-payment-status,
        .premium-payment-timer {
            display: inline-flex;
            align-items: center;
            padding: 0.2rem 0.6rem;
            border-radius: 999px;
            font-size: 0.78rem;
            border: 1px solid rgba(255, 255, 255, 0.14);
            background: rgba(15, 23, 42, 0.45);
            color: var(--text-secondary);
        }

        .premium-payment-status {
            font-weight: 600;
        }

        .premium-payment-status.is-pending {
            border-color: rgba(251, 191, 36, 0.35);
            background: rgba(251, 191, 36, 0.2);
            color: #fde68a;
        }

        .premium-payment-status.is-success {
            border-color: rgba(34, 197, 94, 0.35);
            background: rgba(34, 197, 94, 0.2);
            color: #bbf7d0;
        }

        .premium-payment-modal {
            max-width: 520px;
            width: 92%;
            background: linear-gradient(160deg, rgba(15, 23, 42, 0.96), rgba(10, 14, 26, 0.98));
            border: 1px solid rgba(96, 165, 250, 0.25);
        }

        #premiumPaymentModal {
            z-index: 20000;
        }

        .premium-payment-summary {
            padding: 0.9rem;
            border-radius: 14px;
            border: 1px solid rgba(96, 165, 250, 0.18);
            background: rgba(15, 23, 42, 0.7);
            display: grid;
            gap: 0.35rem;
        }

        .premium-payment-plan {
            font-weight: 600;
            color: var(--text-primary);
        }

        .premium-payment-amount {
            font-size: 1.4rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        .premium-payment-methods {
            display: grid;
            gap: 0.6rem;
            margin-top: 0.9rem;
        }

        .premium-payment-method {
            display: flex;
            align-items: center;
            gap: 0.65rem;
            padding: 0.75rem 0.9rem;
            border-radius: 12px;
            border: 1px solid rgba(148, 163, 184, 0.2);
            background: rgba(15, 23, 42, 0.55);
            cursor: pointer;
            transition: border-color 0.2s ease, background 0.2s ease;
        }

        .premium-payment-method:hover {
            border-color: rgba(96, 165, 250, 0.5);
            background: rgba(30, 41, 59, 0.7);
        }

        .premium-payment-method input {
            accent-color: var(--purple-primary);
        }

        .premium-payment-method-title {
            font-weight: 600;
            color: var(--text-primary);
        }

        .premium-payment-actions {
            display: flex;
            flex-wrap: wrap;
            gap: 0.6rem;
            margin-top: 1rem;
        }

        .premium-payment-footnote {
            margin-top: 0.6rem;
            font-size: 0.75rem;
            color: var(--text-muted);
        }

        .premium-plan-selector {
            display: grid;
            gap: 0.6rem;
            margin-top: 1rem;
        }

        .premium-plan-option {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.85rem 1rem;
            border-radius: 12px;
            border: 1px solid var(--border-color);
            background: var(--bg-secondary);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .premium-plan-option:hover {
            border-color: rgba(96, 165, 250, 0.6);
        }

        .premium-plan-option.is-active {
            border-color: rgba(96, 165, 250, 0.85);
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.18), rgba(15, 23, 42, 0.95));
            box-shadow: 0 0 0 1px rgba(96, 165, 250, 0.25) inset;
        }

        .premium-plan-radio {
            accent-color: var(--purple-primary);
        }

        .premium-plan-info {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 0.75rem;
            width: 100%;
            min-width: 0;
        }

        .premium-plan-meta {
            display: grid;
            gap: 0.15rem;
        }

        .premium-plan-title {
            font-weight: 600;
            color: var(--text-primary);
        }

        .premium-plan-price {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        .premium-plan-billing {
            font-size: 0.75rem;
            color: var(--text-muted);
        }

        .premium-plan-badge {
            padding: 0.25rem 0.6rem;
            border-radius: 999px;
            border: 1px solid rgba(167, 139, 250, 0.6);
            background: rgba(167, 139, 250, 0.18);
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 0.06em;
            color: var(--text-primary);
            flex-shrink: 0;
        }

        .premium-cta-row {
            display: flex;
            flex-wrap: wrap;
            gap: 0.6rem;
            margin-top: 1rem;
        }

        .premium-cta {
            flex: 1 1 200px;
            justify-content: center;
        }

        .premium-stats {
            margin-top: 1rem;
            display: grid;
            grid-template-columns: repeat(3, minmax(0, 1fr));
            gap: 0.6rem;
        }

        .premium-stat {
            border-radius: 12px;
            padding: 0.8rem;
            border: 1px solid var(--glass-border);
            background: rgba(0, 0, 0, 0.25);
            text-align: center;
        }

        .premium-stat.accent {
            border-color: rgba(96, 165, 250, 0.55);
            background: rgba(96, 165, 250, 0.16);
        }

        .premium-stat-value {
            font-size: 1.4rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        .premium-stat-label {
            font-size: 0.8rem;
            color: var(--text-muted);
            margin-top: 0.15rem;
        }

        .premium-feature-list {
            display: grid;
            gap: 0.85rem;
            margin-top: 0.8rem;
        }

        .premium-feature {
            display: flex;
            gap: 0.75rem;
            align-items: flex-start;
            padding: 0.35rem 0;
        }

        .premium-feature-icon {
            width: 36px;
            height: 36px;
            border-radius: 10px;
            color: #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 8px 18px rgba(15, 23, 42, 0.35);
            flex-shrink: 0;
        }

        .premium-feature-icon svg {
            width: 20px;
            height: 20px;
            stroke: currentColor;
            stroke-width: 1.8;
            stroke-linecap: round;
            stroke-linejoin: round;
            fill: none;
        }

        .premium-feature-icon.icon-limits {
            background: linear-gradient(135deg, #60a5fa, #8b5cf6);
        }

        .premium-feature-icon.icon-video {
            background: linear-gradient(135deg, #34d399, #22c55e);
        }

        .premium-feature-icon.icon-quality {
            background: linear-gradient(135deg, #38bdf8, #0ea5e9);
        }

        .premium-feature-icon.icon-bots {
            background: linear-gradient(135deg, #22d3ee, #14b8a6);
        }

        .premium-feature-icon.icon-badge {
            background: linear-gradient(135deg, #f472b6, #a855f7);
        }

        .premium-feature-icon.icon-business {
            background: linear-gradient(135deg, #f59e0b, #f97316);
        }

        .premium-feature-icon.icon-badge svg {
            fill: currentColor;
            stroke: none;
        }

        .premium-feature-title {
            font-weight: 600;
            color: var(--text-primary);
        }

        .premium-feature-desc {
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-top: 0.15rem;
        }

        .premium-business-header {
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            gap: 0.75rem;
        }

        .business-hours-grid {
            display: grid;
            gap: 0.65rem;
            margin-top: 0.8rem;
        }

        .business-hours-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 0.75rem;
            padding: 0.55rem 0.6rem;
            border-radius: 12px;
            border: 1px solid var(--border-color);
            background: var(--bg-secondary);
        }

        .business-hours-row.is-disabled {
            opacity: 0.6;
        }

        .business-day-label {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.85rem;
            color: var(--text-primary);
        }

        .business-time-range {
            display: flex;
            align-items: center;
            gap: 0.45rem;
            flex-wrap: wrap;
        }

        .business-time-sep {
            color: var(--text-muted);
            font-size: 0.85rem;
        }

        .business-time-input {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            border-radius: 8px;
            padding: 0.35rem 0.5rem;
            font-size: 0.8rem;
        }

        .premium-business-actions {
            margin-top: 0.8rem;
            display: flex;
            justify-content: flex-end;
        }

        .premium-business-lock {
            display: none;
            margin-top: 0.75rem;
            padding: 0.65rem 0.8rem;
            border-radius: 10px;
            border: 1px dashed rgba(96, 165, 250, 0.5);
            color: var(--text-secondary);
            font-size: 0.85rem;
        }

        .premium-business.is-locked .business-hours-grid,
        .premium-business.is-locked .premium-business-actions {
            opacity: 0.5;
            pointer-events: none;
        }

        .premium-business.is-locked .premium-business-lock {
            display: block;
        }

        .premium-badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: linear-gradient(135deg, #60a5fa, #a78bfa, #f472b6);
            color: #fff;
            font-size: 10px;
            font-weight: 700;
            box-shadow: 0 6px 14px rgba(96, 165, 250, 0.35);
            flex-shrink: 0;
        }

        .premium-badge--large {
            width: 18px;
            height: 18px;
            font-size: 11px;
        }

        .premium-badge--cta {
            cursor: pointer;
            background: linear-gradient(135deg, rgba(148, 163, 184, 0.9), rgba(59, 130, 246, 0.9));
            box-shadow: 0 6px 14px rgba(148, 163, 184, 0.35);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .premium-badge--cta:hover {
            transform: translateY(-1px) scale(1.05);
            box-shadow: 0 8px 16px rgba(59, 130, 246, 0.4);
        }

        .chat-name {
            display: flex;
            align-items: center;
            gap: 0.35rem;
            flex: 1;
            min-width: 0;
            overflow: visible;
            white-space: normal;
        }

        .chat-name-text {
            flex: 1;
            min-width: 0;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .profile-hours-card {
            border: 1px solid var(--border-color);
            background: var(--bg-secondary);
            border-radius: 14px;
            padding: 0.75rem 0.85rem;
            margin-bottom: 12px;
            text-align: left;
            transition: border-color 0.2s ease, box-shadow 0.25s ease, transform 0.25s ease;
        }

        .profile-hours-summary {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 0.75rem;
            list-style: none;
            cursor: pointer;
        }

        .profile-hours-summary::-webkit-details-marker {
            display: none;
        }

        .profile-hours-heading {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }

        .profile-hours-title {
            color: var(--text-secondary);
            font-size: 12px;
            font-weight: 700;
        }

        .profile-hours-status {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.85rem;
        }

        .profile-hours-pill {
            display: inline-flex;
            align-items: center;
            padding: 0.1rem 0.55rem;
            border-radius: 999px;
            font-size: 0.72rem;
            font-weight: 700;
            border: 1px solid transparent;
        }

        .profile-hours-pill.is-open {
            color: var(--success);
            border-color: rgba(53, 212, 154, 0.35);
            background: rgba(53, 212, 154, 0.15);
        }

        .profile-hours-pill.is-closed {
            color: var(--error-color);
            border-color: rgba(239, 68, 68, 0.35);
            background: rgba(239, 68, 68, 0.12);
        }

        .profile-hours-next {
            color: var(--text-secondary);
        }

        .profile-hours-chevron {
            color: var(--text-muted);
            font-size: 0.85rem;
            transition: transform 0.2s ease;
        }

        .profile-hours-card[open] .profile-hours-chevron {
            transform: rotate(180deg);
        }

        .profile-hours-card[open] {
            border-color: rgba(157, 0, 255, 0.3);
            box-shadow: 0 14px 30px rgba(0, 0, 0, 0.35);
            transform: translateY(-1px);
        }

        .profile-hours-list {
            margin-top: 0.75rem;
            display: grid;
            gap: 0.4rem;
        }

        .profile-hours-card[open] .profile-hours-list {
            animation: profileHoursReveal 0.3s ease;
        }

        .profile-hours-row {
            display: flex;
            justify-content: space-between;
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .profile-hours-row.is-disabled {
            color: var(--text-muted);
        }

        .profile-hours-row.is-today {
            color: var(--text-primary);
            font-weight: 600;
        }

        .profile-hours-day {
            min-width: 38px;
        }

        .profile-hours-pill.is-open {
            animation: profilePillPulse 3.4s ease-in-out infinite;
        }

        @keyframes profileHoursReveal {
            from {
                opacity: 0;
                transform: translateY(-4px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes profilePillPulse {
            0%,
            100% {
                box-shadow: 0 0 0 rgba(53, 212, 154, 0);
            }
            50% {
                box-shadow: 0 0 16px rgba(53, 212, 154, 0.35);
            }
        }

        @media (prefers-reduced-motion: reduce) {
            .profile-hours-card,
            .profile-hours-chevron,
            .profile-hours-pill,
            .profile-hours-list {
                animation: none;
                transition: none;
            }
        }

        .friend-name {
            display: flex;
            align-items: center;
            gap: 0.35rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        #chatHeaderName {
            display: flex;
            align-items: center;
            gap: 0.4rem;
        }

        .btn-primary[disabled],
        .btn-secondary[disabled] {
            opacity: 0.55;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .btn-primary[disabled]::before,
        .btn-secondary[disabled]::before {
            display: none;
        }

        .faq-list details {
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 0.65rem 0.8rem;
            background: var(--bg-secondary);
        }

        .faq-list details + details {
            margin-top: 0.6rem;
        }

        .faq-list summary {
            cursor: pointer;
            color: var(--text-primary);
            font-weight: 600;
            list-style: none;
        }

        .faq-list summary::-webkit-details-marker {
            display: none;
        }

        .qr-overlay {
            position: fixed;
            inset: 0;
            display: none;
            align-items: center;
            justify-content: center;
            background: rgba(5, 10, 16, 0.55);
            backdrop-filter: blur(8px);
            z-index: 10600;
        }

        .qr-overlay.show {
            display: flex;
        }

        .qr-card {
            background: linear-gradient(135deg, rgba(157, 0, 255, 0.18), rgba(12, 18, 32, 0.92));
            border: 1px solid rgba(147, 51, 234, 0.45);
            border-radius: 16px;
            padding: 1.2rem;
            width: min(360px, 90vw);
            text-align: center;
            box-shadow: 0 18px 40px rgba(0, 0, 0, 0.35);
        }

        .qr-frame {
            background: #ffffff;
            padding: 0.8rem;
            border-radius: 12px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 0.75rem;
            border: 1px solid rgba(147, 51, 234, 0.2);
            box-shadow: 0 10px 24px rgba(0, 0, 0, 0.2);
        }

        .qr-frame img {
            width: 200px;
            height: 200px;
        }

        .qr-close {
            margin-top: 0.75rem;
            width: 100%;
        }

        body.menu-open,
        body.settings-open,
        body.qr-open {
            overflow: hidden;
        }

        @media (max-width: 900px) {
            .settings-panel {
                width: 96vw;
                height: 94vh;
            }

            .settings-body {
                grid-template-columns: 1fr;
            }

            .settings-nav {
                border-right: none;
                border-bottom: 1px solid var(--border-color);
                display: flex;
                gap: 0.5rem;
                overflow-x: auto;
                padding-bottom: 0.6rem;
            }

            .settings-nav-item {
                white-space: nowrap;
            }

            .premium-shell {
                grid-template-columns: 1fr;
            }
        }

        /* Scrollbar стилизация */
        .chats-list::-webkit-scrollbar,
        .chat-messages::-webkit-scrollbar {
            width: 8px;
        }

        .chats-list::-webkit-scrollbar-track,
        .chat-messages::-webkit-scrollbar-track {
            background: var(--bg-secondary);
        }

        .chats-list::-webkit-scrollbar-thumb,
        .chat-messages::-webkit-scrollbar-thumb {
            background: var(--accent-color);
            border-radius: 4px;
        }

        .chats-list::-webkit-scrollbar-thumb:hover,
        .chat-messages::-webkit-scrollbar-thumb:hover {
            background: var(--accent-soft);
        }

        /* Адаптивность */
        @media (max-width: 1200px) {
            .chat-container { grid-template-columns: 320px minmax(0, 1fr); }
            .info-panel { display: none; }
        }

        /* Мобильная адаптация */
        .mobile-nav-btn {
            position: fixed;
            top: calc(12px + env(safe-area-inset-top));
            left: calc(12px + env(safe-area-inset-left));
            z-index: 130;
            width: 44px;
            height: 44px;
            border-radius: 12px;
            border: none;
            background: var(--bg-secondary);
            color: var(--text-primary);
            font-size: 22px;
            display: none;
            align-items: center;
            justify-content: center;
            box-shadow: 0 8px 24px rgba(0,0,0,0.25);
        }

        .sidebar-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.35);
            backdrop-filter: blur(2px);
            z-index: 90;
            display: none;
        }

        .sidebar-overlay.active { display: block; }

        @media (max-width: 900px) {
            .chat-container {
                grid-template-columns: 1fr;
                position: relative;
                padding-top: 8px;
                height: 100dvh;
            }

            .mobile-nav-btn { display: flex; }

            .chats-sidebar {
                width: 100%;
                max-width: 100%;
                position: fixed;
                top: 0;
                left: 0;
                height: 100dvh;
                z-index: 120;
                background: var(--bg-primary);
                box-shadow: 16px 0 40px rgba(0,0,0,0.35);
                transform: translateX(-110%);
                transition: transform 0.25s ease;
                display: flex;
            }

            .chats-sidebar.show {
                transform: translateX(0);
            }

            body.sidebar-open .chat-main {
                display: none;
            }

            body.sidebar-open .info-panel {
                display: none;
            }

            .chat-header {
                padding: 0 1rem;
                padding-left: 3.5rem;
            }

            .chat-messages {
                padding: 1rem 0.9rem;
                gap: 1rem;
            }

            .chat-input-area {
                padding: 0.85rem 0.9rem;
                padding-bottom: calc(0.85rem + env(safe-area-inset-bottom));
            }

            .chat-main {
                min-height: 100dvh;
            }
        }

        .chats-body {
            flex: 1;
            min-height: 0;
            display: flex;
            overflow: hidden;
        }

        .folders-rail {
            width: 72px;
            background: var(--bg-secondary);
            border-right: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 0.75rem 0;
            gap: 0.5rem;
            min-height: 0;
        }

        .folders-rail-list {
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.4rem;
            overflow-y: auto;
            padding-bottom: 0.5rem;
        }

        .folder-rail-item {
            width: 60px;
            padding: 0.35rem 0.25rem;
            border-radius: 16px;
            border: none;
            background: transparent;
            color: var(--text-secondary);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.25rem;
            cursor: pointer;
            position: relative;
            overflow: hidden;
            transition: background 0.2s ease, color 0.2s ease, transform 0.2s ease, box-shadow 0.2s ease;
        }

        .folder-rail-item:hover {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            transform: translateY(-1px);
        }

        .folder-rail-item.active {
            background: var(--folder-rail-active-bg);
            color: var(--text-primary);
            box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.12), var(--folder-rail-active-shadow);
        }

        .folder-rail-icon {
            width: 36px;
            height: 36px;
            border-radius: 12px;
            background: var(--bg-tertiary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
            box-shadow: inset 0 0 0 1px var(--border-color);
        }

        .folder-rail-item.active .folder-rail-icon {
            background: var(--folder-rail-active-icon-bg);
            color: var(--text-primary);
            box-shadow: inset 0 0 0 1px var(--folder-rail-active-icon-border);
        }

        .folder-rail-label {
            font-size: 0.65rem;
            text-align: center;
            line-height: 1.1;
            max-width: 56px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .folder-rail-item.active .folder-rail-label {
            color: var(--text-primary);
            font-weight: 600;
        }

        .folder-rail-count {
            font-size: 0.6rem;
            color: var(--text-muted);
        }

        .folder-rail-item.active .folder-rail-count {
            color: var(--text-secondary);
        }

        .folder-rail-edit {
            width: 60px;
            border: none;
            background: transparent;
            color: var(--text-secondary);
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            padding: 0.35rem 0.25rem;
            border-radius: 14px;
            cursor: pointer;
            transition: background 0.2s ease, color 0.2s ease;
        }

        .folder-rail-edit:hover {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }

        .chats-lists {
            flex: 1;
            min-width: 0;
            display: flex;
            flex-direction: column;
        }

        .folder-modal .modal-body {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .folder-hero {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 0.75rem 1rem;
            border-radius: 14px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
        }

        .folder-hero-icon {
            width: 48px;
            height: 48px;
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.4rem;
            background: var(--gradient-purple);
            color: #fff;
        }

        .folder-section-title {
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            color: var(--text-muted);
            margin-bottom: 0.5rem;
        }

        .folder-section-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 0.5rem;
            margin-bottom: 0.35rem;
        }

        .folder-limit-pill {
            padding: 0.2rem 0.6rem;
            border-radius: 999px;
            border: 1px solid var(--border-color);
            background: rgba(255, 255, 255, 0.06);
            font-size: 0.75rem;
            color: var(--text-secondary);
            min-width: 68px;
            text-align: center;
        }

        .folder-limit-note {
            margin-bottom: 0.6rem;
        }

        .folder-upgrade-btn {
            display: none;
            width: 100%;
            border-color: rgba(157, 0, 255, 0.5);
            color: var(--text-primary);
            background: rgba(157, 0, 255, 0.15);
        }

        .folder-upgrade-btn:hover {
            background: rgba(157, 0, 255, 0.25);
            border-color: rgba(157, 0, 255, 0.7);
        }

        .folder-list {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .folder-list-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 1rem;
            padding: 0.6rem 0.75rem;
            border-radius: 12px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
        }

        .folder-list-meta {
            display: flex;
            flex-direction: column;
            gap: 0.2rem;
        }

        .folder-list-name {
            font-weight: 600;
            color: var(--text-primary);
        }

        .folder-list-count {
            font-size: 0.8rem;
            color: var(--text-muted);
        }

        .folder-list-actions {
            display: flex;
            gap: 0.35rem;
        }

        .folder-action-btn {
            border: none;
            background: var(--bg-secondary);
            color: var(--text-primary);
            width: 32px;
            height: 32px;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.2s ease, color 0.2s ease;
        }

        .folder-action-btn:hover {
            background: var(--accent-color);
            color: #fff;
        }

        .folder-action-btn.danger:hover {
            background: #dc2626;
        }

        .folder-create-btn {
            width: 100%;
        }

        .folder-editor .modal-body,
        .folder-assign .modal-body {
            display: flex;
            flex-direction: column;
            gap: 0.85rem;
        }

        .folder-editor-search {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.45rem 0.75rem;
            border-radius: 10px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
        }

        .folder-editor-search .search-input {
            border: none;
            background: transparent;
            padding: 0;
        }

        .folder-chat-list,
        .folder-assign-list {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            max-height: 280px;
            overflow-y: auto;
        }

        .folder-chat-item,
        .folder-assign-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.45rem 0.6rem;
            border-radius: 10px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            cursor: pointer;
        }

        .folder-chat-item input,
        .folder-assign-item input {
            accent-color: var(--accent-color);
            cursor: pointer;
        }

        .folder-chat-avatar {
            width: 34px;
            height: 34px;
            border-radius: 50%;
            background: var(--gradient-purple);
            color: #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem;
            flex-shrink: 0;
        }

        .folder-chat-meta {
            display: flex;
            flex-direction: column;
            gap: 0.15rem;
            min-width: 0;
        }

        .folder-chat-name {
            font-size: 0.9rem;
            color: var(--text-primary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .folder-chat-type {
            font-size: 0.75rem;
            color: var(--text-muted);
        }

        .folder-empty {
            text-align: center;
            color: var(--text-muted);
            padding: 1rem 0;
        }

        .premium-gift-modal {
            max-width: 420px;
            width: min(92vw, 420px);
            background: transparent;
            border: none;
            box-shadow: none;
            padding: 0;
        }

        .premium-gift-modal-header {
            border-bottom: none;
            justify-content: flex-end;
            padding: 0.6rem 0.6rem 0;
        }

        .premium-gift-modal-header .close-btn {
            background: rgba(0, 0, 0, 0.45);
            border: 1px solid rgba(255, 255, 255, 0.15);
            color: #fff;
            width: 34px;
            height: 34px;
            border-radius: 10px;
        }

        .premium-gift {
            position: relative;
            overflow: hidden;
            border-radius: 22px;
            padding: 1.25rem 1.25rem 1.35rem;
            border: 1px solid rgba(255, 204, 120, 0.35);
            background: linear-gradient(180deg, rgba(34, 36, 40, 0.96), rgba(19, 21, 25, 0.98));
            box-shadow: 0 24px 45px rgba(0, 0, 0, 0.4);
        }

        .premium-gift::after {
            content: '';
            position: absolute;
            inset: 0;
            background: radial-gradient(circle at top right, rgba(255, 214, 136, 0.2), transparent 45%);
            pointer-events: none;
        }

        .premium-gift-hero {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .premium-gift-icon {
            width: 52px;
            height: 52px;
            border-radius: 16px;
            background: linear-gradient(145deg, #f8d36b, #f6a03b);
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 12px 24px rgba(246, 160, 59, 0.35);
        }

        .premium-gift-icon svg {
            width: 30px;
            height: 30px;
        }

        .premium-gift-title {
            font-weight: 700;
            font-size: 1.05rem;
            color: var(--text-primary);
        }

        .premium-gift-note {
            font-size: 0.82rem;
            color: var(--text-muted);
            margin-top: 0.25rem;
        }

        .premium-gift-form {
            display: grid;
            gap: 0.85rem;
            margin-top: 1rem;
            position: relative;
            z-index: 1;
        }

        .premium-gift-field {
            display: grid;
            gap: 0.35rem;
            font-size: 0.82rem;
            color: var(--text-secondary);
        }

        .premium-gift-input {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
        }

        .premium-gift-plans {
            display: grid;
            grid-template-columns: repeat(3, minmax(0, 1fr));
            gap: 0.6rem;
        }

        .premium-gift-plan {
            position: relative;
            display: flex;
            flex-direction: column;
            gap: 0.3rem;
            padding: 0.75rem 0.8rem;
            border-radius: 12px;
            border: 1px solid var(--border-color);
            background: var(--bg-secondary);
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: left;
        }

        .premium-gift-plan input {
            position: absolute;
            opacity: 0;
            pointer-events: none;
        }

        .premium-gift-plan:hover {
            border-color: rgba(255, 204, 120, 0.6);
        }

        .premium-gift-plan.is-active {
            border-color: rgba(255, 204, 120, 0.9);
            background: linear-gradient(135deg, rgba(255, 208, 120, 0.22), rgba(20, 23, 36, 0.92));
            box-shadow: 0 0 0 1px rgba(255, 204, 120, 0.25) inset;
        }

        .premium-gift-plan-title {
            font-weight: 600;
            color: var(--text-primary);
        }

        .premium-gift-plan-price {
            font-size: 1.05rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        .premium-gift-actions {
            display: flex;
        }

        .message.is-gift .message-bubble {
            background: transparent;
            border: none;
            padding: 0;
            box-shadow: none;
            max-width: min(320px, 100%);
        }

        .message-gift {
            position: relative;
            width: min(280px, 100%);
            margin: 0 auto;
            padding: 3.5rem 1.35rem 1.1rem;
            border-radius: 20px;
            background:
                radial-gradient(circle at top right, rgba(255, 214, 136, 0.22), transparent 48%),
                linear-gradient(145deg, rgba(40, 37, 30, 0.96), rgba(22, 21, 18, 0.98));
            border: 1px solid rgba(255, 204, 120, 0.45);
            overflow: hidden;
            box-shadow:
                0 12px 26px rgba(0, 0, 0, 0.35),
                0 0 18px rgba(255, 180, 80, 0.18);
        }

        .message-gift::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(120deg, transparent 0%, rgba(255, 255, 255, 0.28) 45%, transparent 70%);
            transform: translateX(-120%);
            animation: giftShine 3.8s ease-in-out infinite;
            pointer-events: none;
        }

        .message-gift::after {
            content: '';
            position: absolute;
            inset: 0;
            background-image:
                radial-gradient(circle at 20% 30%, rgba(255, 255, 255, 0.45) 0 2px, transparent 3px),
                radial-gradient(circle at 70% 20%, rgba(255, 255, 255, 0.35) 0 2px, transparent 3px),
                radial-gradient(circle at 80% 70%, rgba(255, 255, 255, 0.4) 0 2px, transparent 3px),
                radial-gradient(circle at 30% 80%, rgba(255, 255, 255, 0.3) 0 2px, transparent 3px);
            opacity: 0.7;
            animation: giftSparkle 2.8s ease-in-out infinite;
            pointer-events: none;
        }

        .message-gift-top {
            position: absolute;
            top: 0.2rem;
            left: 50%;
            transform: translateX(-50%);
            z-index: 2;
            width: 56px;
            height: 56px;
            display: flex;
            align-items: center;
            justify-content: center;
            pointer-events: none;
        }

        .message-gift-top::before {
            content: '';
            position: absolute;
            inset: -6px;
            border-radius: 20px;
            background: radial-gradient(circle, rgba(255, 214, 136, 0.45), transparent 70%);
            opacity: 0.7;
            z-index: -1;
        }

        .message-gift-icon {
            width: 50px;
            height: 50px;
            border-radius: 16px;
            background: linear-gradient(145deg, #f8d36b, #f5a33f);
            border: 1px solid rgba(255, 248, 209, 0.6);
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow:
                0 10px 18px rgba(246, 160, 59, 0.35),
                inset 0 0 10px rgba(255, 255, 255, 0.25);
            animation: giftFloat 2.8s ease-in-out infinite;
        }

        .message-gift-icon svg {
            width: 30px;
            height: 30px;
        }

        .premium-gift-icon .gift-box,
        .message-gift-icon .gift-box {
            fill: #fff1b3;
        }

        .premium-gift-icon .gift-lid,
        .message-gift-icon .gift-lid {
            fill: #ffe08a;
        }

        .premium-gift-icon .gift-ribbon,
        .message-gift-icon .gift-ribbon,
        .premium-gift-icon .gift-bow,
        .message-gift-icon .gift-bow {
            fill: #f0603a;
        }

        .message-gift-body {
            position: relative;
            z-index: 1;
            display: grid;
            gap: 0.35rem;
            text-align: center;
        }

        .message-gift-title {
            font-weight: 700;
            font-size: 0.98rem;
            color: var(--text-primary);
        }

        .message-gift-subtitle {
            font-size: 0.82rem;
            color: var(--text-secondary);
        }

        .message-gift-meta {
            display: flex;
            justify-content: center;
            gap: 0.35rem;
            font-size: 0.78rem;
            color: var(--text-muted);
        }

        .message-gift-price {
            font-weight: 600;
            color: var(--text-primary);
        }

        .message-gift-dot {
            opacity: 0.65;
        }

        @keyframes giftFloat {
            0% {
                transform: translateY(0) rotate(-2deg);
            }
            50% {
                transform: translateY(-3px) rotate(1deg);
            }
            100% {
                transform: translateY(0) rotate(-2deg);
            }
        }

        @keyframes giftShine {
            0% {
                transform: translateX(-120%);
            }
            100% {
                transform: translateX(120%);
            }
        }

        @keyframes giftSparkle {
            0%, 100% {
                opacity: 0.55;
                transform: translateY(0);
            }
            50% {
                opacity: 0.9;
                transform: translateY(-6px);
            }
        }

        @media (max-width: 640px) {
            .premium-cta-row {
                flex-direction: column;
            }

            .premium-stats {
                grid-template-columns: 1fr;
            }

            .premium-gift-plans {
                grid-template-columns: 1fr;
            }

            .chat-item {
                padding: 0.7rem 1rem;
            }

            .chat-avatar {
                width: 42px;
                height: 42px;
                font-size: 0.95rem;
            }

            .chat-header-avatar {
                width: 32px;
                height: 32px;
            }

            .chat-action-btn {
                width: 32px;
                height: 32px;
            }

            .chat-messages {
                gap: 0.9rem;
            }

            .message-avatar {
                width: 30px;
                height: 30px;
                flex: 0 0 30px;
                font-size: 0.8rem;
            }

            .message-bubble {
                max-width: min(86%, calc(100% - 44px));
                padding: 0.75rem 1rem;
            }

            .message-gift {
                width: min(250px, 100%);
                padding: 3.2rem 1.1rem 0.95rem;
            }

            .message-gift-icon {
                width: 46px;
                height: 46px;
            }

            .message-gift-top {
                width: 50px;
                height: 50px;
                top: 0.3rem;
            }

            .message-gift-top::before {
                inset: -5px;
            }

            .chat-input-wrapper {
                flex-wrap: wrap;
                gap: 0.45rem;
                padding: 0.55rem 0.6rem;
            }

            .chat-input-actions {
                width: 100%;
                justify-content: space-between;
                order: 1;
                gap: 0.35rem;
            }

            .chat-input {
                order: 2;
                flex: 1 1 0;
                min-width: 0;
            }

            .chat-send-btn {
                order: 3;
                padding: 0.6rem 0.9rem;
                font-size: 0.85rem;
            }

            .chat-action-icon {
                width: 36px;
                height: 36px;
                font-size: 1.05rem;
            }
        }

        @media (max-width: 700px) {
            .folders-rail {
                width: 64px;
            }

            .folder-rail-item,
            .folder-rail-edit {
                width: 54px;
            }
        }

        /* ========================================
           Каталог публичных групп и каналов
           ======================================== */
        
        .directory-modal .directory-content {
            max-width: 700px;
            width: 95vw;
            max-height: 85vh;
            background: var(--bg-primary);
            border-radius: 12px;
            border: 1px solid var(--border-color);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .directory-header {
            padding: 1rem 1.25rem;
            border-bottom: 1px solid var(--border-color);
            background: var(--bg-secondary);
        }

        .directory-header-top {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 0.75rem;
        }

        .directory-title {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .directory-title-icon {
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--bg-tertiary);
            border-radius: 6px;
            color: var(--text-secondary);
        }

        .directory-title-icon svg {
            width: 18px;
            height: 18px;
        }

        .directory-title h2 {
            margin: 0;
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .directory-close {
            width: 32px;
            height: 32px;
            border-radius: 6px;
            border: none;
            background: transparent;
            color: var(--text-muted);
            font-size: 1.25rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.15s;
        }

        .directory-close:hover {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }

        .directory-search {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            background: var(--bg-primary);
            border: 1px solid var(--border-subtle);
            border-radius: 8px;
            padding: 0.6rem 0.75rem;
            transition: all 0.15s;
        }

        .directory-search:focus-within {
            border-color: var(--border-color);
            background: var(--bg-secondary);
        }

        .directory-search-icon {
            width: 18px;
            height: 18px;
            color: var(--text-muted);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .directory-search-icon svg {
            width: 18px;
            height: 18px;
        }

        .directory-search input {
            flex: 1;
            border: none;
            background: transparent;
            color: var(--text-primary);
            font-size: 0.95rem;
            outline: none;
        }

        .directory-search input::placeholder {
            color: var(--text-muted);
        }

        .directory-search-clear {
            width: 20px;
            height: 20px;
            border: none;
            background: var(--bg-tertiary);
            color: var(--text-muted);
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.85rem;
            transition: all 0.15s;
        }

        .directory-search-clear:hover {
            background: var(--bg-secondary);
            color: var(--text-primary);
        }

        .directory-body {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .directory-categories {
            display: flex;
            gap: 0.35rem;
            padding: 0.75rem 1rem;
            border-bottom: 1px solid var(--border-subtle);
            overflow-x: auto;
            background: var(--bg-primary);
            scrollbar-width: none;
        }

        .directory-categories::-webkit-scrollbar {
            display: none;
        }

        .directory-category {
            display: flex;
            align-items: center;
            gap: 0.35rem;
            padding: 0.4rem 0.75rem;
            border: none;
            border-radius: 6px;
            background: transparent;
            color: var(--text-muted);
            font-size: 0.8rem;
            font-weight: 500;
            cursor: pointer;
            white-space: nowrap;
            transition: all 0.15s;
        }

        .directory-category:hover {
            background: var(--bg-secondary);
            color: var(--text-primary);
        }

        .directory-category.active {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }

        .directory-category-icon {
            width: 16px;
            height: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem;
        }

        .directory-category-icon svg {
            width: 16px;
            height: 16px;
        }

        .directory-results {
            flex: 1;
            overflow-y: auto;
            padding: 1rem 1.5rem;
        }

        .directory-loading,
        .directory-empty {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 2rem;
            color: var(--text-secondary);
            text-align: center;
        }

        .directory-spinner {
            width: 32px;
            height: 32px;
            border: 2px solid var(--border-color);
            border-top-color: var(--text-secondary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 0.75rem;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .directory-empty-icon {
            font-size: 2rem;
            margin-bottom: 0.75rem;
            opacity: 0.5;
        }

        .directory-empty h3 {
            margin: 0 0 0.25rem;
            color: var(--text-primary);
            font-size: 1rem;
        }

        .directory-empty p {
            margin: 0;
            font-size: 0.85rem;
        }

        .directory-list {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }

        .directory-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1rem;
            background: transparent;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.15s;
        }

        .directory-item:hover {
            background: var(--bg-secondary);
        }

        .directory-item-avatar {
            width: 44px;
            height: 44px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            flex-shrink: 0;
            overflow: hidden;
        }

        .directory-item-avatar.is-channel {
            background: #3b82f6;
        }

        .directory-item-avatar.is-group {
            background: #8b5cf6;
        }

        .directory-item-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .directory-avatar-letter {
            color: white;
            font-size: 1.1rem;
            font-weight: 600;
        }

        .directory-item-type-badge {
            position: absolute;
            bottom: -2px;
            right: -2px;
            width: 18px;
            height: 18px;
            background: var(--bg-secondary);
            border: 1px solid var(--border-subtle);
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.65rem;
        }

        .directory-item-type-badge svg {
            width: 10px;
            height: 10px;
        }

        .directory-item-info {
            flex: 1;
            min-width: 0;
        }

        .directory-item-header {
            display: flex;
            align-items: center;
            gap: 0.35rem;
            margin-bottom: 0.15rem;
        }

        .directory-item-name {
            font-weight: 500;
            font-size: 0.9rem;
            color: var(--text-primary);
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .directory-verified {
            width: 14px;
            height: 14px;
            color: #3b82f6;
            flex-shrink: 0;
        }

        .directory-verified svg {
            width: 14px;
            height: 14px;
        }

        /* Блок информации о верификации */
        .directory-verify-info {
            margin: 0.75rem 1rem;
            padding: 0.85rem 1rem;
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.08), rgba(139, 92, 246, 0.06));
            border: 1px solid rgba(59, 130, 246, 0.15);
            border-radius: 10px;
        }

        .verify-info-header {
            display: flex;
            align-items: center;
            gap: 0.4rem;
            font-weight: 600;
            font-size: 0.85rem;
            color: var(--text-primary);
            margin-bottom: 0.35rem;
        }

        .verify-badge-icon {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 18px;
            height: 18px;
            background: #3b82f6;
            color: white;
            border-radius: 50%;
            font-size: 0.65rem;
            font-weight: 700;
        }

        .verify-info-desc {
            margin: 0 0 0.65rem 0;
            font-size: 0.78rem;
            color: var(--text-muted);
            line-height: 1.4;
        }

        .verify-info-btn {
            padding: 0.4rem 0.85rem;
            background: rgba(59, 130, 246, 0.12);
            border: 1px solid rgba(59, 130, 246, 0.25);
            border-radius: 6px;
            color: #3b82f6;
            font-size: 0.78rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.15s;
        }

        .verify-info-btn:hover {
            background: rgba(59, 130, 246, 0.18);
            border-color: rgba(59, 130, 246, 0.35);
        }

        /* Модальное окно требований верификации */
        .verify-modal {
            z-index: 10001;
            overflow-y: auto;
        }

        .verify-content {
            max-width: 420px;
            width: 90%;
            max-height: 90vh;
            padding: 0;
            border-radius: 14px;
            background: var(--bg-primary);
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .verify-scrollable {
            flex: 1;
            overflow-y: auto;
            overscroll-behavior: contain;
        }

        .verify-modal-header {
            display: flex;
            align-items: center;
            gap: 0.65rem;
            padding: 1.1rem 1.25rem;
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(139, 92, 246, 0.08));
            border-bottom: 1px solid var(--border-subtle);
        }

        .verify-modal-badge {
            width: 34px;
            height: 34px;
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1rem;
            font-weight: 700;
        }

        .verify-modal-header h2 {
            flex: 1;
            margin: 0;
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .verify-modal-header .close-btn {
            width: 30px;
            height: 30px;
            border-radius: 6px;
            background: transparent;
            border: none;
            color: var(--text-muted);
            font-size: 1.3rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.15s;
        }

        .verify-modal-header .close-btn:hover {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }

        .verify-modal-subtitle {
            margin: 0;
            padding: 0.85rem 1.25rem;
            font-size: 0.82rem;
            color: var(--text-muted);
            line-height: 1.45;
            border-bottom: 1px solid var(--border-subtle);
        }

        .verify-requirements {
            padding: 1rem 1.25rem;
        }

        .verify-requirements h3 {
            margin: 0 0 0.75rem 0;
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .verify-req-item {
            display: flex;
            align-items: flex-start;
            gap: 0.75rem;
            padding: 0.6rem 0;
            border-bottom: 1px solid var(--border-subtle);
        }

        .verify-req-item:last-child {
            border-bottom: none;
        }

        .verify-req-icon {
            font-size: 1.1rem;
            flex-shrink: 0;
            width: 24px;
            text-align: center;
        }

        .verify-req-text {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 0.15rem;
        }

        .verify-req-text strong {
            font-size: 0.82rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .verify-req-text span {
            font-size: 0.75rem;
            color: var(--text-muted);
        }

        .verify-how-to {
            padding: 0.85rem 1.25rem;
            background: var(--bg-secondary);
            border-top: 1px solid var(--border-subtle);
        }

        .verify-how-to h3 {
            margin: 0 0 0.4rem 0;
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .verify-how-to p {
            margin: 0;
            font-size: 0.78rem;
            color: var(--text-secondary);
            line-height: 1.45;
        }

        .verify-how-to a {
            color: #3b82f6;
            text-decoration: none;
            font-weight: 500;
        }

        .verify-how-to a:hover {
            text-decoration: underline;
        }

        .verify-close-btn {
            display: block;
            width: calc(100% - 2.5rem);
            margin: 1rem 1.25rem;
            padding: 0.65rem;
            background: #3b82f6;
            border: none;
            border-radius: 8px;
            color: white;
            font-size: 0.85rem;
            font-weight: 500;
            cursor: pointer;
            transition: background 0.15s;
        }

        .verify-close-btn:hover {
            background: #2563eb;
        }

        /* Форма подачи заявки на верификацию */
        .verify-apply-section {
            padding: 1rem 1.25rem;
            border-top: 1px solid var(--border-subtle);
        }

        .verify-apply-section h3 {
            margin: 0 0 0.4rem 0;
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .verify-apply-note {
            margin: 0 0 1rem 0;
            font-size: 0.78rem;
            color: var(--text-muted);
        }

        .verify-form {
            display: flex;
            flex-direction: column;
            gap: 0.85rem;
        }

        .verify-form-group {
            display: flex;
            flex-direction: column;
            gap: 0.35rem;
        }

        .verify-form-group label {
            font-size: 0.8rem;
            font-weight: 500;
            color: var(--text-secondary);
        }

        .verify-input-wrapper {
            display: flex;
            align-items: center;
            background: var(--bg-secondary);
            border: 1px solid var(--border-subtle);
            border-radius: 8px;
            overflow: hidden;
        }

        .verify-input-prefix {
            padding: 0.55rem 0 0.55rem 0.75rem;
            font-size: 0.85rem;
            color: var(--text-muted);
            font-weight: 500;
        }

        .verify-input-wrapper input {
            flex: 1;
            padding: 0.55rem 0.75rem 0.55rem 0.25rem;
            background: transparent;
            border: none;
            outline: none;
            font-size: 0.85rem;
            color: var(--text-primary);
        }

        .verify-form-group textarea {
            padding: 0.55rem 0.75rem;
            background: var(--bg-secondary);
            border: 1px solid var(--border-subtle);
            border-radius: 8px;
            font-size: 0.85rem;
            color: var(--text-primary);
            resize: vertical;
            min-height: 70px;
            font-family: inherit;
        }

        .verify-form-group textarea:focus,
        .verify-input-wrapper:focus-within {
            border-color: #3b82f6;
        }

        .verify-submit-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            padding: 0.65rem;
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            border: none;
            border-radius: 8px;
            color: white;
            font-size: 0.85rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.15s;
        }

        .verify-submit-btn:hover:not(:disabled) {
            opacity: 0.9;
            transform: translateY(-1px);
        }

        .verify-submit-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .verify-submit-icon {
            font-size: 0.9rem;
        }

        .verify-form-status {
            padding: 0.6rem 0.85rem;
            border-radius: 6px;
            font-size: 0.8rem;
            text-align: center;
        }

        .verify-form-status.success {
            background: rgba(34, 197, 94, 0.12);
            color: #22c55e;
            border: 1px solid rgba(34, 197, 94, 0.25);
        }

        .verify-form-status.error {
            background: rgba(239, 68, 68, 0.12);
            color: #ef4444;
            border: 1px solid rgba(239, 68, 68, 0.25);
        }

        /* Мои заявки */
        .verify-my-requests {
            padding: 1rem 1.25rem;
            border-top: 1px solid var(--border-subtle);
            background: var(--bg-secondary);
        }

        .verify-my-requests h3 {
            margin: 0 0 0.75rem 0;
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .verify-requests-list {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .verify-request-item {
            padding: 0.65rem 0.85rem;
            background: var(--bg-primary);
            border-radius: 8px;
            border-left: 3px solid var(--border-color);
        }

        .verify-request-item.pending {
            border-left-color: #f59e0b;
        }

        .verify-request-item.approved {
            border-left-color: #22c55e;
        }

        .verify-request-item.rejected {
            border-left-color: #ef4444;
        }

        .verify-request-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 0.3rem;
        }

        .verify-request-channel {
            font-weight: 600;
            font-size: 0.85rem;
            color: #3b82f6;
        }

        .verify-request-status {
            font-size: 0.75rem;
            font-weight: 500;
        }

        .verify-request-item.pending .verify-request-status { color: #f59e0b; }
        .verify-request-item.approved .verify-request-status { color: #22c55e; }
        .verify-request-item.rejected .verify-request-status { color: #ef4444; }

        .verify-request-info {
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-size: 0.78rem;
            color: var(--text-muted);
        }

        .verify-request-name {
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .verify-request-date {
            flex-shrink: 0;
        }

        .verify-request-comment {
            margin-top: 0.4rem;
            padding: 0.45rem 0.6rem;
            background: var(--bg-tertiary);
            border-radius: 6px;
            font-size: 0.78rem;
            color: var(--text-secondary);
        }

        /* === Мобильная адаптация модального окна верификации === */
        @media (max-width: 480px) {
            .verify-content {
                width: 100%;
                max-width: 100%;
                height: 100%;
                max-height: 100%;
                border-radius: 0;
                display: flex;
                flex-direction: column;
            }

            .verify-modal-header {
                padding: 1rem;
                flex-shrink: 0;
            }

            .verify-modal-badge {
                width: 32px;
                height: 32px;
                font-size: 0.95rem;
            }

            .verify-modal-header h2 {
                font-size: 1rem;
            }

            .verify-modal-subtitle {
                padding: 0.75rem 1rem;
                font-size: 0.8rem;
            }

            .verify-requirements {
                padding: 0.85rem 1rem;
                flex: 1;
                overflow-y: auto;
            }

            .verify-requirements h3 {
                font-size: 0.85rem;
            }

            .verify-req-item {
                padding: 0.5rem 0;
                gap: 0.6rem;
            }

            .verify-req-icon {
                font-size: 1rem;
                width: 22px;
            }

            .verify-req-text strong {
                font-size: 0.8rem;
            }

            .verify-req-text span {
                font-size: 0.72rem;
            }

            .verify-how-to {
                padding: 0.75rem 1rem;
            }

            .verify-how-to h3 {
                font-size: 0.8rem;
            }

            .verify-how-to p {
                font-size: 0.75rem;
            }

            .verify-close-btn {
                width: calc(100% - 2rem);
                margin: 0.85rem 1rem;
                padding: 0.75rem;
                font-size: 0.9rem;
            }

            /* Форма подачи заявки - мобильная версия */
            .verify-apply-section {
                padding: 0.85rem 1rem;
            }

            .verify-apply-section h3 {
                font-size: 0.85rem;
            }

            .verify-apply-note {
                font-size: 0.75rem;
            }

            .verify-form {
                gap: 0.75rem;
            }

            .verify-form-group label {
                font-size: 0.78rem;
            }

            .verify-input-prefix {
                padding: 0.5rem 0 0.5rem 0.65rem;
                font-size: 0.82rem;
            }

            .verify-input-wrapper input {
                padding: 0.5rem 0.65rem 0.5rem 0.2rem;
                font-size: 0.82rem;
            }

            .verify-form-group textarea {
                padding: 0.5rem 0.65rem;
                font-size: 0.82rem;
                min-height: 80px;
            }

            .verify-submit-btn {
                padding: 0.75rem;
                font-size: 0.9rem;
            }

            .verify-form-status {
                padding: 0.55rem 0.75rem;
                font-size: 0.78rem;
            }

            /* Мои заявки - мобильная версия */
            .verify-my-requests {
                padding: 0.85rem 1rem;
            }

            .verify-my-requests h3 {
                font-size: 0.85rem;
                margin-bottom: 0.6rem;
            }

            .verify-request-item {
                padding: 0.55rem 0.75rem;
            }

            .verify-request-channel {
                font-size: 0.82rem;
            }

            .verify-request-status {
                font-size: 0.72rem;
            }

            .verify-request-info {
                font-size: 0.75rem;
            }

            .verify-request-comment {
                padding: 0.4rem 0.55rem;
                font-size: 0.75rem;
            }
        }

        /* Планшеты */
        @media (min-width: 481px) and (max-width: 768px) {
            .verify-content {
                width: 95%;
                max-width: 400px;
            }

            .verify-modal-header {
                padding: 1rem;
            }

            .verify-requirements {
                padding: 0.9rem 1.1rem;
            }

            .verify-apply-section {
                padding: 0.9rem 1.1rem;
            }

            .verify-my-requests {
                padding: 0.9rem 1.1rem;
            }
        }

        .directory-item-category {
            font-size: 0.75rem;
        }

        .directory-item-meta {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.2rem;
        }

        .directory-item-members {
            display: flex;
            align-items: center;
            gap: 0.25rem;
            font-size: 0.75rem;
            color: var(--text-muted);
        }

        .directory-item-members svg {
            width: 12px;
            height: 12px;
        }

        .directory-item-username {
            font-size: 0.75rem;
            color: var(--text-secondary);
        }

        .directory-item-desc {
            margin: 0;
            font-size: 0.8rem;
            color: var(--text-muted);
            line-height: 1.35;
            display: -webkit-box;
            -webkit-line-clamp: 1;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .directory-item-join {
            padding: 0.4rem 0.9rem;
            border-radius: 6px;
            font-size: 0.8rem;
            font-weight: 500;
            flex-shrink: 0;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-subtle);
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.15s;
        }

        .directory-item-join:hover {
            background: var(--bg-secondary);
            border-color: var(--border-color);
        }

        /* Кнопка открытия каталога в боковой панели */
        .directory-open-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            width: 100%;
            margin-top: 0.5rem;
            padding: 0.6rem 1rem;
            background: var(--bg-secondary);
            border: 1px solid var(--border-subtle);
            border-radius: 8px;
            color: var(--text-secondary);
            font-size: 0.85rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.15s;
        }

        .directory-open-btn:hover {
            background: var(--bg-tertiary);
            border-color: var(--border-color);
            color: var(--text-primary);
        }

        .directory-btn-icon {
            width: 16px;
            height: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0.7;
        }

        .directory-btn-icon svg {
            width: 16px;
            height: 16px;
        }

        @media (max-width: 700px) {
            .directory-content {
                width: 100%;
                max-width: 100%;
                height: 100vh;
                max-height: 100vh;
                border-radius: 0;
            }

            .directory-item {
                flex-wrap: wrap;
            }

            .directory-item-join {
                width: 100%;
                margin-top: 0.5rem;
            }

            .directory-categories {
                padding: 0.75rem 1rem;
            }

            .directory-category {
                padding: 0.5rem 0.75rem;
                font-size: 0.8rem;
            }
        }

    </style>
</head>
<body>
    <button class="mobile-nav-btn" id="openSidebarBtn">☰</button>
    <div class="sidebar-overlay" id="sidebarOverlay"></div>
    <div class="app-menu-overlay" id="appMenuOverlay"></div>
    <aside class="app-menu" id="appMenu" aria-hidden="true">
        <div class="app-menu-header">
            <div class="app-menu-user">
                <div class="user-avatar app-menu-avatar" id="userAvatar">U</div>
                <input type="file" id="avatarInput" accept="image/*" style="display: none;">
                <div class="app-menu-user-info">
                    <div class="app-menu-name" id="username">Пользователь</div>
                <div class="app-menu-status" data-i18n="status.online">Онлайн</div>
                </div>
            </div>
            <button class="app-menu-close" id="closeAppMenuBtn" aria-label="Закрыть меню">✕</button>
        </div>
        <div class="app-menu-body">
            <div class="app-menu-section">
                <button class="app-menu-item" id="menuProfileBtn">
                    <span class="menu-item-icon">👤</span>
                    <span data-i18n="menu.profile">Профиль</span>
                </button>
                <button class="app-menu-item app-menu-item--wallet" id="menuWalletBtn" onclick="XipherWalletUI.toggle(); document.getElementById('appMenu').classList.remove('show'); document.getElementById('appMenuOverlay').classList.remove('show');">
                    <span class="menu-item-icon">💎</span>
                    <span>Кошелёк</span>
                    <span class="wallet-balance-badge" id="walletBalanceBadge">$0</span>
                </button>
                <button class="app-menu-item" id="createChannelBtn">
                    <span class="menu-item-icon">📢</span>
                    <span data-i18n="menu.createChannel">Создать канал</span>
                </button>
                <button class="app-menu-item" id="createGroupBtn">
                    <span class="menu-item-icon">👥</span>
                    <span data-i18n="menu.createGroup">Создать группу</span>
                </button>
                <button class="app-menu-item" id="menuDirectoryBtn">
                    <span class="menu-item-icon">🧭</span>
                    <span data-i18n="menu.directory">Каталог</span>
                </button>
                <button class="app-menu-item" id="menuCallsBtn">
                    <span class="menu-item-icon">📞</span>
                    <span data-i18n="menu.calls">Звонки</span>
                </button>
                <button class="app-menu-item" id="menuSavedBtn">
                    <span class="menu-item-icon">⭐</span>
                    <span data-i18n="menu.saved">Сохраненные сообщения</span>
                </button>
                <button class="app-menu-item" id="menuSettingsBtn">
                    <span class="menu-item-icon">⚙️</span>
                    <span data-i18n="menu.settings">Настройки</span>
                </button>
            </div>
            <div class="app-menu-section">
                <div class="app-menu-item app-menu-item--toggle">
                    <div class="menu-toggle-label">
                        <span class="menu-item-icon">🌓</span>
                        <div class="menu-toggle-text">
                            <span data-i18n="menu.theme">Тема</span>
                            <small class="menu-toggle-state" id="menuThemeLabel">Темная тема</small>
                        </div>
                    </div>
                    <label class="switch">
                        <input type="checkbox" id="menuThemeToggle">
                        <span class="switch-slider"></span>
                    </label>
                </div>
            </div>
            <div class="app-menu-section">
                <button class="app-menu-item" id="menuLanguageBtn">
                    <span class="menu-item-icon">🌐</span>
                    <span data-i18n="menu.language">Язык</span>
                    <span class="menu-item-note" id="menuLanguageValue">Русский</span>
                </button>
                <button class="app-menu-item" id="menuPremiumBtn">
                    <span class="menu-item-icon">✨</span>
                    <span data-i18n="menu.premium">Xipher Premium</span>
                </button>
                <button class="app-menu-item" id="menuFaqBtn">
                    <span class="menu-item-icon">❓</span>
                    <span data-i18n="menu.faq">Xipher FAQ</span>
                </button>
            </div>
        </div>
    </aside>
    <div class="chat-container">
        <!-- Боковая панель со списком чатов -->
        <div class="chats-sidebar">
            <div class="chats-header chats-header--compact">
                <button class="sidebar-menu-btn" id="openAppMenuBtn" aria-label="Открыть меню">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
                <div class="sidebar-title">Xipher</div>
            </div>
            <!-- Убрали вкладки - все в одном списке как в Xipher -->

            <div class="chats-search" id="chatsSearchSection">
                <div class="search-field">
                    <span class="search-icon">🔍</span>
                    <input type="text" class="search-input" placeholder="Поиск чатов..." id="chatSearch" data-i18n-placeholder="chat.searchPlaceholder">
                </div>
            </div>

            <div class="chats-body">
                <div class="folders-rail">
                    <div class="folders-rail-list" id="foldersRailList"></div>
                    <button class="folder-rail-edit" id="folderEditBtn">Edit</button>
                </div>
                <div class="chats-lists">
                    <div class="chats-list" id="chatsList">
                        <!-- Чаты будут добавлены через JavaScript -->
                    </div>

                    <div class="chats-list" id="friendsList" style="display: none;">
                        <!-- Список друзей будет добавлен через JavaScript -->
                    </div>

                    <div class="chats-list" id="requestsList" style="display: none;">
                        <!-- Запросы в друзья будут добавлены через JavaScript -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Основная область чата -->
        <div class="chat-main">
            <div class="chat-header" id="chatHeader" style="display: none;">
                <div class="chat-header-info">
                    <div class="chat-header-avatar" id="chatHeaderAvatar">F</div>
                    <div class="chat-header-details">
                        <h3 id="chatHeaderName" data-i18n="chat.headerTitle">Выберите чат</h3>
                        <p id="chatHeaderStatus" data-i18n="chat.headerSubtitle">Начните общение</p>
                    </div>
                </div>
                <div class="chat-actions">
                    <button class="chat-action-btn" id="groupInviteBtn" title="Пригласить по ссылке" style="display:none;">🔗</button>
                    <button class="chat-action-btn" id="leaveGroupBtn" title="Выйти из группы" style="display:none;">🚪</button>
                    <button class="chat-action-btn" id="callBtn" title="Позвонить">📞</button>
                    <button class="chat-action-btn" id="searchChannelBtn" title="Поиск">🔍</button>
                    <button class="chat-action-btn" id="channelMenuBtn" title="Меню">⋮</button>
                </div>
            </div>

            <div class="chat-messages" id="chatMessages">
                <div class="empty-chat">
                    <div class="empty-chat-icon">💬</div>
                    <h3 data-i18n="chat.emptyTitle">Выберите чат</h3>
                    <p data-i18n="chat.emptySubtitle">Выберите чат из списка слева, чтобы начать общение</p>
                </div>
            </div>

            <div class="chat-input-area" id="chatInputArea" style="display: none;">
                <!-- Reply preview -->
                <div class="reply-preview" id="replyPreview" style="display: none;">
                    <div class="reply-preview-content">
                        <div class="reply-preview-info">
                            <span class="reply-preview-label" data-i18n="chat.replyLabel">Ответ на сообщение</span>
                            <span class="reply-preview-text" id="replyPreviewText"></span>
                        </div>
                        <button class="reply-preview-close" id="replyPreviewClose">&times;</button>
                    </div>
                </div>
                <div class="live-location-bar" id="liveLocationBar" style="display: none;">
                    <div class="live-location-info">
                        <div class="live-location-title">
                            <span data-i18n="chat.live.title">Живая геопозиция</span>
                            <span class="live-location-target" id="liveLocationTarget"></span>
                        </div>
                        <div class="live-location-timer" id="liveLocationTimer"></div>
                    </div>
                    <button class="live-location-stop" id="liveLocationStop" type="button" data-i18n="chat.live.stop">Остановить</button>
                </div>
                <div class="pending-attachments" id="pendingAttachments" style="display: none;"></div>
                <div class="reply-keyboard" id="replyKeyboard" style="display: none;">
                    <div class="reply-keyboard-grid" id="replyKeyboardGrid"></div>
                </div>
                <div class="chat-input-wrapper">
                    <div class="chat-input-actions">
                        <button class="chat-action-icon" id="attachFileBtn" title="Прикрепить файл">📎</button>
                        <button class="chat-action-icon" id="ttlToggleBtn" title="Таймер" data-i18n-title="chat.ttl.toggle" aria-pressed="false">⏱</button>
                        <button class="chat-action-icon" id="emojiBtn" title="Эмодзи">😊</button>
                        <button class="chat-action-icon voice-record-btn" id="voiceBtn" title="Голосовое сообщение">🎤</button>
                    </div>
                    <textarea 
                        id="messageInput" 
                        class="chat-input" 
                        placeholder="Введите сообщение..."
                        data-i18n-placeholder="chat.messagePlaceholder"
                        rows="1"
                    ></textarea>
                    <button class="chat-send-btn" id="sendButton" data-i18n="chat.send">Отправить</button>
                    <input type="file" id="fileInput" style="display: none;" multiple>
                </div>
                <div class="attach-menu" id="attachMenu" aria-hidden="true">
                    <button class="attach-menu-item" id="attachMenuFile" type="button">
                        <span class="attach-menu-icon is-file" aria-hidden="true">
                            <svg viewBox="0 0 24 24">
                                <path d="M21 12.5l-8.5 8.5a5.5 5.5 0 01-7.8-7.8L13 4.9a3.5 3.5 0 015 5l-8.5 8.6a1.5 1.5 0 01-2.1-2.1l8.1-8.2"/>
                            </svg>
                        </span>
                        <span data-i18n="chat.attach.file">Файл</span>
                    </button>
                    <button class="attach-menu-item" id="attachMenuChecklist" type="button">
                        <span class="attach-menu-icon is-checklist" aria-hidden="true">
                            <svg viewBox="0 0 24 24">
                                <path d="M5 6l1.6 1.6L9 5"/>
                                <path d="M12 6h7"/>
                                <path d="M5 12l1.6 1.6L9 11"/>
                                <path d="M12 12h7"/>
                                <path d="M5 18l1.6 1.6L9 17"/>
                                <path d="M12 18h7"/>
                            </svg>
                        </span>
                        <span data-i18n="chat.attach.checklist">Чек-лист</span>
                    </button>
                    <button class="attach-menu-item" id="attachMenuPremiumGift" type="button">
                        <span class="attach-menu-icon is-gift" aria-hidden="true">
                            <svg viewBox="0 0 24 24">
                                <rect x="3" y="10" width="18" height="11" rx="3"/>
                                <rect x="3" y="7" width="18" height="4" rx="2"/>
                                <rect x="11" y="7" width="2" height="14" rx="1"/>
                                <path d="M8 7c-2 0-3-1.6-3-3 0-1.4 1-3 3-3 2.5 0 4 3 4 3s-1.5 3-4 3z"/>
                                <path d="M16 7c2 0 3-1.6 3-3 0-1.4-1-3-3-3-2.5 0-4 3-4 3s1.5 3 4 3z"/>
                            </svg>
                        </span>
                        <span data-i18n="chat.attach.gift">Подарить Premium</span>
                    </button>
                    <button class="attach-menu-item" id="attachMenuLocation" type="button">
                        <span class="attach-menu-icon is-location" aria-hidden="true">
                            <svg viewBox="0 0 24 24">
                                <path d="M12 22s7-7.2 7-12a7 7 0 10-14 0c0 4.8 7 12 7 12z"/>
                                <circle cx="12" cy="10" r="2.5"/>
                            </svg>
                        </span>
                        <span data-i18n="chat.attach.location">Геопозиция</span>
                    </button>
                    <button class="attach-menu-item" id="attachMenuLiveLocation" type="button">
                        <span class="attach-menu-icon is-live" aria-hidden="true">
                            <svg viewBox="0 0 24 24">
                                <circle cx="12" cy="12" r="2.5"/>
                                <path d="M4.5 12a7.5 7.5 0 0115 0"/>
                                <path d="M7.5 12a4.5 4.5 0 019 0"/>
                            </svg>
                        </span>
                        <span data-i18n="chat.attach.liveLocation">Живая геопозиция</span>
                        <span class="attach-menu-pill" data-i18n="chat.attach.liveBadge">Live</span>
                    </button>
                </div>
                <div class="ttl-menu" id="ttlMenu" aria-hidden="true">
                    <button class="ttl-menu-item" type="button" data-ttl="0">
                        <span data-i18n="chat.ttl.off">Выключен</span>
                    </button>
                    <button class="ttl-menu-item" type="button" data-ttl="10">
                        <span data-i18n="chat.ttl.10s">10 сек</span>
                    </button>
                    <button class="ttl-menu-item" type="button" data-ttl="3600">
                        <span data-i18n="chat.ttl.1h">1 час</span>
                    </button>
                    <button class="ttl-menu-item" type="button" data-ttl="86400">
                        <span data-i18n="chat.ttl.1d">1 день</span>
                    </button>
                </div>
                <div class="voice-recording-overlay" id="voiceRecordingOverlay" aria-hidden="true">
                    <div class="voice-recording-pill">
                        <span class="voice-recording-dot"></span>
                        <span class="voice-recording-label" id="voiceRecordingLabel">Запись</span>
                        <span class="voice-recording-timer" id="voiceRecordingTimer">00:00</span>
                        <span class="voice-recording-divider"></span>
                        <span class="voice-recording-hint" id="voiceRecordingHint">Потяните вверх, чтобы закрепить</span>
                        <button class="voice-recording-stop" id="voiceRecordingStop" type="button">Стоп</button>
                    </div>
                </div>
            </div>
        </div>
        <aside class="info-panel" id="infoPanel">
            <div id="infoPanelDefault" class="info-panel-content">
                <div>
                    <p class="reply-preview-label" style="margin:0;">Инфо</p>
                    <h3 style="margin:0; color:var(--text-primary); font-size:1rem;">Выберите чат</h3>
                </div>
                <div id="pinnedPanel" style="padding:0.75rem; border:1px solid var(--glass-border); border-radius:12px; background:var(--surface-elevated); cursor:pointer;">
                    <p id="pinnedPanelText" style="margin:0; color:var(--text-secondary); font-size:0.9rem;">Закреплённые сообщения появятся здесь</p>
                </div>
                <div style="display:grid; gap:0.5rem;">
                    <span class="reply-preview-label">Недавние файлы</span>
                    <div style="display:flex; gap:0.5rem; flex-wrap:wrap;">
                        <span class="pill" style="padding:0.4rem 0.7rem; background:var(--bg-tertiary); border-radius:10px; border:1px solid var(--glass-border); color:var(--text-secondary);">Пока пусто</span>
                    </div>
                </div>
            </div>
            <div id="infoPanelChannel" class="info-panel-content" style="display: none;"></div>
        </aside>
    </div>

    <div class="channel-info-overlay" id="channelInfoOverlay" aria-hidden="true">
        <div class="channel-info-drawer" role="dialog" aria-modal="true">
            <div class="channel-info-drawer-header">
                <div class="channel-info-drawer-title">Информация о канале</div>
                <button class="channel-info-close" id="closeChannelInfoOverlay" aria-label="Закрыть">✕</button>
            </div>
            <div id="channelInfoOverlayContent" class="info-panel-content"></div>
        </div>
    </div>

    <div class="settings-overlay" id="settingsOverlay" aria-hidden="true">
        <div class="settings-panel">
            <div class="settings-topbar">
                <div class="settings-title" data-i18n="settings.title">Настройки</div>
                <div class="settings-top-actions">
                    <button class="settings-icon-btn" id="settingsQrBtn" title="QR-профиль" data-i18n-title="settings.qrTitle">🔳</button>
                    <div class="settings-more">
                        <button class="settings-icon-btn" id="settingsMoreBtn" title="Меню" data-i18n-title="settings.moreTitle">⋮</button>
                        <div class="settings-more-menu" id="settingsMoreMenu">
                            <button id="settingsEditProfileBtn" data-i18n="settings.editProfile">Редактировать профиль</button>
                            <button id="settingsLogoutBtn" data-i18n="settings.logout">Выйти из аккаунта</button>
                        </div>
                    </div>
                    <button class="settings-icon-btn" id="settingsCloseBtn" title="Закрыть" data-i18n-title="settings.closeTitle">✕</button>
                </div>
            </div>
            <div class="settings-body">
                <nav class="settings-nav">
                    <button class="settings-nav-item active" data-section="account" data-i18n="settings.nav.account">Мой аккаунт</button>
                    <button class="settings-nav-item" data-section="notifications" data-i18n="settings.nav.notifications">Уведомления и звуки</button>
                    <button class="settings-nav-item" data-section="calls" data-i18n="settings.nav.calls">Звонки</button>
                    <button class="settings-nav-item" data-section="privacy" data-i18n="settings.nav.privacy">Приватность и безопасность</button>
                    <button class="settings-nav-item" data-section="sessions" data-i18n="settings.nav.sessions">Активные сеансы</button>
                    <button class="settings-nav-item" data-section="blocked" data-i18n="settings.nav.blocked">Заблокированные пользователи</button>
                    <button class="settings-nav-item" data-section="login" data-i18n="settings.nav.login">Login email</button>
                    <button class="settings-nav-item" data-section="language" data-i18n="settings.nav.language">Язык</button>
                    <button class="settings-nav-item" data-section="premium" data-i18n="settings.nav.premium">Xipher Premium</button>
                    <button class="settings-nav-item" data-section="faq" data-i18n="settings.nav.faq">Xipher FAQ</button>
                </nav>
                <div class="settings-content">
                    <section class="settings-section active" data-section="account">
                        <div class="settings-card">
                            <h3 data-i18n="settings.account.profile">Профиль</h3>
                            <div class="settings-avatar-row">
                                <div class="settings-avatar" id="settingsAvatar">U</div>
                                <div>
                                    <div class="settings-note" data-i18n="settings.account.photoEdit">Редактирование фото</div>
                                    <div class="settings-actions" style="margin-top:0.5rem;">
                                        <button class="btn-secondary btn-small" id="settingsChangeAvatarBtn" type="button" data-i18n="settings.account.changePhoto">Сменить фото</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="settings-card">
                            <h3 data-i18n="settings.account.basic">Основные данные</h3>
                            <div class="settings-row">
                                <label for="settingsFirstName" data-i18n="settings.account.firstName">Имя</label>
                                <input class="settings-input" id="settingsFirstName" type="text" placeholder="Имя" data-i18n-placeholder="settings.account.firstNamePlaceholder">
                            </div>
                            <div class="settings-row">
                                <label for="settingsLastName" data-i18n="settings.account.lastName">Фамилия</label>
                                <input class="settings-input" id="settingsLastName" type="text" placeholder="Фамилия" data-i18n-placeholder="settings.account.lastNamePlaceholder">
                            </div>
                            <div class="settings-row">
                                <label for="settingsBio" data-i18n="settings.account.bioEdit">Редактирование описания профиля</label>
                                <textarea class="settings-input settings-textarea" id="settingsBio" rows="3" placeholder="О себе" data-i18n-placeholder="settings.account.bioPlaceholder"></textarea>
                            </div>
                            <div class="settings-row">
                                <label for="settingsUsername" data-i18n="settings.account.username">UserName</label>
                                <input class="settings-input" id="settingsUsername" type="text" placeholder="@username" disabled>
                            </div>
                            <div class="settings-note" data-i18n="settings.account.usernameNote">Смена username будет доступна позже</div>
                        </div>
                        <div class="settings-card">
                            <h3 data-i18n="settings.account.personalChannel">Персональный канал</h3>
                            <div class="settings-note" style="margin-bottom:0.6rem;" data-i18n="settings.account.personalChannelNote">Выберите личный канал, который вы создали</div>
                            <div class="settings-channel-grid" id="personalChannelList">
                                <div class="settings-note" data-i18n="settings.account.noChannels">Пока нет каналов</div>
                            </div>
                        </div>
                        <div class="settings-card">
                            <h3 data-i18n="settings.account.birthday">День рождения</h3>
                            <div style="display:flex; gap:0.6rem; flex-wrap:wrap;">
                                <input class="settings-input" id="settingsBirthDay" type="number" min="0" max="31" placeholder="День" style="width: 110px;" data-i18n-placeholder="settings.account.birthDayPlaceholder">
                                <input class="settings-input" id="settingsBirthMonth" type="number" min="0" max="12" placeholder="Месяц" style="width: 120px;" data-i18n-placeholder="settings.account.birthMonthPlaceholder">
                                <input class="settings-input" id="settingsBirthYear" type="number" min="0" max="2100" placeholder="Год (опц.)" style="width: 140px;" data-i18n-placeholder="settings.account.birthYearPlaceholder">
                            </div>
                            <div class="settings-note" style="margin-top:0.5rem;" data-i18n="settings.account.birthdayNote">Оставьте 0, чтобы не указывать</div>
                        </div>
                        <div class="settings-actions">
                            <button class="btn-primary" id="saveAccountSettingsBtn" type="button" data-i18n="settings.save">Сохранить</button>
                        </div>
                    </section>

                    <section class="settings-section" data-section="notifications">
                        <div class="settings-card">
                            <h3 data-i18n="settings.notifications.title">Уведомления</h3>
                            <div class="settings-row">
                                <label data-i18n="settings.notifications.desktop">Уведомления рабочего стола</label>
                                <label class="switch">
                                    <input type="checkbox" id="notifDesktopToggle">
                                    <span class="switch-slider"></span>
                                </label>
                            </div>
                            <div class="settings-row">
                                <label data-i18n="settings.notifications.sound">Звук сообщений</label>
                                <label class="switch">
                                    <input type="checkbox" id="notifSoundToggle">
                                    <span class="switch-slider"></span>
                                </label>
                            </div>
                            <div class="settings-row">
                                <label data-i18n="settings.notifications.preview">Показывать превью сообщений</label>
                                <label class="switch">
                                    <input type="checkbox" id="notifPreviewToggle">
                                    <span class="switch-slider"></span>
                                </label>
                            </div>
                            <div class="settings-row">
                                <label data-i18n="settings.notifications.callSound">Звук звонков</label>
                                <label class="switch">
                                    <input type="checkbox" id="notifCallSoundToggle">
                                    <span class="switch-slider"></span>
                                </label>
                            </div>
                            <div class="settings-row">
                                <label data-i18n="settings.notifications.vibration">Вибрация</label>
                                <label class="switch">
                                    <input type="checkbox" id="notifVibrationToggle">
                                    <span class="switch-slider"></span>
                                </label>
                            </div>
                        </div>
                        <div class="settings-card">
                            <h3 data-i18n="settings.notifications.quietHours">Тихие часы</h3>
                            <div class="settings-row" style="align-items:flex-start;">
                                <label data-i18n="settings.notifications.quietRange">Время тишины</label>
                                <div style="display:flex; gap:0.5rem; flex-wrap:wrap;">
                                    <input class="settings-input" id="quietHoursFrom" type="time" value="23:00" style="width: 120px;">
                                    <input class="settings-input" id="quietHoursTo" type="time" value="08:00" style="width: 120px;">
                                </div>
                            </div>
                            <div class="settings-note" data-i18n="settings.notifications.quietNote">Уведомления будут тихими в этом диапазоне</div>
                        </div>
                        <div class="settings-card">
                            <h3 data-i18n="settings.notifications.events">События</h3>
                            <div class="settings-row">
                                <label data-i18n="settings.notifications.contactJoin">Новые контакты в Xipher-подобных чатах</label>
                                <label class="switch">
                                    <input type="checkbox" id="notifContactJoinToggle">
                                    <span class="switch-slider"></span>
                                </label>
                            </div>
                            <div class="settings-row">
                                <label data-i18n="settings.notifications.pinned">Закрепленные сообщения</label>
                                <label class="switch">
                                    <input type="checkbox" id="notifPinnedToggle">
                                    <span class="switch-slider"></span>
                                </label>
                            </div>
                        </div>
                    </section>

                    <section class="settings-section" data-section="calls">
                        <div class="settings-card">
                            <h3 data-i18n="settings.calls.title">Звонки</h3>
                            <div class="settings-row">
                                <label data-i18n="settings.calls.accept">Принимать звонки</label>
                                <label class="switch">
                                    <input type="checkbox" id="callsAllowToggle" checked>
                                    <span class="switch-slider"></span>
                                </label>
                            </div>
                            <div class="settings-row">
                                <label data-i18n="settings.calls.who">Кто может звонить</label>
                                <select class="settings-select" id="callsWhoSelect">
                                    <option value="everyone" data-i18n="settings.privacy.everyone">Все</option>
                                    <option value="contacts" data-i18n="settings.privacy.contacts">Друзья</option>
                                    <option value="nobody" data-i18n="settings.privacy.nobody">Никто</option>
                                </select>
                            </div>
                        </div>
                        <div class="settings-card">
                            <h3 data-i18n="settings.calls.qualityTitle">Качество</h3>
                            <div class="settings-row">
                                <label data-i18n="settings.calls.cameraQuality">Камера</label>
                                <div class="settings-inline">
                                    <select class="settings-select" id="callCameraQualitySelect" aria-label="Camera resolution">
                                        <option value="360">360p</option>
                                        <option value="540">540p</option>
                                        <option value="720">720p</option>
                                        <option value="1080" data-premium="true">1080p • Premium</option>
                                    </select>
                                    <select class="settings-select" id="callCameraFpsSelect" aria-label="Camera FPS">
                                        <option value="15">15 FPS</option>
                                        <option value="30" data-premium="true">30 FPS • Premium</option>
                                        <option value="60" data-premium="true">60 FPS • Premium</option>
                                    </select>
                                </div>
                            </div>
                            <div class="settings-row">
                                <label data-i18n="settings.calls.screenQuality">Демонстрация экрана</label>
                                <div class="settings-inline">
                                    <select class="settings-select" id="callScreenQualitySelect" aria-label="Screen share resolution">
                                        <option value="360">360p</option>
                                        <option value="540">540p</option>
                                        <option value="720">720p</option>
                                        <option value="1080" data-premium="true">1080p • Premium</option>
                                    </select>
                                    <select class="settings-select" id="callScreenFpsSelect" aria-label="Screen share FPS">
                                        <option value="15">15 FPS</option>
                                        <option value="30" data-premium="true">30 FPS • Premium</option>
                                        <option value="60" data-premium="true">60 FPS • Premium</option>
                                    </select>
                                </div>
                            </div>
                            <div class="settings-note" id="callQualityPremiumNote" data-i18n="settings.calls.qualityPremiumNote" style="display:none;">
                                HD и 60 FPS доступны в Premium.
                            </div>
                        </div>
                    </section>

                    <section class="settings-section" data-section="privacy">
                        <div class="settings-card">
                            <h3 data-i18n="settings.privacy.autoDelete">Авто-удаленные сообщения</h3>
                            <div class="settings-row">
                                <label for="autoDeleteSelect" data-i18n="settings.privacy.interval">Интервал</label>
                                <select class="settings-select" id="autoDeleteSelect">
                                    <option value="off" data-i18n="settings.privacy.off">Выкл</option>
                                    <option value="1d" data-i18n="settings.privacy.after1d">Через 1 день</option>
                                    <option value="1w" data-i18n="settings.privacy.after1w">Через 1 неделю</option>
                                    <option value="1m" data-i18n="settings.privacy.after1m">Через 1 месяц</option>
                                    <option value="custom" data-i18n="settings.privacy.custom">Своё время</option>
                                </select>
                            </div>
                            <div class="settings-row" id="autoDeleteCustomRow" style="display:none;">
                                <label for="autoDeleteCustom" data-i18n="settings.privacy.customDays">Своё время (дни)</label>
                                <input class="settings-input" id="autoDeleteCustom" type="number" min="1" max="365" placeholder="30" data-i18n-placeholder="settings.privacy.customDaysPlaceholder">
                            </div>
                        </div>
                        <div class="settings-card">
                            <h3 data-i18n="settings.privacy.personal">Персональные данные</h3>
                            <div class="settings-row">
                                <label data-i18n="settings.privacy.lastSeen">Последнее время входа и онлайн</label>
                                <select class="settings-select" id="privacyLastSeenSelect">
                                    <option value="everyone" data-i18n="settings.privacy.everyone">Все</option>
                                    <option value="contacts" data-i18n="settings.privacy.contacts">Друзья</option>
                                    <option value="nobody" data-i18n="settings.privacy.nobody">Никто</option>
                                </select>
                            </div>
                            <div class="settings-row">
                                <label data-i18n="settings.privacy.forward">Пересылать от тебя сообщения</label>
                                <select class="settings-select" id="privacyForwardSelect">
                                    <option value="everyone" data-i18n="settings.privacy.everyone">Все</option>
                                    <option value="contacts" data-i18n="settings.privacy.contacts">Друзья</option>
                                    <option value="nobody" data-i18n="settings.privacy.nobody">Никто</option>
                                </select>
                            </div>
                            <div class="settings-row">
                                <label data-i18n="settings.privacy.calls">Звонить тебе</label>
                                <select class="settings-select" id="privacyCallsSelect">
                                    <option value="everyone" data-i18n="settings.privacy.everyone">Все</option>
                                    <option value="contacts" data-i18n="settings.privacy.contacts">Друзья</option>
                                    <option value="nobody" data-i18n="settings.privacy.nobody">Никто</option>
                                </select>
                            </div>
                            <div class="settings-row">
                                <label data-i18n="settings.privacy.voice">Отправлять тебе голосовые сообщения</label>
                                <select class="settings-select" id="privacyVoiceSelect">
                                    <option value="everyone" data-i18n="settings.privacy.everyone">Все</option>
                                    <option value="contacts" data-i18n="settings.privacy.contacts">Друзья</option>
                                    <option value="nobody" data-i18n="settings.privacy.nobody">Никто</option>
                                </select>
                            </div>
                            <div class="settings-row">
                                <label data-i18n="settings.privacy.messages">Отправлять тебе сообщения</label>
                                <select class="settings-select" id="privacyMessagesSelect">
                                    <option value="everyone" data-i18n="settings.privacy.everyone">Все</option>
                                    <option value="contacts" data-i18n="settings.privacy.contacts">Друзья</option>
                                    <option value="nobody" data-i18n="settings.privacy.nobody">Никто</option>
                                </select>
                            </div>
                            <div class="settings-row toggle-row">
                                <label for="privacyReadReceiptsToggle" data-i18n="settings.privacy.readReceipts">Отправлять отчеты о прочтении</label>
                                <label class="toggle-switch">
                                    <input id="privacyReadReceiptsToggle" type="checkbox">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            <div class="settings-row toggle-row">
                                <label for="privacyChatListBlurToggle" data-i18n="settings.privacy.chatListBlur">Размывать превью в списке чатов</label>
                                <label class="toggle-switch">
                                    <input id="privacyChatListBlurToggle" type="checkbox">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            <div class="settings-row">
                                <label data-i18n="settings.privacy.birth">Смотреть твою дату рождения</label>
                                <select class="settings-select" id="privacyBirthSelect">
                                    <option value="everyone" data-i18n="settings.privacy.everyone">Все</option>
                                    <option value="contacts" data-i18n="settings.privacy.contacts">Друзья</option>
                                    <option value="nobody" data-i18n="settings.privacy.nobody">Никто</option>
                                </select>
                            </div>
                            <div class="settings-row">
                                <label data-i18n="settings.privacy.bio">Смотреть описание твоего профиля</label>
                                <select class="settings-select" id="privacyBioSelect">
                                    <option value="everyone" data-i18n="settings.privacy.everyone">Все</option>
                                    <option value="contacts" data-i18n="settings.privacy.contacts">Друзья</option>
                                    <option value="nobody" data-i18n="settings.privacy.nobody">Никто</option>
                                </select>
                            </div>
                            <div class="settings-row">
                                <label data-i18n="settings.privacy.groups">Добавлять тебя в группы и каналы</label>
                                <select class="settings-select" id="privacyGroupsSelect">
                                    <option value="everyone" data-i18n="settings.privacy.everyone">Все</option>
                                    <option value="contacts" data-i18n="settings.privacy.contacts">Друзья</option>
                                    <option value="nobody" data-i18n="settings.privacy.nobody">Никто</option>
                                </select>
                            </div>
                        </div>
                        <div class="settings-card">
                            <h3 data-i18n="settings.privacy.deleteInactive">Удалить мой аккаунт при неактивности</h3>
                            <div class="settings-row">
                                <label for="deleteAccountSelect" data-i18n="settings.privacy.period">Период</label>
                                <select class="settings-select" id="deleteAccountSelect">
                                    <option value="1m" data-i18n="settings.privacy.after1mDelete">Через 1 месяц</option>
                                    <option value="3m" data-i18n="settings.privacy.after3m">Через 3 месяца</option>
                                    <option value="6m" data-i18n="settings.privacy.after6m">Через 6 месяцев</option>
                                    <option value="12m" data-i18n="settings.privacy.after12m">Через 12 месяцев</option>
                                    <option value="24m" data-i18n="settings.privacy.after24m">Через 2 года</option>
                                    <option value="custom" data-i18n="settings.privacy.customPeriod">Кастомное время</option>
                                </select>
                            </div>
                            <div class="settings-row" id="deleteAccountCustomRow" style="display:none;">
                                <label for="deleteAccountCustom" data-i18n="settings.privacy.customMonths">Кастомное время (от 1 мес.)</label>
                                <input class="settings-input" id="deleteAccountCustom" type="number" min="1" max="36" placeholder="6" data-i18n-placeholder="settings.privacy.customMonthsPlaceholder">
                            </div>
                        </div>
                        <div class="settings-actions">
                            <button class="btn-primary" id="savePrivacySettingsBtn" type="button" data-i18n="settings.save">Сохранить</button>
                        </div>
                    </section>

                    <section class="settings-section" data-section="sessions">
                        <div class="settings-card">
                            <h3 data-i18n="settings.sessions.title">Активные сеансы</h3>
                            <div class="settings-note" id="currentSessionNote" data-i18n="settings.sessions.current">Текущий сеанс (этот девайс)</div>
                            <div class="settings-divider"></div>
                            <div class="settings-row">
                                <label data-i18n="settings.sessions.browser">Браузер</label>
                                <span class="settings-note" id="sessionBrowserLabel">Web</span>
                            </div>
                            <div class="settings-row">
                                <label data-i18n="settings.sessions.lastActivity">Последняя активность</label>
                                <span class="settings-note" id="sessionLastSeenLabel">сейчас</span>
                            </div>
                        </div>
                        <div class="settings-card">
                            <h3 data-i18n="settings.sessions.other">Другие устройства</h3>
                            <div class="settings-list" id="otherSessionsList"></div>
                            <div class="settings-note" id="otherSessionsEmpty" data-i18n="settings.sessions.empty">Нет других сеансов</div>
                            <div class="settings-actions" style="margin-top:0.75rem; gap: 0.5rem; display: flex; flex-wrap: wrap;">
                                <button class="btn-secondary" id="endSelectedSessionsBtn" type="button" disabled data-i18n="settings.sessions.endSelected">Завершить выбранные</button>
                                <button class="btn-secondary" id="endOtherSessionsBtn" type="button" data-i18n="settings.sessions.endAll">Завершить все остальные</button>
                            </div>
                        </div>
                    </section>

                    <section class="settings-section" data-section="blocked">
                        <div class="settings-card">
                            <h3 data-i18n="settings.blocked.title">Заблокированные пользователи</h3>
                            <div class="settings-note" style="margin-bottom:0.75rem;" data-i18n="settings.blocked.note">Нажмите на пользователя, чтобы увидеть детали блокировки</div>
                            <div class="settings-list" id="blockedUsersList"></div>
                            <div class="settings-note" id="blockedUsersEmpty" data-i18n="settings.blocked.empty">Список пуст</div>
                        </div>
                    </section>

                    <section class="settings-section" data-section="login">
                        <div class="settings-card">
                            <h3 data-i18n="settings.login.title">Login email</h3>
                            <div class="settings-note" style="margin-bottom:0.5rem;" data-i18n="settings.login.note">Email для восстановления пароля (предлагается после регистрации)</div>
                            <div class="settings-row">
                                <label for="loginEmailInput" data-i18n="settings.login.email">Email</label>
                                <input class="settings-input" id="loginEmailInput" type="email" placeholder="you@example.com">
                            </div>
                            <div class="settings-actions">
                                <button class="btn-primary" id="saveLoginEmailBtn" type="button" data-i18n="settings.save">Сохранить</button>
                            </div>
                        </div>
                    </section>

                    <section class="settings-section" data-section="language">
                        <div class="settings-card">
                            <h3 data-i18n="settings.language.title">Язык</h3>
                            <div class="settings-note" style="margin-bottom:0.6rem;" data-i18n="settings.language.note">Смена на русский или английский</div>
                            <div class="settings-row">
                                <label data-i18n="settings.language.label">Выбор языка</label>
                                <select class="settings-select" id="settingsLanguageSelect">
                                    <option value="ru" data-i18n="settings.language.ru">Русский</option>
                                    <option value="en" data-i18n="settings.language.en">English</option>
                                </select>
                            </div>
                        </div>
                    </section>

                    <section class="settings-section" data-section="premium">
                        <div class="premium-shell">
                            <div class="settings-card premium-card premium-main">
                                <div class="premium-hero">
                                    <div class="premium-hero-icon">★</div>
                                    <div class="premium-hero-copy">
                                        <div class="premium-title" data-i18n="settings.premium.title">Xipher Premium</div>
                                        <div class="settings-note premium-subtitle" data-i18n="settings.premium.subtitle">Новый уровень для чатов, папок и профиля.</div>
                                    </div>
                                </div>
                                <div class="premium-status-row">
                                    <span class="premium-status-pill" id="premiumStatusPill"></span>
                                    <span class="premium-limit-note" id="premiumFolderLimitNote"></span>
                                    <span class="premium-expiry-note" id="premiumExpiryNote" style="display: none;"></span>
                                    <span class="premium-payment-status" id="premiumPaymentStatus" style="display: none;"></span>
                                    <span class="premium-payment-timer" id="premiumPaymentTimer" style="display: none;"></span>
                                </div>
                                <div class="premium-plan-selector" id="premiumPlanSelector">
                                    <label class="premium-plan-option" data-plan="trial">
                                        <input class="premium-plan-radio" type="radio" name="premiumPlan" id="premiumPlanTrial" value="trial">
                                        <div class="premium-plan-info">
                                            <div class="premium-plan-meta">
                                                <div class="premium-plan-title" data-i18n="settings.premium.plan.trial.title">Пробный</div>
                                                <div class="premium-plan-billing" data-i18n="settings.premium.plan.trial.billing">7 дней</div>
                                            </div>
                                            <div class="premium-plan-price">9 ₽</div>
                                            <span class="premium-plan-badge" data-i18n="settings.premium.plan.trial.tag">7 дней</span>
                                        </div>
                                    </label>
                                    <label class="premium-plan-option" data-plan="year">
                                        <input class="premium-plan-radio" type="radio" name="premiumPlan" id="premiumPlanYear" value="year">
                                        <div class="premium-plan-info">
                                            <div class="premium-plan-meta">
                                                <div class="premium-plan-title" data-i18n="settings.premium.plan.year.title">Годовой</div>
                                                <div class="premium-plan-billing" data-i18n="settings.premium.plan.year.billing">в год</div>
                                            </div>
                                            <div class="premium-plan-price">499 ₽</div>
                                            <span class="premium-plan-badge" data-i18n="settings.premium.plan.year.tag">-58%</span>
                                        </div>
                                    </label>
                                    <label class="premium-plan-option" data-plan="month">
                                        <input class="premium-plan-radio" type="radio" name="premiumPlan" id="premiumPlanMonth" value="month">
                                        <div class="premium-plan-info">
                                            <div class="premium-plan-meta">
                                                <div class="premium-plan-title" data-i18n="settings.premium.plan.month.title">Месячный</div>
                                                <div class="premium-plan-billing" data-i18n="settings.premium.plan.month.billing">в месяц</div>
                                            </div>
                                            <div class="premium-plan-price">99 ₽</div>
                                            <span class="premium-plan-badge" data-i18n="settings.premium.plan.month.tag">Гибко</span>
                                        </div>
                                    </label>
                                </div>
                                <div class="premium-cta-row">
                                    <button class="btn-primary premium-cta" id="premiumSubscribeBtn" type="button" data-i18n="settings.premium.cta.subscribe">Подключить</button>
                                    <button class="btn-secondary premium-cta premium-manage-btn" id="premiumManageBtn" type="button" data-i18n="settings.premium.manage" style="display: none;">Отключить Premium</button>
                                </div>
                                <div class="premium-stats">
                                    <div class="premium-stat">
                                        <div class="premium-stat-value" id="premiumFolderLimitValue">3</div>
                                        <div class="premium-stat-label" data-i18n="settings.premium.metric.limit">Лимит папок</div>
                                    </div>
                                    <div class="premium-stat">
                                        <div class="premium-stat-value" id="premiumFolderUsedValue">0</div>
                                        <div class="premium-stat-label" data-i18n="settings.premium.metric.used">Использовано</div>
                                    </div>
                                    <div class="premium-stat accent">
                                        <div class="premium-stat-value" id="premiumFolderRemainingValue">3</div>
                                        <div class="premium-stat-label" data-i18n="settings.premium.metric.remaining">Свободно</div>
                                    </div>
                                </div>
                            </div>

                            <div class="settings-card premium-card premium-features">
                                <h3 data-i18n="settings.premium.features.title">Возможности Premium</h3>
                                <div class="settings-note" data-i18n="settings.premium.features.note">Ключевые улучшения для общения и профиля.</div>
                                <div class="premium-feature-list">
                                    <div class="premium-feature">
                                        <div class="premium-feature-icon icon-limits" aria-hidden="true">
                                            <svg viewBox="0 0 24 24">
                                                <path d="M12 4l8 4-8 4-8-4 8-4z" />
                                                <path d="M4 12l8 4 8-4" />
                                                <path d="M4 16l8 4 8-4" />
                                            </svg>
                                        </div>
                                        <div>
                                            <div class="premium-feature-title" data-i18n="settings.premium.feature.double.title">x2 лимиты</div>
                                            <div class="premium-feature-desc" data-i18n="settings.premium.feature.double.desc">До 1000 каналов, 10 закрепленных чатов и 20 публичных ссылок.</div>
                                        </div>
                                    </div>
                                    <div class="premium-feature">
                                        <div class="premium-feature-icon icon-video" aria-hidden="true">
                                            <svg viewBox="0 0 24 24">
                                                <rect x="4" y="6" width="16" height="12" rx="3" />
                                                <path d="M10 9l5 3-5 3z" />
                                            </svg>
                                        </div>
                                        <div>
                                            <div class="premium-feature-title" data-i18n="settings.premium.feature.video.title">Активные видео-аватары</div>
                                            <div class="premium-feature-desc" data-i18n="settings.premium.feature.video.desc">Загружайте GIF-аватары, которые проигрываются в списке чатов.</div>
                                        </div>
                                    </div>
                                    <div class="premium-feature">
                                        <div class="premium-feature-icon icon-quality" aria-hidden="true">
                                            <svg viewBox="0 0 24 24">
                                                <path d="M4 12h6l2-3 3 6 2-3h3" />
                                                <circle cx="18" cy="6" r="2" />
                                            </svg>
                                        </div>
                                        <div>
                                            <div class="premium-feature-title" data-i18n="settings.premium.feature.quality.title">HD звонки и демки</div>
                                            <div class="premium-feature-desc" data-i18n="settings.premium.feature.quality.desc">Камера и демонстрация экрана до 1080p и 60 FPS.</div>
                                        </div>
                                    </div>
                                    <div class="premium-feature">
                                        <div class="premium-feature-icon icon-bots" aria-hidden="true">
                                            <svg viewBox="0 0 24 24">
                                                <rect x="4" y="7" width="16" height="10" rx="3" />
                                                <circle cx="9" cy="12" r="1.5" />
                                                <circle cx="15" cy="12" r="1.5" />
                                                <path d="M12 7V4" />
                                                <path d="M10 4h4" />
                                            </svg>
                                        </div>
                                        <div>
                                            <div class="premium-feature-title" data-i18n="settings.premium.feature.bots.title">Боты и Bot IDE</div>
                                            <div class="premium-feature-desc" data-i18n="settings.premium.feature.bots.desc">Создавайте ботов, используйте шаблоны и редактируйте код.</div>
                                        </div>
                                    </div>
                                    <div class="premium-feature">
                                        <div class="premium-feature-icon icon-badge" aria-hidden="true">
                                            <svg viewBox="0 0 24 24">
                                                <path d="M12 3l2.6 5.3 5.9.9-4.3 4.2 1 5.9-5.2-2.8-5.2 2.8 1-5.9-4.3-4.2 5.9-.9z" />
                                            </svg>
                                        </div>
                                        <div>
                                            <div class="premium-feature-title" data-i18n="settings.premium.feature.badge.title">Profile Badge</div>
                                            <div class="premium-feature-desc" data-i18n="settings.premium.feature.badge.desc">Звездочка рядом с именем показывает Premium-статус.</div>
                                        </div>
                                    </div>
                                    <div class="premium-feature">
                                        <div class="premium-feature-icon icon-business" aria-hidden="true">
                                            <svg viewBox="0 0 24 24">
                                                <path d="M9 6V5a2 2 0 0 1 2-2h2a2 2 0 0 1 2 2v1" />
                                                <rect x="3" y="6" width="18" height="13" rx="2" />
                                                <path d="M3 11h18" />
                                            </svg>
                                        </div>
                                        <div>
                                            <div class="premium-feature-title" data-i18n="settings.premium.feature.business.title">Xipher для бизнеса</div>
                                            <div class="premium-feature-desc" data-i18n="settings.premium.feature.business.desc">Настройте часы работы для профиля и контактов.</div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="settings-card premium-card premium-business" id="premiumBusinessCard">
                                <div class="premium-business-header">
                                    <div>
                                        <h3 data-i18n="settings.premium.business.title">Xipher для бизнеса</h3>
                                        <div class="settings-note" data-i18n="settings.premium.business.note">График работы на все дни недели.</div>
                                    </div>
                                </div>
                                <div class="business-hours-grid" id="businessHoursGrid">
                                    <div class="business-hours-row" data-day="mon">
                                        <div class="business-day-label">
                                            <span data-i18n="settings.business.day.mon">Пн</span>
                                            <label class="switch">
                                                <input type="checkbox" class="business-day-toggle" checked>
                                                <span class="switch-slider"></span>
                                            </label>
                                        </div>
                                        <div class="business-time-range">
                                            <input type="time" class="business-time-input" data-role="start" value="09:00">
                                            <span class="business-time-sep">—</span>
                                            <input type="time" class="business-time-input" data-role="end" value="18:00">
                                        </div>
                                    </div>
                                    <div class="business-hours-row" data-day="tue">
                                        <div class="business-day-label">
                                            <span data-i18n="settings.business.day.tue">Вт</span>
                                            <label class="switch">
                                                <input type="checkbox" class="business-day-toggle" checked>
                                                <span class="switch-slider"></span>
                                            </label>
                                        </div>
                                        <div class="business-time-range">
                                            <input type="time" class="business-time-input" data-role="start" value="09:00">
                                            <span class="business-time-sep">—</span>
                                            <input type="time" class="business-time-input" data-role="end" value="18:00">
                                        </div>
                                    </div>
                                    <div class="business-hours-row" data-day="wed">
                                        <div class="business-day-label">
                                            <span data-i18n="settings.business.day.wed">Ср</span>
                                            <label class="switch">
                                                <input type="checkbox" class="business-day-toggle" checked>
                                                <span class="switch-slider"></span>
                                            </label>
                                        </div>
                                        <div class="business-time-range">
                                            <input type="time" class="business-time-input" data-role="start" value="09:00">
                                            <span class="business-time-sep">—</span>
                                            <input type="time" class="business-time-input" data-role="end" value="18:00">
                                        </div>
                                    </div>
                                    <div class="business-hours-row" data-day="thu">
                                        <div class="business-day-label">
                                            <span data-i18n="settings.business.day.thu">Чт</span>
                                            <label class="switch">
                                                <input type="checkbox" class="business-day-toggle" checked>
                                                <span class="switch-slider"></span>
                                            </label>
                                        </div>
                                        <div class="business-time-range">
                                            <input type="time" class="business-time-input" data-role="start" value="09:00">
                                            <span class="business-time-sep">—</span>
                                            <input type="time" class="business-time-input" data-role="end" value="18:00">
                                        </div>
                                    </div>
                                    <div class="business-hours-row" data-day="fri">
                                        <div class="business-day-label">
                                            <span data-i18n="settings.business.day.fri">Пт</span>
                                            <label class="switch">
                                                <input type="checkbox" class="business-day-toggle" checked>
                                                <span class="switch-slider"></span>
                                            </label>
                                        </div>
                                        <div class="business-time-range">
                                            <input type="time" class="business-time-input" data-role="start" value="09:00">
                                            <span class="business-time-sep">—</span>
                                            <input type="time" class="business-time-input" data-role="end" value="18:00">
                                        </div>
                                    </div>
                                    <div class="business-hours-row" data-day="sat">
                                        <div class="business-day-label">
                                            <span data-i18n="settings.business.day.sat">Сб</span>
                                            <label class="switch">
                                                <input type="checkbox" class="business-day-toggle">
                                                <span class="switch-slider"></span>
                                            </label>
                                        </div>
                                        <div class="business-time-range">
                                            <input type="time" class="business-time-input" data-role="start" value="10:00">
                                            <span class="business-time-sep">—</span>
                                            <input type="time" class="business-time-input" data-role="end" value="16:00">
                                        </div>
                                    </div>
                                    <div class="business-hours-row" data-day="sun">
                                        <div class="business-day-label">
                                            <span data-i18n="settings.business.day.sun">Вс</span>
                                            <label class="switch">
                                                <input type="checkbox" class="business-day-toggle">
                                                <span class="switch-slider"></span>
                                            </label>
                                        </div>
                                        <div class="business-time-range">
                                            <input type="time" class="business-time-input" data-role="start" value="10:00">
                                            <span class="business-time-sep">—</span>
                                            <input type="time" class="business-time-input" data-role="end" value="16:00">
                                        </div>
                                    </div>
                                </div>
                                <div class="premium-business-actions">
                                    <button class="btn-secondary" id="saveBusinessHoursBtn" type="button" data-i18n="settings.premium.business.save">Сохранить график</button>
                                </div>
                                <div class="premium-business-lock" id="premiumBusinessLock" data-i18n="settings.premium.business.lock">Доступно с Premium</div>
                            </div>
                        </div>
                    </section>

                    <section class="settings-section" data-section="faq">
                        <div class="settings-card">
                            <h3 data-i18n="settings.faq.title">Xipher FAQ</h3>
                            <div class="settings-note" style="margin-bottom:0.75rem;" data-i18n="settings.faq.note">Ответы на вопросы о Xipher как в Android-клиенте.</div>
                            <div class="faq-list">
                                <details>
                                    <summary data-i18n="settings.faq.q1">Как создать канал или группу?</summary>
                                    <div class="settings-note" data-i18n="settings.faq.a1">Откройте меню (☰) и выберите “Создать канал” или “Создать группу”.</div>
                                </details>
                                <details>
                                    <summary data-i18n="settings.faq.q2">Как изменить тему?</summary>
                                    <div class="settings-note" data-i18n="settings.faq.a2">В меню переключите тему или откройте “Настройки” → “Язык”.</div>
                                </details>
                                <details>
                                    <summary data-i18n="settings.faq.q3">Где найти QR-профиль?</summary>
                                    <div class="settings-note" data-i18n="settings.faq.a3">Откройте “Настройки” и нажмите кнопку QR в правом верхнем углу.</div>
                                </details>
                                <details>
                                    <summary data-i18n="settings.faq.q4">Почему боты за Premium?</summary>
                                    <div class="settings-note" data-i18n="settings.faq.a4">Мы размещаем ваши проекты на хостинге, поэтому создание ботов — платная функция.</div>
                                </details>
                            </div>
                        </div>
                    </section>
                </div>
            </div>
        </div>
    </div>

    <div class="qr-overlay" id="qrOverlay" aria-hidden="true">
        <div class="qr-card">
            <h3 style="margin:0 0 0.75rem 0; color: var(--text-primary);">Ваш QR-профиль</h3>
            <div class="qr-frame">
                <img id="qrImage" src="" alt="QR">
            </div>
            <div class="settings-note" id="qrSubtitle">Сканируйте, чтобы открыть профиль</div>
            <button class="btn-secondary qr-close" id="qrCloseBtn" type="button">Закрыть</button>
        </div>
    </div>

    <div class="modal-overlay" id="premiumCancelModal" style="display: none;">
        <div class="modal-content" style="max-width: 420px; width: 92%;">
            <div class="modal-header">
                <h2 data-i18n="settings.premium.cancel.title">Отключить Premium?</h2>
                <button class="close-btn" id="premiumCancelCloseBtn">&times;</button>
            </div>
            <div class="modal-body">
                <div class="settings-note" data-i18n="settings.premium.cancel.note">Premium останется активным до конца оплаченного периода.</div>
                <div class="modal-actions">
                    <button class="btn-secondary" id="premiumCancelNoBtn" type="button" data-i18n="settings.premium.cancel.no">Отмена</button>
                    <button class="btn-primary" id="premiumCancelYesBtn" type="button" data-i18n="settings.premium.cancel.yes">Отключить</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="premiumPaymentModal" style="display: none;">
        <div class="modal-content premium-payment-modal">
            <div class="modal-header">
                <h2 data-i18n="settings.premium.payment.title">Оплата Premium</h2>
                <button class="close-btn" id="premiumPaymentCloseBtn">&times;</button>
            </div>
            <div class="modal-body">
                <div class="premium-payment-summary">
                    <div class="premium-payment-plan" id="premiumPaymentPlanLabel">Годовой</div>
                    <div class="premium-payment-amount" id="premiumPaymentAmount">499 ₽</div>
                    <div class="settings-note" id="premiumPaymentNote" data-i18n="settings.premium.payment.note.yoomoney">Оплата проходит на защищенной странице YooMoney.</div>
                </div>
                <div class="premium-payment-methods" id="premiumPaymentProviderList">
                    <label class="premium-payment-method">
                        <input type="radio" name="premiumPaymentProvider" value="yoomoney" checked>
                        <span class="premium-payment-method-title" data-i18n="settings.premium.payment.provider.yoomoney">РФ карты (ЮMoney)</span>
                    </label>
                    <label class="premium-payment-method">
                        <input type="radio" name="premiumPaymentProvider" value="stripe">
                        <span class="premium-payment-method-title" data-i18n="settings.premium.payment.provider.stripe">Stripe (международные карты)</span>
                    </label>
                </div>
                <div class="premium-payment-methods" id="premiumPaymentYooMoneyMethods">
                    <label class="premium-payment-method">
                        <input type="radio" name="premiumPaymentType" value="AC" checked>
                        <span class="premium-payment-method-title" data-i18n="settings.premium.payment.method.card">Банковской картой</span>
                    </label>
                    <label class="premium-payment-method">
                        <input type="radio" name="premiumPaymentType" value="PC">
                        <span class="premium-payment-method-title" data-i18n="settings.premium.payment.method.wallet">Кошельком ЮMoney</span>
                    </label>
                </div>
                <div class="premium-payment-actions">
                    <button class="btn-secondary" id="premiumPaymentCancelBtn" type="button" data-i18n="settings.premium.payment.cancel">Отмена</button>
                    <button class="btn-primary" id="premiumPaymentSubmitBtn" type="button" data-i18n="settings.premium.payment.pay">Перейти к оплате</button>
                </div>
                <div class="premium-payment-footnote" data-i18n="settings.premium.payment.footnote">Окно оплаты откроется отдельно.</div>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="premiumGiftModal" style="display: none;">
        <div class="modal-content premium-gift-modal">
            <div class="modal-header premium-gift-modal-header">
                <button class="close-btn" id="premiumGiftCloseBtn" aria-label="Закрыть">&times;</button>
            </div>
            <div class="modal-body">
                <div class="premium-gift-card premium-gift">
                    <div class="premium-gift-hero">
                        <div class="premium-gift-icon" aria-hidden="true">
                            <svg viewBox="0 0 64 64">
                                <rect class="gift-lid" x="10" y="20" width="44" height="10" rx="4" />
                                <rect class="gift-box" x="10" y="28" width="44" height="28" rx="8" />
                                <rect class="gift-ribbon" x="30" y="20" width="4" height="36" rx="2" />
                                <rect class="gift-ribbon" x="10" y="36" width="44" height="4" rx="2" />
                                <path class="gift-bow" d="M24 20c-4 0-6-3-6-6 0-3 2-6 6-6 5 0 8 6 8 6s-3 6-8 6z" />
                                <path class="gift-bow" d="M40 20c4 0 6-3 6-6 0-3-2-6-6-6-5 0-8 6-8 6s3 6 8 6z" />
                            </svg>
                        </div>
                        <div>
                            <div class="premium-gift-title" data-i18n="settings.premium.gift.title">Подарить Premium другу</div>
                            <div class="premium-gift-note" data-i18n="settings.premium.gift.note">На 1, 6 месяцев или год. 6 месяцев — 299 ₽.</div>
                        </div>
                    </div>
                    <div class="premium-gift-form">
                        <label class="premium-gift-field">
                            <span data-i18n="settings.premium.gift.username">Username получателя</span>
                            <input class="settings-input premium-gift-input" id="premiumGiftUsername" type="text" placeholder="@username" data-i18n-placeholder="settings.premium.gift.usernamePlaceholder">
                        </label>
                        <div class="premium-gift-plans" id="premiumGiftPlans" role="radiogroup">
                            <label class="premium-gift-plan" data-plan="month">
                                <input type="radio" name="premiumGiftPlan" value="month">
                                <div class="premium-gift-plan-title" data-i18n="settings.premium.gift.plan.month">1 месяц</div>
                                <div class="premium-gift-plan-price">99 ₽</div>
                            </label>
                            <label class="premium-gift-plan" data-plan="half">
                                <input type="radio" name="premiumGiftPlan" value="half" checked>
                                <div class="premium-gift-plan-title" data-i18n="settings.premium.gift.plan.half">6 месяцев</div>
                                <div class="premium-gift-plan-price">299 ₽</div>
                            </label>
                            <label class="premium-gift-plan" data-plan="year">
                                <input type="radio" name="premiumGiftPlan" value="year">
                                <div class="premium-gift-plan-title" data-i18n="settings.premium.gift.plan.year">1 год</div>
                                <div class="premium-gift-plan-price">499 ₽</div>
                            </label>
                        </div>
                        <div class="premium-gift-actions">
                            <button class="btn-primary" id="premiumGiftSendBtn" type="button" data-i18n="settings.premium.gift.send">Подарить Premium</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="liveLocationModal" style="display: none;">
        <div class="modal-content" style="max-width: 420px; width: 92%;">
            <div class="modal-header">
                <h2 data-i18n="chat.live.modalTitle">Живая геопозиция</h2>
                <button class="close-btn" id="liveLocationCloseBtn">&times;</button>
            </div>
            <div class="modal-body">
                <div class="settings-note" data-i18n="chat.live.modalSubtitle">Выберите длительность</div>
                <div class="live-location-options">
                    <button class="live-location-option" type="button" data-duration="900" data-i18n="chat.live.duration.15m">15 минут</button>
                    <button class="live-location-option" type="button" data-duration="3600" data-i18n="chat.live.duration.1h">1 час</button>
                    <button class="live-location-option" type="button" data-duration="28800" data-i18n="chat.live.duration.8h">8 часов</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="checklistModal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2 data-i18n="chat.checklist.title">Чек-лист</h2>
                <button class="close-btn" id="checklistModalClose">&times;</button>
            </div>
            <div class="modal-body checklist-modal-body">
                <input id="checklistTitleInput" class="modal-input" type="text" placeholder="Название чек-листа" data-i18n-placeholder="chat.checklist.titlePlaceholder">
                <div class="checklist-options">
                    <label class="checklist-option">
                        <input type="checkbox" id="checklistOthersCanMark" checked>
                        <span data-i18n="chat.checklist.othersCanMark">Другие могут отмечать</span>
                    </label>
                    <label class="checklist-option">
                        <input type="checkbox" id="checklistOthersCanAdd" checked>
                        <span data-i18n="chat.checklist.othersCanAdd">Другие могут добавлять</span>
                    </label>
                </div>
                <div class="checklist-items-editor" id="checklistItemsEditor"></div>
                <button class="btn-secondary" id="checklistAddItemBtn" type="button" data-i18n="chat.checklist.addItem">Добавить пункт</button>
            </div>
            <div class="modal-actions">
                <button class="btn-secondary" id="checklistCancelBtn" type="button" data-i18n="chat.checklist.cancel">Отмена</button>
                <button class="btn-primary" id="checklistSendBtn" type="button" data-i18n="chat.checklist.send">Отправить</button>
            </div>
        </div>
    </div>

    <!-- Модальное окно для добавления друга -->
    <div class="modal-overlay" id="addFriendModal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Добавить друга</h2>
                <button class="close-btn" id="closeModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="add-friend-search">
                    <input type="text" class="search-input" placeholder="Введите username или @channel..." id="friendSearchInput">
                    <button class="btn-primary" id="searchFriendBtn">Найти</button>
                </div>
                <div class="search-results" id="searchResults"></div>
            </div>
        </div>
    </div>

    <!-- Эмодзи пикер -->
    <div class="emoji-picker-container" id="emojiPicker" style="display: none;">
        <div class="emoji-picker">
            <div class="emoji-picker-header">
                <h3>Выберите эмодзи</h3>
                <button class="emoji-picker-close" id="emojiPickerClose">&times;</button>
            </div>
            <div class="emoji-picker-search">
                <input type="text" id="emojiSearch" placeholder="Поиск эмодзи...">
            </div>
            <div class="emoji-picker-grid" id="emojiGrid"></div>
        </div>
    </div>

    <!-- Модальное окно жалобы -->
    <div class="modal-overlay" id="reportModal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Пожаловаться на сообщение</h2>
                <button class="close-btn" id="closeReportModal">&times;</button>
            </div>
            <div class="modal-body">
                <p class="muted" id="reportMessagePreview"></p>
                <label for="reportReason" class="muted">Причина</label>
                <select id="reportReason" class="modal-input">
                    <option value="spam">Спам</option>
                    <option value="abuse">Оскорбление/абьюз</option>
                    <option value="other">Другое</option>
                </select>
                <label for="reportComment" class="muted" style="margin-top:8px; display:block;">Комментарий (необязательно)</label>
                <textarea id="reportComment" class="modal-textarea" rows="3" placeholder="Опишите проблему"></textarea>
                <div class="modal-actions">
                    <button class="btn-primary" id="submitReportBtn">Отправить</button>
                    <button class="btn-secondary" id="cancelReportBtn">Отмена</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Модальное окно удаления чата -->
    <div class="modal-overlay" id="deleteChatModal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Удалить чат</h2>
                <button class="close-btn" id="closeDeleteChatModal">&times;</button>
            </div>
            <div class="modal-body">
                <p class="muted" id="deleteChatSubtitle">Удалить чат?</p>
                <div class="modal-actions" style="display: flex; flex-wrap: wrap; gap: 0.5rem;">
                    <button class="btn-secondary" id="deleteChatCancelBtn">Отмена</button>
                    <button class="btn-secondary" id="deleteChatMeBtn">Удалить только у меня</button>
                    <button class="btn-danger" id="deleteChatAllBtn">Удалить у всех</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Модальное окно папок -->
    <div class="modal-overlay" id="foldersModal" style="display: none;">
        <div class="modal-content folder-modal">
            <div class="modal-header">
                <h2>Папки</h2>
                <button class="close-btn" id="closeFoldersModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="folder-hero">
                    <div class="folder-hero-icon">🗂️</div>
                    <div>
                        <div style="font-weight: 600; color: var(--text-primary);">Создавайте подборки</div>
                        <div class="settings-note">Группируйте чаты и переключайтесь между ними за секунды.</div>
                    </div>
                </div>
                <div>
                    <div class="folder-section-header">
                        <div class="folder-section-title">Мои папки</div>
                        <div class="folder-limit-pill" id="folderLimitPill">0 / 3</div>
                    </div>
                    <div class="settings-note folder-limit-note" id="folderLimitNote"></div>
                    <div class="folder-list" id="folderList"></div>
                </div>
                <button class="btn-secondary folder-create-btn" id="createFolderBtn">Создать новую папку</button>
                <button class="btn-secondary folder-upgrade-btn" id="folderUpgradeBtn" type="button">Подключить Premium</button>
            </div>
        </div>
    </div>

    <!-- Модальное окно создания/редактирования папки -->
    <div class="modal-overlay" id="folderEditorModal" style="display: none;">
        <div class="modal-content folder-editor">
            <div class="modal-header">
                <h2 id="folderEditorTitle">Новая папка</h2>
                <button class="close-btn" id="closeFolderEditorModal">&times;</button>
            </div>
            <div class="modal-body">
                <label for="folderNameInput" class="muted">Название папки</label>
                <input type="text" class="modal-input" id="folderNameInput" placeholder="Например: Работа">
                <div class="folder-editor-search">
                    <span class="search-icon">🔍</span>
                    <input type="text" class="search-input" id="folderChatSearch" placeholder="Поиск чатов...">
                </div>
                <div class="folder-chat-list" id="folderChatList"></div>
                <div class="modal-actions">
                    <button class="btn-primary" id="saveFolderBtn">Сохранить</button>
                    <button class="btn-secondary" id="cancelFolderBtn">Отмена</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Модальное окно добавления чата в папки -->
    <div class="modal-overlay" id="folderAssignModal" style="display: none;">
        <div class="modal-content folder-assign">
            <div class="modal-header">
                <h2 id="folderAssignTitle">Добавить в папки</h2>
                <button class="close-btn" id="closeFolderAssignModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="settings-note" id="folderAssignNote">Отметьте папки, где должен появиться этот чат.</div>
                <div class="folder-assign-list" id="folderAssignList"></div>
                <div class="modal-actions">
                    <button class="btn-secondary" id="createFolderFromAssignBtn">Создать папку</button>
                    <button class="btn-primary" id="saveFolderAssignBtn">Сохранить</button>
                    <button class="btn-secondary" id="cancelFolderAssignBtn">Отмена</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Подключаем библиотеку эмодзи через CDN для поддержки 100000+ эмодзи -->
    <!-- Используем unpkg для загрузки как веб-компонента -->
    <script type="module" src="https://unpkg.com/emoji-picker-element@latest/index.js"></script>
    
    <!-- Модальное окно для создания группы -->
    <div class="modal-overlay" id="createGroupModal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Создать группу</h2>
                <button class="close-btn" id="closeCreateGroupModal">&times;</button>
            </div>
            <div class="modal-body">
                <input type="text" id="groupNameInput" placeholder="Название группы" class="modal-input">
                <textarea id="groupDescriptionInput" placeholder="Описание (необязательно)" class="modal-textarea"></textarea>
                <div class="modal-actions">
                    <button class="btn-primary" id="confirmCreateGroupBtn">Создать</button>
                    <button class="btn-secondary" id="cancelCreateGroupBtn">Отмена</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Модальное окно для создания канала -->
    <div class="modal-overlay" id="createChannelModal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Создать канал</h2>
                <button class="close-btn" id="closeCreateChannelModal">&times;</button>
            </div>
            <div class="modal-body">
                <input type="text" id="channelNameInput" placeholder="Название канала" class="modal-input">
                <textarea id="channelDescriptionInput" placeholder="Описание (необязательно)" class="modal-textarea"></textarea>
                <div style="margin-top: 1rem;">
                    <label style="display: block; margin-bottom: 0.5rem; color: var(--text-secondary); font-size: 0.9rem;">Username (уникальный идентификатор)</label>
                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                        <span style="color: var(--text-muted);">@</span>
                        <input type="text" id="channelCustomLinkInput" placeholder="username" class="modal-input" style="flex: 1;">
                    </div>
                    <small style="color: var(--text-muted); font-size: 0.8rem; display: block; margin-top: 0.25rem;">Только буквы, цифры и подчеркивания (3-50 символов)</small>
                </div>
                <div class="modal-actions">
                    <button class="btn-primary" id="confirmCreateChannelBtn">Создать</button>
                    <button class="btn-secondary" id="cancelCreateChannelBtn">Отмена</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Модальное окно для редактирования канала -->
    <div class="modal-overlay" id="editChannelModal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Редактировать канал</h2>
                <button class="close-btn" id="closeEditChannelModal">&times;</button>
            </div>
            <div class="modal-body">
                <input type="text" id="editChannelNameInput" placeholder="Название канала" class="modal-input">
                <textarea id="editChannelDescriptionInput" placeholder="Описание (необязательно)" class="modal-textarea"></textarea>
                <div style="margin-top: 1rem;">
                    <label style="display: block; margin-bottom: 0.5rem; color: var(--text-secondary); font-size: 0.9rem;">Username</label>
                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                        <span style="color: var(--text-muted);">@</span>
                        <input type="text" id="editChannelCustomLinkInput" placeholder="username" class="modal-input" style="flex: 1;">
                    </div>
                </div>
                <div style="margin-top: 1rem; display: flex; gap: 1rem; align-items: center;">
                    <label style="color: var(--text-secondary); font-size: 0.9rem;">Приватный канал:</label>
                    <input type="checkbox" id="editChannelIsPrivate">
                </div>
                <div style="margin-top: 1rem; display: flex; gap: 1rem; align-items: center;">
                    <label style="color: var(--text-secondary); font-size: 0.9rem;">Показывать автора:</label>
                    <input type="checkbox" id="editChannelShowAuthor">
                </div>
                <div class="modal-actions">
                    <button class="btn-primary" id="confirmEditChannelBtn">Сохранить</button>
                    <button class="btn-secondary" id="cancelEditChannelBtn">Отмена</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Модальное окно настроек группы/канала -->
    <div class="modal-overlay" id="groupChannelSettingsModal" style="display: none;">
        <div class="modal-content" style="max-width: 800px; max-height: 90vh; overflow-y: auto;">
            <div class="modal-header">
                <h2 id="settingsModalTitle">Настройки</h2>
                <button class="close-btn" id="closeGroupChannelSettingsModal">&times;</button>
            </div>
            <div class="modal-body">
                <!-- Вкладки -->
                <div class="settings-tabs" style="display: flex; gap: 0.5rem; border-bottom: 1px solid var(--border-color); margin-bottom: 1.5rem;">
                    <button class="settings-tab active" data-tab="info">Информация</button>
                    <button class="settings-tab" data-tab="members">Участники</button>
                    <button class="settings-tab" data-tab="settings">Настройки</button>
                    <button class="settings-tab" data-tab="shop" id="shopTabBtn">Магазин</button>
                    <button class="settings-tab" data-tab="integrations" id="integrationsTabBtn">Интеграции</button>
                </div>

                <!-- Вкладка: Информация -->
                <div class="settings-tab-content active" id="settingsTabInfo">
                    <div style="margin-bottom: 1.5rem;">
                        <label style="display: block; margin-bottom: 0.5rem; color: var(--text-secondary); font-size: 0.9rem; font-weight: 600;">Название</label>
                        <input type="text" id="settingsNameInput" class="modal-input" placeholder="Название">
                    </div>
                    <div style="margin-bottom: 1.5rem;">
                        <label style="display: block; margin-bottom: 0.5rem; color: var(--text-secondary); font-size: 0.9rem; font-weight: 600;">Описание</label>
                        <textarea id="settingsDescriptionInput" class="modal-textarea" placeholder="Описание (необязательно)" rows="3"></textarea>
                    </div>
                    <div id="settingsCustomLinkSection" style="margin-bottom: 1.5rem;">
                        <label style="display: block; margin-bottom: 0.5rem; color: var(--text-secondary); font-size: 0.9rem; font-weight: 600;">Кастомная ссылка</label>
                        <div style="display: flex; align-items: center; gap: 0.5rem;">
                            <span style="color: var(--text-muted);">@</span>
                            <input type="text" id="settingsCustomLinkInput" class="modal-input" style="flex: 1;" placeholder="username">
                        </div>
                        <div id="settingsLinkExpirySection" style="margin-top: 0.5rem;">
                            <label style="display: block; margin-bottom: 0.5rem; color: var(--text-secondary); font-size: 0.85rem;">Срок действия ссылки</label>
                            <select id="settingsLinkExpirySelect" class="modal-input" style="width: 100%;">
                                <option value="0">Вечность</option>
                                <option value="60">1 минута</option>
                                <option value="3600">1 час</option>
                                <option value="21600">6 часов</option>
                                <option value="259200">3 дня</option>
                                <option value="604800">1 неделя</option>
                                <option value="2592000">1 месяц</option>
                                <option value="7776000">3 месяца</option>
                                <option value="15552000">6 месяцев</option>
                                <option value="31536000">1 год</option>
                            </select>
                        </div>
                    </div>
                    <div class="modal-actions">
                        <button class="btn-primary" id="saveInfoBtn">Сохранить</button>
                    </div>
                </div>

                <!-- Вкладка: Участники -->
                <div class="settings-tab-content" id="settingsTabMembers" style="display: none;">
                    <div style="margin-bottom: 1rem; display: flex; justify-content: space-between; align-items: center;">
                        <h3 style="margin: 0; color: var(--text-primary); font-size: 1.1rem;">Участники</h3>
                        <button class="btn-primary btn-small" id="addMemberBtn" style="display: none;">+ Добавить</button>
                    </div>
                    <div id="membersList" style="max-height: 400px; overflow-y: auto;">
                        <div style="padding: 2rem; text-align: center; color: var(--text-secondary);">Загрузка...</div>
                    </div>
                </div>

                <!-- Вкладка: Настройки -->
                <div class="settings-tab-content" id="settingsTabSettings" style="display: none;">
                    <div id="groupSettingsContent">
                        <h3 style="margin: 0 0 1rem 0; color: var(--text-primary); font-size: 1.1rem;">Настройки группы</h3>
                        <div style="margin-bottom: 1rem;">
                            <label style="display: flex; align-items: center; gap: 0.5rem; color: var(--text-secondary); cursor: pointer;">
                                <input type="checkbox" id="settingsPinMessage">
                                <span>Закрепить сообщение</span>
                            </label>
                        </div>
                        <div style="margin-bottom: 1rem;">
                            <label style="display: flex; align-items: center; gap: 0.5rem; color: var(--text-secondary); cursor: pointer;">
                                <input type="checkbox" id="settingsAddFriend">
                                <span>Добавить друга</span>
                            </label>
                        </div>
                    </div>
                    <div id="channelSettingsContent" style="display: none;">
                        <h3 style="margin: 0 0 1rem 0; color: var(--text-primary); font-size: 1.1rem;">Настройки канала</h3>
                        <div style="margin-bottom: 1rem;">
                            <label style="display: flex; align-items: center; gap: 0.5rem; color: var(--text-secondary); cursor: pointer;">
                                <input type="checkbox" id="settingsChannelPrivate">
                                <span>Приватный канал</span>
                            </label>
                            <small style="display: block; margin-top: 0.25rem; color: var(--text-muted); font-size: 0.85rem;">Новые участники могут вступить только по приглашению</small>
                        </div>
                        <div style="margin-bottom: 1rem;">
                            <label style="display: flex; align-items: center; gap: 0.5rem; color: var(--text-secondary); cursor: pointer;">
                                <input type="checkbox" id="settingsChannelShowAuthor">
                                <span>Показывать автора сообщений</span>
                            </label>
                            <small style="display: block; margin-top: 0.25rem; color: var(--text-muted); font-size: 0.85rem;">Отображать username автора в сообщениях</small>
                        </div>
                        <div style="margin-bottom: 1rem; padding: 12px; background: var(--bg-secondary); border-radius: 8px;">
                            <label style="display: block; margin-bottom: 0.5rem; color: var(--text-secondary); font-size: 0.9rem; font-weight: 600;">🧭 Публичный каталог</label>
                            <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                                <label style="display: flex; align-items: center; gap: 0.5rem; color: var(--text-secondary); cursor: pointer; flex: 1;">
                                    <input type="checkbox" id="settingsChannelPublicCatalog">
                                    <span>Показывать в каталоге</span>
                                </label>
                            </div>
                            <select id="settingsChannelCategory" style="width: 100%; padding: 8px; border-radius: 6px; border: 1px solid var(--border-subtle); background: var(--bg-primary); color: var(--text-primary); font-size: 14px;">
                                <option value="">📁 Без категории</option>
                                <option value="news">📰 Новости</option>
                                <option value="tech">💻 Технологии</option>
                                <option value="crypto">₿ Крипто</option>
                                <option value="gaming">🎮 Игры</option>
                                <option value="music">🎵 Музыка</option>
                                <option value="movies">🎬 Кино</option>
                                <option value="education">📚 Образование</option>
                                <option value="sport">⚽ Спорт</option>
                                <option value="art">🎨 Искусство</option>
                                <option value="food">🍕 Еда</option>
                                <option value="travel">✈️ Путешествия</option>
                                <option value="business">💼 Бизнес</option>
                                <option value="health">❤️ Здоровье</option>
                                <option value="science">🔬 Наука</option>
                                <option value="people">👥 Общение</option>
                            </select>
                            <small style="display: block; margin-top: 0.25rem; color: var(--text-muted); font-size: 0.85rem;">Публичные каналы видны всем пользователям в каталоге</small>
                        </div>
                        <div style="margin-bottom: 1rem;">
                            <label style="display: flex; align-items: center; gap: 0.5rem; color: var(--text-secondary); cursor: pointer;">
                                <input type="checkbox" id="settingsChannelPinMessage">
                                <span>Закрепить сообщение</span>
                            </label>
                        </div>
                        <div style="margin-bottom: 1rem;">
                            <label style="display: block; margin-bottom: 0.5rem; color: var(--text-secondary); font-size: 0.9rem; font-weight: 600;">Разрешенные реакции</label>
                            <div id="channelAllowedReactions" style="display: flex; flex-wrap: wrap; gap: 0.5rem; padding: 0.75rem; background: var(--bg-tertiary); border-radius: 8px; min-height: 50px;">
                                <div style="color: var(--text-muted); font-size: 0.85rem;">Загрузка...</div>
                            </div>
                            <button class="btn-secondary" id="editReactionsBtn" style="margin-top: 0.5rem; font-size: 0.85rem;">Изменить реакции</button>
                        </div>
                        <div style="margin-bottom: 1rem;">
                            <label style="display: block; margin-bottom: 0.5rem; color: var(--text-secondary); font-size: 0.9rem; font-weight: 600;">Чат канала</label>
                            <div style="display: flex; align-items: center; gap: 0.5rem;">
                                <span style="color: var(--text-secondary); font-size: 0.9rem;">Групповой чат для участников канала</span>
                                <button class="btn-secondary" id="manageChannelChatBtn" style="font-size: 0.85rem;">Управление</button>
                            </div>
                        </div>
                    </div>
                    <div class="modal-actions">
                        <button class="btn-primary" id="saveSettingsBtn">Сохранить</button>
                    </div>
                </div>

                <!-- Вкладка: Магазин -->
                <div class="settings-tab-content" id="settingsTabShop" style="display: none;">
                    <div style="margin-bottom: 1rem; display: flex; justify-content: space-between; align-items: center;">
                        <h3 style="margin: 0; color: var(--text-primary); font-size: 1.1rem;">Товары</h3>
                        <button class="btn-primary btn-small" id="addProductBtn">+ Добавить товар</button>
                    </div>
                    <div id="shopProductsList" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 1rem; max-height: 500px; overflow-y: auto;">
                        <div style="padding: 2rem; text-align: center; color: var(--text-secondary); grid-column: 1 / -1;">Загрузка товаров...</div>
                    </div>
                </div>

                <!-- Вкладка: Интеграции -->
                <div class="settings-tab-content" id="settingsTabIntegrations" style="display: none;">
                    <div style="margin-bottom: 1rem;">
                        <h3 style="margin: 0 0 1rem 0; color: var(--text-primary); font-size: 1.1rem;">Подключенные интеграции</h3>
                        <div id="integrationsList" style="display: flex; flex-direction: column; gap: 0.75rem;">
                            <div style="padding: 2rem; text-align: center; color: var(--text-secondary);">Загрузка...</div>
                        </div>
                    </div>
                    <div style="margin-top: 2rem; padding-top: 1.5rem; border-top: 1px solid var(--border-color);">
                        <h3 style="margin: 0 0 1rem 0; color: var(--text-primary); font-size: 1.1rem;">Доступные интеграции</h3>
                        <div id="availableIntegrations" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 1rem;">
                            <div class="integration-card" data-service="discord" style="padding: 1rem; background: var(--bg-secondary); border-radius: 8px; cursor: pointer; text-align: center; transition: all 0.2s;">
                                <div style="font-size: 2rem; margin-bottom: 0.5rem;">💬</div>
                                <div style="color: var(--text-primary); font-weight: 600;">Discord</div>
                            </div>
                            <div class="integration-card" data-service="github" style="padding: 1rem; background: var(--bg-secondary); border-radius: 8px; cursor: pointer; text-align: center; transition: all 0.2s;">
                                <div style="font-size: 2rem; margin-bottom: 0.5rem;">🐙</div>
                                <div style="color: var(--text-primary); font-weight: 600;">GitHub</div>
                            </div>
                            <div class="integration-card" data-service="svortex" style="padding: 1rem; background: var(--bg-secondary); border-radius: 8px; cursor: pointer; text-align: center; transition: all 0.2s;">
                                <div style="font-size: 2rem; margin-bottom: 0.5rem;">🎮</div>
                                <div style="color: var(--text-primary); font-weight: 600;">Svortex</div>
                            </div>
                            <div class="integration-card" data-service="trello" style="padding: 1rem; background: var(--bg-secondary); border-radius: 8px; cursor: pointer; text-align: center; transition: all 0.2s;">
                                <div style="font-size: 2rem; margin-bottom: 0.5rem;">📋</div>
                                <div style="color: var(--text-primary); font-weight: 600;">Trello</div>
                            </div>
                            <div class="integration-card" data-service="rss" style="padding: 1rem; background: var(--bg-secondary); border-radius: 8px; cursor: pointer; text-align: center; transition: all 0.2s;">
                                <div style="font-size: 2rem; margin-bottom: 0.5rem;">📡</div>
                                <div style="color: var(--text-primary); font-weight: 600;">RSS</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Channel Settings (2025) -->
    <div class="modal-overlay" id="channelAdminPanel" style="display: none;">
        <div class="modal-content channel-admin">
            <div class="modal-header channel-admin-header">
                <div class="channel-admin-title">
                    <div class="channel-admin-title-text">
                        <div class="channel-admin-title-line">Настройки канала</div>
                        <div id="channelAdminPanelSubtitle" class="channel-admin-subtitle">Управление доступом и реакциями</div>
                    </div>
                </div>
                <button class="close-btn channel-admin-close" id="closeChannelAdminPanel" aria-label="close">&times;</button>
            </div>
            <div class="modal-body channel-admin-body">
                <nav class="channel-admin-nav">
                    <button class="btn-secondary" data-channel-tab="general">Общее</button>
                    <button class="btn-secondary" data-channel-tab="admins">Администраторы</button>
                    <button class="btn-secondary" data-channel-tab="subscribers">Подписчики</button>
                    <button class="btn-secondary" data-channel-tab="blacklist">Блокировки</button>
                    <button class="btn-secondary" data-channel-tab="requests">Заявки</button>
                </nav>
                <div class="channel-admin-content">
                    <div class="channel-tab" id="channelTab-general" style="display:block;">
                        <section class="channel-admin-card">
                            <div class="channel-admin-card-header">
                                <div>
                                    <div class="channel-admin-card-title">Основное</div>
                                    <div class="channel-admin-card-note">Название, описание, ссылка и аватар</div>
                                </div>
                            </div>
                            <div class="channel-admin-hero">
                                <div class="channel-admin-avatar-block">
                                    <div class="channel-admin-avatar-label">Аватар канала</div>
                                    <div id="channelAdminAvatarPreview" class="channel-admin-avatar-preview">#</div>
                                    <div class="channel-admin-avatar-actions">
                                        <input id="channelAdminAvatarInput" type="file" accept="image/*">
                                        <button class="btn-secondary" id="channelAdminUploadAvatar">Загрузить</button>
                                    </div>
                                </div>
                                <div class="channel-admin-fields">
                                    <div class="input-group">
                                        <label>Название</label>
                                        <input id="channelAdminName" type="text" placeholder="Название канала">
                                    </div>
                                    <div class="input-group">
                                        <label>Описание</label>
                                        <textarea id="channelAdminDescription" rows="2" placeholder="Краткое описание"></textarea>
                                    </div>
                                    <div class="input-group">
                                        <label>Публичный @username</label>
                                        <input id="channelAdminAlias" type="text" placeholder="@example">
                                    </div>
                                </div>
                            </div>
                            <div class="channel-admin-toggle-row">
                                <label class="channel-admin-toggle">
                                    <input type="checkbox" id="channelAdminPrivate">
                                    <span>Приватный канал</span>
                                </label>
                                <label class="channel-admin-toggle">
                                    <input type="checkbox" id="channelAdminSignMessages" checked>
                                    <span>Подписывать сообщения</span>
                                </label>
                            </div>
                            <div class="channel-admin-actions">
                                <button class="btn-primary" id="channelAdminSaveGeneral">Сохранить</button>
                            </div>
                        </section>
                        <section class="channel-admin-card">
                            <div class="channel-admin-card-header">
                                <div>
                                    <div class="channel-admin-card-title">Ссылки и обсуждения</div>
                                    <div class="channel-admin-card-note">Инвайты и привязка чата для обсуждений</div>
                                </div>
                            </div>
                            <div class="input-group">
                                <label>Ссылка-приглашение</label>
                                <div class="channel-admin-inline">
                                    <div id="channelAdminInvitePreview" class="channel-admin-link">Ссылка не создана</div>
                                    <button class="btn-secondary" id="channelAdminCreateInvite">Сгенерировать</button>
                                    <button class="btn-secondary" id="channelAdminCopyInvite">Копировать</button>
                                </div>
                                <div class="channel-admin-hint">Для приватных каналов доступ по заявке обязателен.</div>
                            </div>
                            <div class="input-group">
                                <label>Группа обсуждений</label>
                                <div class="channel-admin-inline">
                                    <input id="channelAdminDiscussionId" type="text" placeholder="ID группы или чата">
                                    <button class="btn-secondary" id="channelAdminLinkChat">Связать</button>
                                </div>
                            </div>
                        </section>
                        <section class="channel-admin-card">
                            <div class="channel-admin-card-header">
                                <div>
                                    <div class="channel-admin-card-title">Разрешенные реакции</div>
                                    <div class="channel-admin-card-note">Выберите какие эмодзи доступны</div>
                                </div>
                                <button class="btn-secondary" id="channelAdminResetReactions">Разрешить все</button>
                            </div>
                            <div id="channelAdminReactionGrid" class="channel-admin-reaction-grid"></div>
                        </section>
                        <section class="channel-admin-card channel-admin-danger">
                            <div class="channel-admin-card-title">Опасные действия</div>
                            <div class="channel-admin-card-note">Удаление канала нельзя отменить.</div>
                            <button class="btn-danger" id="channelAdminDeleteBtn">Удалить канал</button>
                        </section>
                    </div>
                    <div class="channel-tab" id="channelTab-admins" style="display:none;">
                        <div class="channel-admin-empty">Список администраторов появится здесь (TODO: backend hook).</div>
                    </div>
                    <div class="channel-tab" id="channelTab-subscribers" style="display:none;">
                        <div class="channel-admin-empty">Список подписчиков появится здесь.</div>
                    </div>
                    <div class="channel-tab" id="channelTab-blacklist" style="display:none;">
                        <div class="channel-admin-empty">Заблокированные пользователи будут отображаться здесь.</div>
                    </div>
                    <div class="channel-tab" id="channelTab-requests" style="display:none;">
                        <div class="channel-admin-empty" id="channelAdminRequests">Заявки на вступление будут отображаться здесь.</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Channel admin permissions -->
    <div class="modal-overlay" id="channelAdminPermModal" style="display: none;">
        <div class="modal-content" style="max-width: 560px; width: 95%; background: var(--bg-primary); color: var(--text-primary); border: 1px solid var(--border-color); border-radius: 16px;">
            <div class="modal-header" style="display:flex;align-items:center;justify-content:space-between;gap:12px;">
                <div>
                    <div style="font-size: 18px; font-weight: 700;">Права администратора</div>
                    <div id="channelAdminPermSubtitle" style="color: var(--text-secondary); font-size: 13px;">Настройка доступа</div>
                </div>
                <button class="close-btn" id="closeChannelAdminPermModal" aria-label="close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="perm-input">
                    <label>Титул администратора</label>
                    <input id="channelAdminPermTitle" type="text" placeholder="Например: модератор">
                </div>
                <div class="channel-perm-grid" id="channelAdminPermGrid"></div>
            </div>
            <div class="modal-footer" style="display:flex; justify-content:flex-end; gap:10px; padding: 0 0 10px 0;">
                <button class="btn-secondary" id="channelAdminPermCancel">Отмена</button>
                <button class="btn-primary" id="channelAdminPermSave">Сохранить</button>
            </div>
        </div>
    </div>

    <!-- Контекстное меню для сообщений -->
    <div class="message-context-menu" id="messageContextMenu" style="display: none;">
        <div class="context-menu-item" id="contextMenuReply">
            <span>💬</span>
            <span>Ответить</span>
        </div>
        <div class="context-menu-item" id="contextMenuReact">
            <span>😊</span>
            <span>Добавить реакцию</span>
        </div>
        <div class="context-menu-item" id="contextMenuPin" style="display: none;">
            <span>📌</span>
            <span>Закрепить</span>
        </div>
        <div class="context-menu-item" id="contextMenuUnpin" style="display: none;">
            <span>📌</span>
            <span>Открепить</span>
        </div>
        <div class="context-menu-item" id="contextMenuDelete" style="display: none;">
            <span>🗑️</span>
            <span>Удалить</span>
        </div>
        <div class="context-menu-item" id="contextMenuForward">
            <span>➡️</span>
            <span>Переслать</span>
        </div>
    </div>

    <!-- Модальное окно для выбора реакции -->
    <div class="modal-overlay" id="reactionPickerModal" style="display: none;">
        <div class="modal-content" style="max-width: 400px;">
            <div class="modal-header">
                <h2>Выберите реакцию</h2>
                <button class="close-btn" id="closeReactionPickerModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="reaction-grid" id="reactionGrid" style="display: grid; grid-template-columns: repeat(6, 1fr); gap: 1rem; padding: 1rem 0;">
                    <!-- Реакции будут добавлены через JavaScript -->
                </div>
            </div>
        </div>
    </div>

    <!-- Модальное окно выбора типа звонка -->
    <div class="modal-overlay" id="callTypeModal" style="display: none;">
        <div class="modal-content call-type-modal">
            <div class="modal-header">
                <h2 data-i18n="call.choose.title">Выберите тип звонка</h2>
                <button class="close-btn" id="closeCallTypeModal">&times;</button>
            </div>
            <div class="modal-body call-type-body">
                <p class="call-type-hint" id="callTypeHint" data-i18n="call.choose.groupHint" style="display: none;">В группах доступны только аудио-звонки</p>
                <div class="call-type-actions">
                    <button class="btn-primary call-type-option" id="callTypeVideoBtn" type="button">
                        <span class="call-type-icon">📹</span>
                        <span data-i18n="call.choose.video">С камерой</span>
                    </button>
                    <button class="btn-secondary call-type-option" id="callTypeAudioBtn" type="button">
                        <span class="call-type-icon">🎤</span>
                        <span data-i18n="call.choose.audio">Без камеры</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="/js/icons.js"></script>
    <script src="/js/public-directory.js"></script>
    <script src="/js/session.js"></script>
    <script src="/js/notifications.js"></script>
    <script src="/js/firebase-config.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-messaging-compat.js"></script>
    <script src="/js/push-notifications.js"></script>
    <script src="/js/calls.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/6.9.0/ethers.umd.min.js"></script>
    <script src="/js/lib/jsqr.min.js"></script>
    <script src="/js/bip39-words.js"></script>
    <script src="/js/wallet-security.js?v=1"></script>
    <script src="/js/wallet.js?v=3"></script>
    <script src="/js/wallet-web3.js?v=2"></script>
    <script src="/js/wallet-ui.js?v=4"></script>
    <script src="/js/chat.js"></script>
    <script src="/js/topics.js"></script>
    <script src="/js/groups.js"></script>
    <script src="/js/channels.js"></script>
    <script>
        // Инициализация после загрузки всех скриптов
        window.addEventListener('load', () => {
            console.log('Page fully loaded, initializing...');
            
            // Инициализация звонков
            const callBtn = document.getElementById('callBtn');
            if (callBtn) {
                callBtn.addEventListener('click', () => {
                    if (typeof openCallTypeModal === 'function') {
                        openCallTypeModal();
                        return;
                    }
                    if (currentChat) {
                        startCall('video');
                        return;
                    }
                    notifications.warning('Выберите чат для звонка');
                });
            }

            // Переключение темы
            const themeToggle = document.getElementById('themeToggle');
            const bodyEl = document.body;
            if (themeToggle) {
                themeToggle.addEventListener('click', () => {
                    const isLight = bodyEl.getAttribute('data-theme') === 'light';
                    if (typeof setTheme === 'function') {
                        setTheme(!isLight);
                    } else if (isLight) {
                        bodyEl.removeAttribute('data-theme');
                    } else {
                        bodyEl.setAttribute('data-theme', 'light');
                    }
                });
            }

            // Мобильное меню для списка чатов
            const sidebar = document.querySelector('.chats-sidebar');
            const sidebarOverlay = document.getElementById('sidebarOverlay');
            const openSidebarBtn = document.getElementById('openSidebarBtn');
            const chatsList = document.getElementById('chatsList');

            const setSidebarState = (open) => {
                if (!sidebar || !sidebarOverlay) return;
                sidebar.classList.toggle('show', open);
                sidebarOverlay.classList.toggle('active', open);
                document.body.classList.toggle('sidebar-open', open);
                if (openSidebarBtn) {
                    openSidebarBtn.textContent = open ? '✕' : '☰';
                }
            };

            const closeSidebar = () => setSidebarState(false);

            if (openSidebarBtn && sidebar && sidebarOverlay) {
                openSidebarBtn.addEventListener('click', () => {
                    const isOpen = sidebar.classList.contains('show');
                    setSidebarState(!isOpen);
                });
                sidebarOverlay.addEventListener('click', closeSidebar);
            }

            if (chatsList && sidebar) {
                chatsList.addEventListener('click', () => {
                    if (window.innerWidth <= 900) {
                        closeSidebar();
                    }
                });
            }

            window.addEventListener('resize', () => {
                if (window.innerWidth > 900) {
                    closeSidebar();
                }
            });
            
            // Прямые обработчики для кнопок создания (на случай если модули не загрузились)
            const createGroupBtn = document.getElementById('createGroupBtn');
            const createChannelBtn = document.getElementById('createChannelBtn');
            
            if (createGroupBtn) {
                createGroupBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    console.log('Create group button clicked (direct handler)');
                    const modal = document.getElementById('createGroupModal');
                    if (modal) {
                        modal.style.display = 'flex';
                        const nameInput = document.getElementById('groupNameInput');
                        const descInput = document.getElementById('groupDescriptionInput');
                        if (nameInput) nameInput.value = '';
                        if (descInput) descInput.value = '';
                    } else {
                        console.error('createGroupModal not found');
                    }
                });
            }
            
            if (createChannelBtn) {
                createChannelBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    console.log('Create channel button clicked (direct handler)');
                    const modal = document.getElementById('createChannelModal');
                    if (modal) {
                        modal.style.display = 'flex';
                        const nameInput = document.getElementById('channelNameInput');
                        const descInput = document.getElementById('channelDescriptionInput');
                        if (nameInput) nameInput.value = '';
                        if (descInput) descInput.value = '';
                    } else {
                        console.error('createChannelModal not found');
                    }
                });
            }
            
            // Обработчик кнопки каталога в меню
            const menuDirectoryBtn = document.getElementById('menuDirectoryBtn');
            if (menuDirectoryBtn) {
                menuDirectoryBtn.addEventListener('click', () => {
                    // Закрываем меню
                    const appMenu = document.getElementById('appMenu');
                    const appMenuOverlay = document.getElementById('appMenuOverlay');
                    if (appMenu) appMenu.classList.remove('show');
                    if (appMenuOverlay) appMenuOverlay.classList.remove('show');
                    
                    // Открываем каталог
                    if (typeof PublicDirectory !== 'undefined' && PublicDirectory.open) {
                        PublicDirectory.open();
                    }
                });
            }
            
            // Инициализация модулей
            setTimeout(() => {
                console.log('Initializing modules...');
                if (typeof window.initGroups === 'function') {
                    window.initGroups();
                } else if (typeof initGroups === 'function') {
                    initGroups();
                }
                if (typeof window.initChannels === 'function') {
                    window.initChannels();
                } else if (typeof initChannels === 'function') {
                    initChannels();
                }
            }, 300);
        });
    </script>
</body>
</html>
